<script src="../js/ozpIwc-client.js"></script>
<script>
    var client = new ozpIwc.Client({
        peerUrl: "http://localhost:13000"
    });

    var tests = 0;
    var requestsPerRun = 0;
    var runsPerTest = 0;

    var run = function(){
        var start;
        var pchain = client.data().set("/foo",{entity:1}).then(function(){
            start = Date.now();
            console.log(start);
        });

        for(var i = 0; i < requestsPerRun; i++){
            pchain = pchain.then(function(){
                return client.data().set("/foo", {entity: i});
            });
        }

        return pchain.then(function(){
            var elapsed = (Date.now()-start);
            console.log(elapsed);
            document.getElementById("output").innerHTML += elapsed + "\t";
            return elapsed;
        });
    };

    var test = function(){
        runsPerTest = document.getElementById('numRuns').value || 0;
        requestsPerRun = document.getElementById('numReqs').value || 0;
        var avg = 0;

        document.getElementById("output").innerHTML = "";
        var pchain = Promise.resolve();
        for (var i = 0; i < runsPerTest; i ++){
            pchain = pchain.then(function(){
                return run().then(function(elapsed){
                    avg += elapsed;
                });
            });
        }

        return pchain.then(function(){
            document.getElementById("avg").innerHTML = avg/(runsPerTest*requestsPerRun);
        })
    };
</script>
<p>Number of runs: <input id="numRuns" value=500></input></p>
</p>
Number of requests per test:
<input id="numReqs" value=10></input>
</p>

<button id="btn" onClick="test()">Run</button>
<p>
    100 set actions with response. Execution time (milliseconds): </br>
    <span id="output"></span>
</p>
<p> Avg throughput (milliseconds): <span id="avg"></span></p>