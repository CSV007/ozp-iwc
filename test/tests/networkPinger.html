<!DOCTYPE html>
<html>
  <head>
    <title>Network Pinger</title>
		
		<link rel="shortcut icon" type="image/png" href="lib/jasmine-2.0.0/jasmine_favicon.png">
		<link rel="stylesheet" type="text/css" href="lib/jasmine-2.0.0/jasmine.css">
		<link rel="stylesheet" type="text/css" href="lib/samples/sample.css">

		<script src="lib/jquery-2.1.0.min.js"></script>
		
		<script src="js/util.js"></script>
		<script src="js/client.js"></script>
		
		<script>
			var params={
				echoOn: true,
				tickOn: true,
				tickCount: 10000,
				tickDelay: 100
			};
			
			// not a perfect query parser, but good enough for these purposes
			var regex=/([^&=]+)=?([^&]*)/g;
			var query=window.location.search.substring(1);
			var match;
			while(match=regex.exec(query)) {
				params[match[1]]=decodeURIComponent(match[2]);
			}
			
			client=new Sibilant.Client("http://localhost:13000/js");
			client.on("connected",function() {
				$("#me").text(client.participantId);
				$("#target").text(params.toAddress);
				var sendTick=function() {
					client.send(params.toAddress,{tick: new Date().getTime()});
					$("#count").text(--params.tickCount);
					if(params.tickCount) {
						window.setTimeout(sendTick,params.tickDelay);
					}
				};
			
				if(params.tickOn) {
					sendTick();
				}
			
				if(params.echoOn) {
					client.on("receive",function(packet) {
						client.send(packet.src,packet.data);
					});
				}
			});
		</script>
  </head>
  <body>
		I am <span id="me"></span>, 
		Pinging <span id="target"></span> another <span id="count"></span> times.
  </body>
</html>
