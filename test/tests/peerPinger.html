<!DOCTYPE html>
<html>
  <head>
    <title>Peer Pinger</title>
		
		<link rel="shortcut icon" type="image/png" href="lib/jasmine-2.0.0/jasmine_favicon.png">
		<link rel="stylesheet" type="text/css" href="lib/jasmine-2.0.0/jasmine.css">
		<link rel="stylesheet" type="text/css" href="lib/samples/sample.css">

		<script src="lib/jquery-2.1.0.min.js"></script>
		
		<script src="js/util.js"></script>
		<script src="js/metrics.js"></script>
		<script src="js/network/peer.js"></script>
		<script src="js/network/localStorageLink.js"></script>
		<script src="lib/samples/sampleWidget-logging.js"></script>
		
		<script>
			var params={
				echoOn: true,
				tickOn: true,
				tickCount: 10,
				tickDelay: 100
			};
			
			// not a perfect query parser, but good enough for these purposes
			var regex=/([^&=]+)=?([^&]*)/g;
			var query=window.location.search.substring(1);
			var match;
			while(match=regex.exec()) {
				params[match[1]]=decodeURIComponent(match[2]);
			}
			
			var sendTick=function() {
				Sibilant.peer.send({tick: new Date().getTime()});
				params.tickCount--;
				if(params.tickCount) {
					window.setTimeout(sendTick,params.tickDelay)	
				}
			};
			
			if(params.tickOn) {
				sendTick();
			}
			
			if(params.echoOn) {
				Sibilant.peer.on("receive",function(packet) {
					Sibilant.peer.send(packet.data);
				});
			}
		</script>
  </head>
  <body>
		<p>Stats:
			<pre id="stats"></pre>
	</p><p>
		Messages:
		<div id="messages"></div>
</p>
  </body>
</html>
