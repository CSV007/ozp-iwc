{
  "version": 3,
  "file": "ozpIwc-bus.js",
  "sources": [
    "app/js/common/asyncAction.js",
    "app/js/common/es5-sham.js",
    "app/js/common/es5-shim.js",
    "app/js/common/event.js",
    "app/js/common/log.js",
    "app/js/common/util.js",
    "app/js/metrics/statistics/sample.js",
    "app/js/metrics/statistics/binary_heap.js",
    "app/js/metrics/statistics/exponentiallyDecayingSample.js",
    "app/js/metrics/statistics/exponentiallyWeightedMovingAverage.js",
    "app/js/metrics/baseMetric.js",
    "app/js/metrics/types/counter.js",
    "app/js/metrics/types/gauge.js",
    "app/js/metrics/types/histogram.js",
    "app/js/metrics/types/meter.js",
    "app/js/metrics/types/timer.js",
    "app/js/metrics/metricsRegistry.js",
    "app/js/bus/setImmediate.js",
    "app/js/bus/security/abacPolicies.js",
    "app/js/bus/security/basicAuthentication.js",
    "app/js/bus/security/basicAuthorization.js",
    "app/js/bus/network/keyBroadcastLocalStorageLink.js",
    "app/js/bus/network/localStorageLink.js",
    "app/js/bus/network/peer.js",
    "app/js/bus/transport/participant.js",
    "app/js/bus/transport/internalParticipant.js",
    "app/js/bus/transport/router.js",
    "app/js/bus/transport/leaderGroupParticipant.js",
    "app/js/bus/transport/multicastParticipant.js",
    "app/js/bus/transport/postMessageParticipant.js",
    "app/js/bus/transport/routerWatchdogParticipant.js",
    "app/js/bus/api/commonApiValue.js",
    "app/js/bus/api/commonApiCollectionValue.js",
    "app/js/bus/api/apiError.js",
    "app/js/bus/api/commonApiBase.js",
    "app/js/bus/api/data/dataApi.js",
    "app/js/bus/api/data/dataApiValue.js",
    "app/js/bus/api/intents/intentsApi.js",
    "app/js/bus/api/intents/intentsApiCapabilityValue.js",
    "app/js/bus/api/intents/intentsApiDefinitionValue.js",
    "app/js/bus/api/intents/intentsApiHandlerValue.js",
    "app/js/bus/api/names/namesApi.js",
    "app/js/bus/api/names/namesApiValue.js",
    "app/js/bus/api/system/systemApi.js",
    "app/js/bus/api/system/systemApiValue.js"
  ],
  "names": [],
  "mappings": "AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,E;AC5CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;ACrdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;ACt5CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;AC9FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;ACnBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,E;ACxKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;ACjEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;AC9IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;ACnHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;ACxEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;AClCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;AC7EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;ACzCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,E;ACrCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;AC5HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;AC9KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;AC5DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qD;ACtFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;ACpUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;ACvLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,G;ACzJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,E;AC/HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;AC/DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;AC9TA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,E;AC/QA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,E;AC/CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;ACpNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;ACxDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,E;AC1KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;ACnBA;AACA;AACA;AACA;AACA;AACA,G;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;AC1WA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,E;ACpGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,E;AClEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;AC9YA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,E;AC3DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,E;AChEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;ACrDA;AACA;AACA;AACA;AACA;AACA;A;ACLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A;AC5EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;A",
  "sourcesContent": [
    "/** @namespace */\nvar ozpIwc=ozpIwc || {};\n\n\n/**\n * A deferred action, but not in the sense of the Javascript standard.\n * @class\n */\nozpIwc.AsyncAction=function() {\n\tthis.callbacks={};\n};\n\nozpIwc.AsyncAction.prototype.when=function(state,callback,self) {\n    self=self || this;\n\t\n\tif(this.resolution === state) {\n\t\tcallback.apply(self,this.value);\n\t} else {\n\t\tthis.callbacks[state]=function() { return callback.apply(self,arguments); };\n\t}\n\treturn this;\n};\n\n\nozpIwc.AsyncAction.prototype.resolve=function(status) {\n\tif(this.resolution) {\n\t\tthrow \"Cannot resolve an already resolved AsyncAction\";\n\t}\n\tvar callback=this.callbacks[status];\n\tthis.resolution=status;\n\tthis.value=Array.prototype.slice.call(arguments,1);\n\t\n\tif(callback) {\n\t\tcallback.apply(this,this.value);\n\t}\n\treturn this;\n};\n\nozpIwc.AsyncAction.prototype.success=function(callback,self) {\n\treturn this.when(\"success\",callback,self);\n};\n\nozpIwc.AsyncAction.prototype.failure=function(callback,self) {\n\treturn this.when(\"failure\",callback,self);\n};",
    "/*!\r\n * https://github.com/es-shims/es5-shim\r\n * @license es5-shim Copyright 2009-2014 by contributors, MIT License\r\n * see https://github.com/es-shims/es5-shim/blob/master/LICENSE\r\n */\r\n\r\n// vim: ts=4 sts=4 sw=4 expandtab\r\n\r\n//Add semicolon to prevent IIFE from being passed as argument to concated code.\r\n;\r\n\r\n// UMD (Universal Module Definition)\r\n// see https://github.com/umdjs/umd/blob/master/returnExports.js\r\n(function (root, factory) {\r\n    if (typeof define === 'function' && define.amd) {\r\n        // AMD. Register as an anonymous module.\r\n        define(factory);\r\n    } else if (typeof exports === 'object') {\r\n        // Node. Does not work with strict CommonJS, but\r\n        // only CommonJS-like enviroments that support module.exports,\r\n        // like Node.\r\n        module.exports = factory();\r\n    } else {\r\n        // Browser globals (root is window)\r\n        root.returnExports = factory();\r\n  }\r\n}(this, function () {\r\n\r\nvar call = Function.prototype.call;\r\nvar prototypeOfObject = Object.prototype;\r\nvar owns = call.bind(prototypeOfObject.hasOwnProperty);\r\n\r\n// If JS engine supports accessors creating shortcuts.\r\nvar defineGetter;\r\nvar defineSetter;\r\nvar lookupGetter;\r\nvar lookupSetter;\r\nvar supportsAccessors = owns(prototypeOfObject, \"__defineGetter__\");\r\nif (supportsAccessors) {\r\n    defineGetter = call.bind(prototypeOfObject.__defineGetter__);\r\n    defineSetter = call.bind(prototypeOfObject.__defineSetter__);\r\n    lookupGetter = call.bind(prototypeOfObject.__lookupGetter__);\r\n    lookupSetter = call.bind(prototypeOfObject.__lookupSetter__);\r\n}\r\n\r\n// ES5 15.2.3.2\r\n// http://es5.github.com/#x15.2.3.2\r\nif (!Object.getPrototypeOf) {\r\n    // https://github.com/es-shims/es5-shim/issues#issue/2\r\n    // http://ejohn.org/blog/objectgetprototypeof/\r\n    // recommended by fschaefer on github\r\n    //\r\n    // sure, and webreflection says ^_^\r\n    // ... this will nerever possibly return null\r\n    // ... Opera Mini breaks here with infinite loops\r\n    Object.getPrototypeOf = function getPrototypeOf(object) {\r\n        var proto = object.__proto__;\r\n        if (proto || proto === null) {\r\n            return proto;\r\n        } else if (object.constructor) {\r\n            return object.constructor.prototype;\r\n        } else {\r\n            return prototypeOfObject;\r\n        }\r\n    };\r\n}\r\n\r\n//ES5 15.2.3.3\r\n//http://es5.github.com/#x15.2.3.3\r\n\r\nfunction doesGetOwnPropertyDescriptorWork(object) {\r\n    try {\r\n        object.sentinel = 0;\r\n        return Object.getOwnPropertyDescriptor(\r\n                object,\r\n                \"sentinel\"\r\n        ).value === 0;\r\n    } catch (exception) {\r\n        // returns falsy\r\n    }\r\n}\r\n\r\n//check whether getOwnPropertyDescriptor works if it's given. Otherwise,\r\n//shim partially.\r\nif (Object.defineProperty) {\r\n    var getOwnPropertyDescriptorWorksOnObject = doesGetOwnPropertyDescriptorWork({});\r\n    var getOwnPropertyDescriptorWorksOnDom = typeof document === \"undefined\" ||\r\n    doesGetOwnPropertyDescriptorWork(document.createElement(\"div\"));\r\n    if (!getOwnPropertyDescriptorWorksOnDom || !getOwnPropertyDescriptorWorksOnObject) {\r\n        var getOwnPropertyDescriptorFallback = Object.getOwnPropertyDescriptor;\r\n    }\r\n}\r\n\r\nif (!Object.getOwnPropertyDescriptor || getOwnPropertyDescriptorFallback) {\r\n    var ERR_NON_OBJECT = \"Object.getOwnPropertyDescriptor called on a non-object: \";\r\n\r\n    Object.getOwnPropertyDescriptor = function getOwnPropertyDescriptor(object, property) {\r\n        if ((typeof object !== \"object\" && typeof object !== \"function\") || object === null) {\r\n            throw new TypeError(ERR_NON_OBJECT + object);\r\n        }\r\n\r\n        // make a valiant attempt to use the real getOwnPropertyDescriptor\r\n        // for I8's DOM elements.\r\n        if (getOwnPropertyDescriptorFallback) {\r\n            try {\r\n                return getOwnPropertyDescriptorFallback.call(Object, object, property);\r\n            } catch (exception) {\r\n                // try the shim if the real one doesn't work\r\n            }\r\n        }\r\n\r\n        // If object does not owns property return undefined immediately.\r\n        if (!owns(object, property)) {\r\n            return;\r\n        }\r\n\r\n        // If object has a property then it's for sure both `enumerable` and\r\n        // `configurable`.\r\n        var descriptor =  { enumerable: true, configurable: true };\r\n\r\n        // If JS engine supports accessor properties then property may be a\r\n        // getter or setter.\r\n        if (supportsAccessors) {\r\n            // Unfortunately `__lookupGetter__` will return a getter even\r\n            // if object has own non getter property along with a same named\r\n            // inherited getter. To avoid misbehavior we temporary remove\r\n            // `__proto__` so that `__lookupGetter__` will return getter only\r\n            // if it's owned by an object.\r\n            var prototype = object.__proto__;\r\n            var notPrototypeOfObject = object !== prototypeOfObject;\r\n            // avoid recursion problem, breaking in Opera Mini when\r\n            // Object.getOwnPropertyDescriptor(Object.prototype, 'toString')\r\n            // or any other Object.prototype accessor\r\n            if (notPrototypeOfObject) {\r\n                object.__proto__ = prototypeOfObject;\r\n            }\r\n\r\n            var getter = lookupGetter(object, property);\r\n            var setter = lookupSetter(object, property);\r\n\r\n            if (notPrototypeOfObject) {\r\n                // Once we have getter and setter we can put values back.\r\n                object.__proto__ = prototype;\r\n            }\r\n\r\n            if (getter || setter) {\r\n                if (getter) {\r\n                    descriptor.get = getter;\r\n                }\r\n                if (setter) {\r\n                    descriptor.set = setter;\r\n                }\r\n                // If it was accessor property we're done and return here\r\n                // in order to avoid adding `value` to the descriptor.\r\n                return descriptor;\r\n            }\r\n        }\r\n\r\n        // If we got this far we know that object has an own property that is\r\n        // not an accessor so we set it as a value and return descriptor.\r\n        descriptor.value = object[property];\r\n        descriptor.writable = true;\r\n        return descriptor;\r\n    };\r\n}\r\n\r\n// ES5 15.2.3.4\r\n// http://es5.github.com/#x15.2.3.4\r\nif (!Object.getOwnPropertyNames) {\r\n    Object.getOwnPropertyNames = function getOwnPropertyNames(object) {\r\n        return Object.keys(object);\r\n    };\r\n}\r\n\r\n// ES5 15.2.3.5\r\n// http://es5.github.com/#x15.2.3.5\r\nif (!Object.create) {\r\n\r\n    // Contributed by Brandon Benvie, October, 2012\r\n    var createEmpty;\r\n    var supportsProto = !({__proto__:null} instanceof Object);\r\n                        // the following produces false positives\r\n                        // in Opera Mini => not a reliable check\r\n                        // Object.prototype.__proto__ === null\r\n    if (supportsProto || typeof document === 'undefined') {\r\n        createEmpty = function () {\r\n            return { \"__proto__\": null };\r\n        };\r\n    } else {\r\n        // In old IE __proto__ can't be used to manually set `null`, nor does\r\n        // any other method exist to make an object that inherits from nothing,\r\n        // aside from Object.prototype itself. Instead, create a new global\r\n        // object and *steal* its Object.prototype and strip it bare. This is\r\n        // used as the prototype to create nullary objects.\r\n        createEmpty = function () {\r\n            var iframe = document.createElement('iframe');\r\n            var parent = document.body || document.documentElement;\r\n            iframe.style.display = 'none';\r\n            parent.appendChild(iframe);\r\n            iframe.src = 'javascript:';\r\n            var empty = iframe.contentWindow.Object.prototype;\r\n            parent.removeChild(iframe);\r\n            iframe = null;\r\n            delete empty.constructor;\r\n            delete empty.hasOwnProperty;\r\n            delete empty.propertyIsEnumerable;\r\n            delete empty.isPrototypeOf;\r\n            delete empty.toLocaleString;\r\n            delete empty.toString;\r\n            delete empty.valueOf;\r\n            empty.__proto__ = null;\r\n\r\n            function Empty() {}\r\n            Empty.prototype = empty;\r\n            // short-circuit future calls\r\n            createEmpty = function () {\r\n                return new Empty();\r\n            };\r\n            return new Empty();\r\n        };\r\n    }\r\n\r\n    Object.create = function create(prototype, properties) {\r\n\r\n        var object;\r\n        function Type() {}  // An empty constructor.\r\n\r\n        if (prototype === null) {\r\n            object = createEmpty();\r\n        } else {\r\n            if (typeof prototype !== \"object\" && typeof prototype !== \"function\") {\r\n                // In the native implementation `parent` can be `null`\r\n                // OR *any* `instanceof Object`  (Object|Function|Array|RegExp|etc)\r\n                // Use `typeof` tho, b/c in old IE, DOM elements are not `instanceof Object`\r\n                // like they are in modern browsers. Using `Object.create` on DOM elements\r\n                // is...err...probably inappropriate, but the native version allows for it.\r\n                throw new TypeError(\"Object prototype may only be an Object or null\"); // same msg as Chrome\r\n            }\r\n            Type.prototype = prototype;\r\n            object = new Type();\r\n            // IE has no built-in implementation of `Object.getPrototypeOf`\r\n            // neither `__proto__`, but this manually setting `__proto__` will\r\n            // guarantee that `Object.getPrototypeOf` will work as expected with\r\n            // objects created using `Object.create`\r\n            object.__proto__ = prototype;\r\n        }\r\n\r\n        if (properties !== void 0) {\r\n            Object.defineProperties(object, properties);\r\n        }\r\n\r\n        return object;\r\n    };\r\n}\r\n\r\n// ES5 15.2.3.6\r\n// http://es5.github.com/#x15.2.3.6\r\n\r\n// Patch for WebKit and IE8 standard mode\r\n// Designed by hax <hax.github.com>\r\n// related issue: https://github.com/es-shims/es5-shim/issues#issue/5\r\n// IE8 Reference:\r\n//     http://msdn.microsoft.com/en-us/library/dd282900.aspx\r\n//     http://msdn.microsoft.com/en-us/library/dd229916.aspx\r\n// WebKit Bugs:\r\n//     https://bugs.webkit.org/show_bug.cgi?id=36423\r\n\r\nfunction doesDefinePropertyWork(object) {\r\n    try {\r\n        Object.defineProperty(object, \"sentinel\", {});\r\n        return \"sentinel\" in object;\r\n    } catch (exception) {\r\n        // returns falsy\r\n    }\r\n}\r\n\r\n// check whether defineProperty works if it's given. Otherwise,\r\n// shim partially.\r\nif (Object.defineProperty) {\r\n    var definePropertyWorksOnObject = doesDefinePropertyWork({});\r\n    var definePropertyWorksOnDom = typeof document === \"undefined\" ||\r\n        doesDefinePropertyWork(document.createElement(\"div\"));\r\n    if (!definePropertyWorksOnObject || !definePropertyWorksOnDom) {\r\n        var definePropertyFallback = Object.defineProperty,\r\n            definePropertiesFallback = Object.defineProperties;\r\n    }\r\n}\r\n\r\nif (!Object.defineProperty || definePropertyFallback) {\r\n    var ERR_NON_OBJECT_DESCRIPTOR = \"Property description must be an object: \";\r\n    var ERR_NON_OBJECT_TARGET = \"Object.defineProperty called on non-object: \"\r\n    var ERR_ACCESSORS_NOT_SUPPORTED = \"getters & setters can not be defined \" +\r\n                                      \"on this javascript engine\";\r\n\r\n    Object.defineProperty = function defineProperty(object, property, descriptor) {\r\n        if ((typeof object !== \"object\" && typeof object !== \"function\") || object === null) {\r\n            throw new TypeError(ERR_NON_OBJECT_TARGET + object);\r\n        }\r\n        if ((typeof descriptor !== \"object\" && typeof descriptor !== \"function\") || descriptor === null) {\r\n            throw new TypeError(ERR_NON_OBJECT_DESCRIPTOR + descriptor);\r\n        }\r\n        // make a valiant attempt to use the real defineProperty\r\n        // for I8's DOM elements.\r\n        if (definePropertyFallback) {\r\n            try {\r\n                return definePropertyFallback.call(Object, object, property, descriptor);\r\n            } catch (exception) {\r\n                // try the shim if the real one doesn't work\r\n            }\r\n        }\r\n\r\n        // If it's a data property.\r\n        if (owns(descriptor, \"value\")) {\r\n            // fail silently if \"writable\", \"enumerable\", or \"configurable\"\r\n            // are requested but not supported\r\n            /*\r\n            // alternate approach:\r\n            if ( // can't implement these features; allow false but not true\r\n                !(owns(descriptor, \"writable\") ? descriptor.writable : true) ||\r\n                !(owns(descriptor, \"enumerable\") ? descriptor.enumerable : true) ||\r\n                !(owns(descriptor, \"configurable\") ? descriptor.configurable : true)\r\n            )\r\n                throw new RangeError(\r\n                    \"This implementation of Object.defineProperty does not \" +\r\n                    \"support configurable, enumerable, or writable.\"\r\n                );\r\n            */\r\n\r\n            if (supportsAccessors && (lookupGetter(object, property) ||\r\n                                      lookupSetter(object, property)))\r\n            {\r\n                // As accessors are supported only on engines implementing\r\n                // `__proto__` we can safely override `__proto__` while defining\r\n                // a property to make sure that we don't hit an inherited\r\n                // accessor.\r\n                var prototype = object.__proto__;\r\n                object.__proto__ = prototypeOfObject;\r\n                // Deleting a property anyway since getter / setter may be\r\n                // defined on object itself.\r\n                delete object[property];\r\n                object[property] = descriptor.value;\r\n                // Setting original `__proto__` back now.\r\n                object.__proto__ = prototype;\r\n            } else {\r\n                object[property] = descriptor.value;\r\n            }\r\n        } else {\r\n            if (!supportsAccessors) {\r\n                throw new TypeError(ERR_ACCESSORS_NOT_SUPPORTED);\r\n            }\r\n            // If we got that far then getters and setters can be defined !!\r\n            if (owns(descriptor, \"get\")) {\r\n                defineGetter(object, property, descriptor.get);\r\n            }\r\n            if (owns(descriptor, \"set\")) {\r\n                defineSetter(object, property, descriptor.set);\r\n            }\r\n        }\r\n        return object;\r\n    };\r\n}\r\n\r\n// ES5 15.2.3.7\r\n// http://es5.github.com/#x15.2.3.7\r\nif (!Object.defineProperties || definePropertiesFallback) {\r\n    Object.defineProperties = function defineProperties(object, properties) {\r\n        // make a valiant attempt to use the real defineProperties\r\n        if (definePropertiesFallback) {\r\n            try {\r\n                return definePropertiesFallback.call(Object, object, properties);\r\n            } catch (exception) {\r\n                // try the shim if the real one doesn't work\r\n            }\r\n        }\r\n\r\n        for (var property in properties) {\r\n            if (owns(properties, property) && property !== \"__proto__\") {\r\n                Object.defineProperty(object, property, properties[property]);\r\n            }\r\n        }\r\n        return object;\r\n    };\r\n}\r\n\r\n// ES5 15.2.3.8\r\n// http://es5.github.com/#x15.2.3.8\r\nif (!Object.seal) {\r\n    Object.seal = function seal(object) {\r\n        // this is misleading and breaks feature-detection, but\r\n        // allows \"securable\" code to \"gracefully\" degrade to working\r\n        // but insecure code.\r\n        return object;\r\n    };\r\n}\r\n\r\n// ES5 15.2.3.9\r\n// http://es5.github.com/#x15.2.3.9\r\nif (!Object.freeze) {\r\n    Object.freeze = function freeze(object) {\r\n        // this is misleading and breaks feature-detection, but\r\n        // allows \"securable\" code to \"gracefully\" degrade to working\r\n        // but insecure code.\r\n        return object;\r\n    };\r\n}\r\n\r\n// detect a Rhino bug and patch it\r\ntry {\r\n    Object.freeze(function () {});\r\n} catch (exception) {\r\n    Object.freeze = (function freeze(freezeObject) {\r\n        return function freeze(object) {\r\n            if (typeof object === \"function\") {\r\n                return object;\r\n            } else {\r\n                return freezeObject(object);\r\n            }\r\n        };\r\n    })(Object.freeze);\r\n}\r\n\r\n// ES5 15.2.3.10\r\n// http://es5.github.com/#x15.2.3.10\r\nif (!Object.preventExtensions) {\r\n    Object.preventExtensions = function preventExtensions(object) {\r\n        // this is misleading and breaks feature-detection, but\r\n        // allows \"securable\" code to \"gracefully\" degrade to working\r\n        // but insecure code.\r\n        return object;\r\n    };\r\n}\r\n\r\n// ES5 15.2.3.11\r\n// http://es5.github.com/#x15.2.3.11\r\nif (!Object.isSealed) {\r\n    Object.isSealed = function isSealed(object) {\r\n        return false;\r\n    };\r\n}\r\n\r\n// ES5 15.2.3.12\r\n// http://es5.github.com/#x15.2.3.12\r\nif (!Object.isFrozen) {\r\n    Object.isFrozen = function isFrozen(object) {\r\n        return false;\r\n    };\r\n}\r\n\r\n// ES5 15.2.3.13\r\n// http://es5.github.com/#x15.2.3.13\r\nif (!Object.isExtensible) {\r\n    Object.isExtensible = function isExtensible(object) {\r\n        // 1. If Type(O) is not Object throw a TypeError exception.\r\n        if (Object(object) !== object) {\r\n            throw new TypeError(); // TODO message\r\n        }\r\n        // 2. Return the Boolean value of the [[Extensible]] internal property of O.\r\n        var name = '';\r\n        while (owns(object, name)) {\r\n            name += '?';\r\n        }\r\n        object[name] = true;\r\n        var returnValue = owns(object, name);\r\n        delete object[name];\r\n        return returnValue;\r\n    };\r\n}\r\n\r\n}));\r\n\r\n",
    "/*!\r\n * https://github.com/es-shims/es5-shim\r\n * @license es5-shim Copyright 2009-2014 by contributors, MIT License\r\n * see https://github.com/es-shims/es5-shim/blob/master/LICENSE\r\n */\r\n\r\n// vim: ts=4 sts=4 sw=4 expandtab\r\n\r\n//Add semicolon to prevent IIFE from being passed as argument to concated code.\r\n;\r\n\r\n// UMD (Universal Module Definition)\r\n// see https://github.com/umdjs/umd/blob/master/returnExports.js\r\n(function (root, factory) {\r\n    if (typeof define === 'function' && define.amd) {\r\n        // AMD. Register as an anonymous module.\r\n        define(factory);\r\n    } else if (typeof exports === 'object') {\r\n        // Node. Does not work with strict CommonJS, but\r\n        // only CommonJS-like enviroments that support module.exports,\r\n        // like Node.\r\n        module.exports = factory();\r\n    } else {\r\n        // Browser globals (root is window)\r\n        root.returnExports = factory();\r\n    }\r\n}(this, function () {\r\n\r\n/**\r\n * Brings an environment as close to ECMAScript 5 compliance\r\n * as is possible with the facilities of erstwhile engines.\r\n *\r\n * Annotated ES5: http://es5.github.com/ (specific links below)\r\n * ES5 Spec: http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-262.pdf\r\n * Required reading: http://javascriptweblog.wordpress.com/2011/12/05/extending-javascript-natives/\r\n */\r\n\r\n// Shortcut to an often accessed properties, in order to avoid multiple\r\n// dereference that costs universally.\r\nvar ArrayPrototype = Array.prototype;\r\nvar ObjectPrototype = Object.prototype;\r\nvar FunctionPrototype = Function.prototype;\r\nvar StringPrototype = String.prototype;\r\nvar NumberPrototype = Number.prototype;\r\nvar array_slice = ArrayPrototype.slice;\r\nvar array_splice = ArrayPrototype.splice;\r\nvar array_push = ArrayPrototype.push;\r\nvar array_unshift = ArrayPrototype.unshift;\r\nvar call = FunctionPrototype.call;\r\n\r\n// Having a toString local variable name breaks in Opera so use _toString.\r\nvar _toString = ObjectPrototype.toString;\r\n\r\nvar isFunction = function (val) {\r\n    return ObjectPrototype.toString.call(val) === '[object Function]';\r\n};\r\nvar isRegex = function (val) {\r\n    return ObjectPrototype.toString.call(val) === '[object RegExp]';\r\n};\r\nvar isArray = function isArray(obj) {\r\n    return _toString.call(obj) === \"[object Array]\";\r\n};\r\nvar isString = function isString(obj) {\r\n    return _toString.call(obj) === \"[object String]\";\r\n};\r\nvar isArguments = function isArguments(value) {\r\n    var str = _toString.call(value);\r\n    var isArgs = str === '[object Arguments]';\r\n    if (!isArgs) {\r\n        isArgs = !isArray(value)\r\n            && value !== null\r\n            && typeof value === 'object'\r\n            && typeof value.length === 'number'\r\n            && value.length >= 0\r\n            && isFunction(value.callee);\r\n    }\r\n    return isArgs;\r\n};\r\n\r\nvar supportsDescriptors = Object.defineProperty && (function () {\r\n    try {\r\n        Object.defineProperty({}, 'x', {});\r\n        return true;\r\n    } catch (e) { /* this is ES3 */\r\n        return false;\r\n    }\r\n}());\r\n\r\n// Define configurable, writable and non-enumerable props\r\n// if they don't exist.\r\nvar defineProperty;\r\nif (supportsDescriptors) {\r\n    defineProperty = function (object, name, method, forceAssign) {\r\n        if (!forceAssign && (name in object)) { return; }\r\n        Object.defineProperty(object, name, {\r\n            configurable: true,\r\n            enumerable: false,\r\n            writable: true,\r\n            value: method\r\n        });\r\n    };\r\n} else {\r\n    defineProperty = function (object, name, method, forceAssign) {\r\n        if (!forceAssign && (name in object)) { return; }\r\n        object[name] = method;\r\n    };\r\n}\r\nvar defineProperties = function (object, map, forceAssign) {\r\n    for (var name in map) {\r\n        if (ObjectPrototype.hasOwnProperty.call(map, name)) {\r\n          defineProperty(object, name, map[name], forceAssign);\r\n        }\r\n    }\r\n};\r\n\r\n//\r\n// Util\r\n// ======\r\n//\r\n\r\n// ES5 9.4\r\n// http://es5.github.com/#x9.4\r\n// http://jsperf.com/to-integer\r\n\r\nfunction toInteger(n) {\r\n    n = +n;\r\n    if (n !== n) { // isNaN\r\n        n = 0;\r\n    } else if (n !== 0 && n !== (1 / 0) && n !== -(1 / 0)) {\r\n        n = (n > 0 || -1) * Math.floor(Math.abs(n));\r\n    }\r\n    return n;\r\n}\r\n\r\nfunction isPrimitive(input) {\r\n    var type = typeof input;\r\n    return (\r\n        input === null ||\r\n        type === \"undefined\" ||\r\n        type === \"boolean\" ||\r\n        type === \"number\" ||\r\n        type === \"string\"\r\n    );\r\n}\r\n\r\nfunction toPrimitive(input) {\r\n    var val, valueOf, toStr;\r\n    if (isPrimitive(input)) {\r\n        return input;\r\n    }\r\n    valueOf = input.valueOf;\r\n    if (isFunction(valueOf)) {\r\n        val = valueOf.call(input);\r\n        if (isPrimitive(val)) {\r\n            return val;\r\n        }\r\n    }\r\n    toStr = input.toString;\r\n    if (isFunction(toStr)) {\r\n        val = toStr.call(input);\r\n        if (isPrimitive(val)) {\r\n            return val;\r\n        }\r\n    }\r\n    throw new TypeError();\r\n}\r\n\r\n// ES5 9.9\r\n// http://es5.github.com/#x9.9\r\nvar toObject = function (o) {\r\n    if (o == null) { // this matches both null and undefined\r\n        throw new TypeError(\"can't convert \" + o + \" to object\");\r\n    }\r\n    return Object(o);\r\n};\r\n\r\nvar ToUint32 = function ToUint32(x) {\r\n    return x >>> 0;\r\n};\r\n\r\n//\r\n// Function\r\n// ========\r\n//\r\n\r\n// ES-5 15.3.4.5\r\n// http://es5.github.com/#x15.3.4.5\r\n\r\nfunction Empty() {}\r\n\r\ndefineProperties(FunctionPrototype, {\r\n    bind: function bind(that) { // .length is 1\r\n        // 1. Let Target be the this value.\r\n        var target = this;\r\n        // 2. If IsCallable(Target) is false, throw a TypeError exception.\r\n        if (!isFunction(target)) {\r\n            throw new TypeError(\"Function.prototype.bind called on incompatible \" + target);\r\n        }\r\n        // 3. Let A be a new (possibly empty) internal list of all of the\r\n        //   argument values provided after thisArg (arg1, arg2 etc), in order.\r\n        // XXX slicedArgs will stand in for \"A\" if used\r\n        var args = array_slice.call(arguments, 1); // for normal call\r\n        // 4. Let F be a new native ECMAScript object.\r\n        // 11. Set the [[Prototype]] internal property of F to the standard\r\n        //   built-in Function prototype object as specified in 15.3.3.1.\r\n        // 12. Set the [[Call]] internal property of F as described in\r\n        //   15.3.4.5.1.\r\n        // 13. Set the [[Construct]] internal property of F as described in\r\n        //   15.3.4.5.2.\r\n        // 14. Set the [[HasInstance]] internal property of F as described in\r\n        //   15.3.4.5.3.\r\n        var binder = function () {\r\n\r\n            if (this instanceof bound) {\r\n                // 15.3.4.5.2 [[Construct]]\r\n                // When the [[Construct]] internal method of a function object,\r\n                // F that was created using the bind function is called with a\r\n                // list of arguments ExtraArgs, the following steps are taken:\r\n                // 1. Let target be the value of F's [[TargetFunction]]\r\n                //   internal property.\r\n                // 2. If target has no [[Construct]] internal method, a\r\n                //   TypeError exception is thrown.\r\n                // 3. Let boundArgs be the value of F's [[BoundArgs]] internal\r\n                //   property.\r\n                // 4. Let args be a new list containing the same values as the\r\n                //   list boundArgs in the same order followed by the same\r\n                //   values as the list ExtraArgs in the same order.\r\n                // 5. Return the result of calling the [[Construct]] internal\r\n                //   method of target providing args as the arguments.\r\n\r\n                var result = target.apply(\r\n                    this,\r\n                    args.concat(array_slice.call(arguments))\r\n                );\r\n                if (Object(result) === result) {\r\n                    return result;\r\n                }\r\n                return this;\r\n\r\n            } else {\r\n                // 15.3.4.5.1 [[Call]]\r\n                // When the [[Call]] internal method of a function object, F,\r\n                // which was created using the bind function is called with a\r\n                // this value and a list of arguments ExtraArgs, the following\r\n                // steps are taken:\r\n                // 1. Let boundArgs be the value of F's [[BoundArgs]] internal\r\n                //   property.\r\n                // 2. Let boundThis be the value of F's [[BoundThis]] internal\r\n                //   property.\r\n                // 3. Let target be the value of F's [[TargetFunction]] internal\r\n                //   property.\r\n                // 4. Let args be a new list containing the same values as the\r\n                //   list boundArgs in the same order followed by the same\r\n                //   values as the list ExtraArgs in the same order.\r\n                // 5. Return the result of calling the [[Call]] internal method\r\n                //   of target providing boundThis as the this value and\r\n                //   providing args as the arguments.\r\n\r\n                // equiv: target.call(this, ...boundArgs, ...args)\r\n                return target.apply(\r\n                    that,\r\n                    args.concat(array_slice.call(arguments))\r\n                );\r\n\r\n            }\r\n\r\n        };\r\n\r\n        // 15. If the [[Class]] internal property of Target is \"Function\", then\r\n        //     a. Let L be the length property of Target minus the length of A.\r\n        //     b. Set the length own property of F to either 0 or L, whichever is\r\n        //       larger.\r\n        // 16. Else set the length own property of F to 0.\r\n\r\n        var boundLength = Math.max(0, target.length - args.length);\r\n\r\n        // 17. Set the attributes of the length own property of F to the values\r\n        //   specified in 15.3.5.1.\r\n        var boundArgs = [];\r\n        for (var i = 0; i < boundLength; i++) {\r\n            boundArgs.push(\"$\" + i);\r\n        }\r\n\r\n        // XXX Build a dynamic function with desired amount of arguments is the only\r\n        // way to set the length property of a function.\r\n        // In environments where Content Security Policies enabled (Chrome extensions,\r\n        // for ex.) all use of eval or Function costructor throws an exception.\r\n        // However in all of these environments Function.prototype.bind exists\r\n        // and so this code will never be executed.\r\n        var bound = Function(\"binder\", \"return function (\" + boundArgs.join(\",\") + \"){return binder.apply(this,arguments)}\")(binder);\r\n\r\n        if (target.prototype) {\r\n            Empty.prototype = target.prototype;\r\n            bound.prototype = new Empty();\r\n            // Clean up dangling references.\r\n            Empty.prototype = null;\r\n        }\r\n\r\n        // TODO\r\n        // 18. Set the [[Extensible]] internal property of F to true.\r\n\r\n        // TODO\r\n        // 19. Let thrower be the [[ThrowTypeError]] function Object (13.2.3).\r\n        // 20. Call the [[DefineOwnProperty]] internal method of F with\r\n        //   arguments \"caller\", PropertyDescriptor {[[Get]]: thrower, [[Set]]:\r\n        //   thrower, [[Enumerable]]: false, [[Configurable]]: false}, and\r\n        //   false.\r\n        // 21. Call the [[DefineOwnProperty]] internal method of F with\r\n        //   arguments \"arguments\", PropertyDescriptor {[[Get]]: thrower,\r\n        //   [[Set]]: thrower, [[Enumerable]]: false, [[Configurable]]: false},\r\n        //   and false.\r\n\r\n        // TODO\r\n        // NOTE Function objects created using Function.prototype.bind do not\r\n        // have a prototype property or the [[Code]], [[FormalParameters]], and\r\n        // [[Scope]] internal properties.\r\n        // XXX can't delete prototype in pure-js.\r\n\r\n        // 22. Return F.\r\n        return bound;\r\n    }\r\n});\r\n\r\n// _Please note: Shortcuts are defined after `Function.prototype.bind` as we\r\n// us it in defining shortcuts.\r\nvar owns = call.bind(ObjectPrototype.hasOwnProperty);\r\n\r\n// If JS engine supports accessors creating shortcuts.\r\nvar defineGetter;\r\nvar defineSetter;\r\nvar lookupGetter;\r\nvar lookupSetter;\r\nvar supportsAccessors;\r\nif ((supportsAccessors = owns(ObjectPrototype, \"__defineGetter__\"))) {\r\n    defineGetter = call.bind(ObjectPrototype.__defineGetter__);\r\n    defineSetter = call.bind(ObjectPrototype.__defineSetter__);\r\n    lookupGetter = call.bind(ObjectPrototype.__lookupGetter__);\r\n    lookupSetter = call.bind(ObjectPrototype.__lookupSetter__);\r\n}\r\n\r\n//\r\n// Array\r\n// =====\r\n//\r\n\r\n// ES5 15.4.4.12\r\n// http://es5.github.com/#x15.4.4.12\r\nvar spliceNoopReturnsEmptyArray = (function () {\r\n    var a = [1, 2];\r\n    var result = a.splice();\r\n    return a.length === 2 && isArray(result) && result.length === 0;\r\n}());\r\ndefineProperties(ArrayPrototype, {\r\n    // Safari 5.0 bug where .splice() returns undefined\r\n    splice: function splice(start, deleteCount) {\r\n        if (arguments.length === 0) {\r\n            return [];\r\n        } else {\r\n            return array_splice.apply(this, arguments);\r\n        }\r\n    }\r\n}, spliceNoopReturnsEmptyArray);\r\n\r\nvar spliceWorksWithEmptyObject = (function () {\r\n    var obj = {};\r\n    ArrayPrototype.splice.call(obj, 0, 0, 1);\r\n    return obj.length === 1;\r\n}());\r\ndefineProperties(ArrayPrototype, {\r\n    splice: function splice(start, deleteCount) {\r\n        if (arguments.length === 0) { return []; }\r\n        var args = arguments;\r\n        this.length = Math.max(toInteger(this.length), 0);\r\n        if (arguments.length > 0 && typeof deleteCount !== 'number') {\r\n            args = array_slice.call(arguments);\r\n            if (args.length < 2) {\r\n                args.push(this.length - start);\r\n            } else {\r\n                args[1] = toInteger(deleteCount);\r\n            }\r\n        }\r\n        return array_splice.apply(this, args);\r\n    }\r\n}, !spliceWorksWithEmptyObject);\r\n\r\n// ES5 15.4.4.12\r\n// http://es5.github.com/#x15.4.4.13\r\n// Return len+argCount.\r\n// [bugfix, ielt8]\r\n// IE < 8 bug: [].unshift(0) === undefined but should be \"1\"\r\nvar hasUnshiftReturnValueBug = [].unshift(0) !== 1;\r\ndefineProperties(ArrayPrototype, {\r\n    unshift: function () {\r\n        array_unshift.apply(this, arguments);\r\n        return this.length;\r\n    }\r\n}, hasUnshiftReturnValueBug);\r\n\r\n// ES5 15.4.3.2\r\n// http://es5.github.com/#x15.4.3.2\r\n// https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/isArray\r\ndefineProperties(Array, { isArray: isArray });\r\n\r\n// The IsCallable() check in the Array functions\r\n// has been replaced with a strict check on the\r\n// internal class of the object to trap cases where\r\n// the provided function was actually a regular\r\n// expression literal, which in V8 and\r\n// JavaScriptCore is a typeof \"function\".  Only in\r\n// V8 are regular expression literals permitted as\r\n// reduce parameters, so it is desirable in the\r\n// general case for the shim to match the more\r\n// strict and common behavior of rejecting regular\r\n// expressions.\r\n\r\n// ES5 15.4.4.18\r\n// http://es5.github.com/#x15.4.4.18\r\n// https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/array/forEach\r\n\r\n// Check failure of by-index access of string characters (IE < 9)\r\n// and failure of `0 in boxedString` (Rhino)\r\nvar boxedString = Object(\"a\");\r\nvar splitString = boxedString[0] !== \"a\" || !(0 in boxedString);\r\n\r\nvar properlyBoxesContext = function properlyBoxed(method) {\r\n    // Check node 0.6.21 bug where third parameter is not boxed\r\n    var properlyBoxesNonStrict = true;\r\n    var properlyBoxesStrict = true;\r\n    if (method) {\r\n        method.call('foo', function (_, __, context) {\r\n            if (typeof context !== 'object') { properlyBoxesNonStrict = false; }\r\n        });\r\n\r\n        method.call([1], function () {\r\n            'use strict';\r\n            properlyBoxesStrict = typeof this === 'string';\r\n        }, 'x');\r\n    }\r\n    return !!method && properlyBoxesNonStrict && properlyBoxesStrict;\r\n};\r\n\r\ndefineProperties(ArrayPrototype, {\r\n    forEach: function forEach(fun /*, thisp*/) {\r\n        var object = toObject(this),\r\n            self = splitString && isString(this) ? this.split('') : object,\r\n            thisp = arguments[1],\r\n            i = -1,\r\n            length = self.length >>> 0;\r\n\r\n        // If no callback function or if callback is not a callable function\r\n        if (!isFunction(fun)) {\r\n            throw new TypeError(); // TODO message\r\n        }\r\n\r\n        while (++i < length) {\r\n            if (i in self) {\r\n                // Invoke the callback function with call, passing arguments:\r\n                // context, property value, property key, thisArg object\r\n                // context\r\n                fun.call(thisp, self[i], i, object);\r\n            }\r\n        }\r\n    }\r\n}, !properlyBoxesContext(ArrayPrototype.forEach));\r\n\r\n// ES5 15.4.4.19\r\n// http://es5.github.com/#x15.4.4.19\r\n// https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Objects/Array/map\r\ndefineProperties(ArrayPrototype, {\r\n    map: function map(fun /*, thisp*/) {\r\n        var object = toObject(this),\r\n            self = splitString && isString(this) ? this.split('') : object,\r\n            length = self.length >>> 0,\r\n            result = Array(length),\r\n            thisp = arguments[1];\r\n\r\n        // If no callback function or if callback is not a callable function\r\n        if (!isFunction(fun)) {\r\n            throw new TypeError(fun + \" is not a function\");\r\n        }\r\n\r\n        for (var i = 0; i < length; i++) {\r\n            if (i in self) {\r\n                result[i] = fun.call(thisp, self[i], i, object);\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n}, !properlyBoxesContext(ArrayPrototype.map));\r\n\r\n// ES5 15.4.4.20\r\n// http://es5.github.com/#x15.4.4.20\r\n// https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Objects/Array/filter\r\ndefineProperties(ArrayPrototype, {\r\n    filter: function filter(fun /*, thisp */) {\r\n        var object = toObject(this),\r\n            self = splitString && isString(this) ? this.split('') : object,\r\n            length = self.length >>> 0,\r\n            result = [],\r\n            value,\r\n            thisp = arguments[1];\r\n\r\n        // If no callback function or if callback is not a callable function\r\n        if (!isFunction(fun)) {\r\n            throw new TypeError(fun + \" is not a function\");\r\n        }\r\n\r\n        for (var i = 0; i < length; i++) {\r\n            if (i in self) {\r\n                value = self[i];\r\n                if (fun.call(thisp, value, i, object)) {\r\n                    result.push(value);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n}, !properlyBoxesContext(ArrayPrototype.filter));\r\n\r\n// ES5 15.4.4.16\r\n// http://es5.github.com/#x15.4.4.16\r\n// https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/every\r\ndefineProperties(ArrayPrototype, {\r\n    every: function every(fun /*, thisp */) {\r\n        var object = toObject(this),\r\n            self = splitString && isString(this) ? this.split('') : object,\r\n            length = self.length >>> 0,\r\n            thisp = arguments[1];\r\n\r\n        // If no callback function or if callback is not a callable function\r\n        if (!isFunction(fun)) {\r\n            throw new TypeError(fun + \" is not a function\");\r\n        }\r\n\r\n        for (var i = 0; i < length; i++) {\r\n            if (i in self && !fun.call(thisp, self[i], i, object)) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n}, !properlyBoxesContext(ArrayPrototype.every));\r\n\r\n// ES5 15.4.4.17\r\n// http://es5.github.com/#x15.4.4.17\r\n// https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/some\r\ndefineProperties(ArrayPrototype, {\r\n    some: function some(fun /*, thisp */) {\r\n        var object = toObject(this),\r\n            self = splitString && isString(this) ? this.split('') : object,\r\n            length = self.length >>> 0,\r\n            thisp = arguments[1];\r\n\r\n        // If no callback function or if callback is not a callable function\r\n        if (!isFunction(fun)) {\r\n            throw new TypeError(fun + \" is not a function\");\r\n        }\r\n\r\n        for (var i = 0; i < length; i++) {\r\n            if (i in self && fun.call(thisp, self[i], i, object)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n}, !properlyBoxesContext(ArrayPrototype.some));\r\n\r\n// ES5 15.4.4.21\r\n// http://es5.github.com/#x15.4.4.21\r\n// https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Objects/Array/reduce\r\nvar reduceCoercesToObject = false;\r\nif (ArrayPrototype.reduce) {\r\n    reduceCoercesToObject = typeof ArrayPrototype.reduce.call('es5', function (_, __, ___, list) { return list; }) === 'object';\r\n}\r\ndefineProperties(ArrayPrototype, {\r\n    reduce: function reduce(fun /*, initial*/) {\r\n        var object = toObject(this),\r\n            self = splitString && isString(this) ? this.split('') : object,\r\n            length = self.length >>> 0;\r\n\r\n        // If no callback function or if callback is not a callable function\r\n        if (!isFunction(fun)) {\r\n            throw new TypeError(fun + \" is not a function\");\r\n        }\r\n\r\n        // no value to return if no initial value and an empty array\r\n        if (!length && arguments.length === 1) {\r\n            throw new TypeError(\"reduce of empty array with no initial value\");\r\n        }\r\n\r\n        var i = 0;\r\n        var result;\r\n        if (arguments.length >= 2) {\r\n            result = arguments[1];\r\n        } else {\r\n            do {\r\n                if (i in self) {\r\n                    result = self[i++];\r\n                    break;\r\n                }\r\n\r\n                // if array contains no values, no initial value to return\r\n                if (++i >= length) {\r\n                    throw new TypeError(\"reduce of empty array with no initial value\");\r\n                }\r\n            } while (true);\r\n        }\r\n\r\n        for (; i < length; i++) {\r\n            if (i in self) {\r\n                result = fun.call(void 0, result, self[i], i, object);\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n}, !reduceCoercesToObject);\r\n\r\n// ES5 15.4.4.22\r\n// http://es5.github.com/#x15.4.4.22\r\n// https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Objects/Array/reduceRight\r\nvar reduceRightCoercesToObject = false;\r\nif (ArrayPrototype.reduceRight) {\r\n    reduceRightCoercesToObject = typeof ArrayPrototype.reduceRight.call('es5', function (_, __, ___, list) { return list; }) === 'object';\r\n}\r\ndefineProperties(ArrayPrototype, {\r\n    reduceRight: function reduceRight(fun /*, initial*/) {\r\n        var object = toObject(this),\r\n            self = splitString && isString(this) ? this.split('') : object,\r\n            length = self.length >>> 0;\r\n\r\n        // If no callback function or if callback is not a callable function\r\n        if (!isFunction(fun)) {\r\n            throw new TypeError(fun + \" is not a function\");\r\n        }\r\n\r\n        // no value to return if no initial value, empty array\r\n        if (!length && arguments.length === 1) {\r\n            throw new TypeError(\"reduceRight of empty array with no initial value\");\r\n        }\r\n\r\n        var result, i = length - 1;\r\n        if (arguments.length >= 2) {\r\n            result = arguments[1];\r\n        } else {\r\n            do {\r\n                if (i in self) {\r\n                    result = self[i--];\r\n                    break;\r\n                }\r\n\r\n                // if array contains no values, no initial value to return\r\n                if (--i < 0) {\r\n                    throw new TypeError(\"reduceRight of empty array with no initial value\");\r\n                }\r\n            } while (true);\r\n        }\r\n\r\n        if (i < 0) {\r\n            return result;\r\n        }\r\n\r\n        do {\r\n            if (i in self) {\r\n                result = fun.call(void 0, result, self[i], i, object);\r\n            }\r\n        } while (i--);\r\n\r\n        return result;\r\n    }\r\n}, !reduceRightCoercesToObject);\r\n\r\n// ES5 15.4.4.14\r\n// http://es5.github.com/#x15.4.4.14\r\n// https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/indexOf\r\nvar hasFirefox2IndexOfBug = Array.prototype.indexOf && [0, 1].indexOf(1, 2) !== -1;\r\ndefineProperties(ArrayPrototype, {\r\n    indexOf: function indexOf(sought /*, fromIndex */ ) {\r\n        var self = splitString && isString(this) ? this.split('') : toObject(this),\r\n            length = self.length >>> 0;\r\n\r\n        if (!length) {\r\n            return -1;\r\n        }\r\n\r\n        var i = 0;\r\n        if (arguments.length > 1) {\r\n            i = toInteger(arguments[1]);\r\n        }\r\n\r\n        // handle negative indices\r\n        i = i >= 0 ? i : Math.max(0, length + i);\r\n        for (; i < length; i++) {\r\n            if (i in self && self[i] === sought) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n}, hasFirefox2IndexOfBug);\r\n\r\n// ES5 15.4.4.15\r\n// http://es5.github.com/#x15.4.4.15\r\n// https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/lastIndexOf\r\nvar hasFirefox2LastIndexOfBug = Array.prototype.lastIndexOf && [0, 1].lastIndexOf(0, -3) !== -1;\r\ndefineProperties(ArrayPrototype, {\r\n    lastIndexOf: function lastIndexOf(sought /*, fromIndex */) {\r\n        var self = splitString && isString(this) ? this.split('') : toObject(this),\r\n            length = self.length >>> 0;\r\n\r\n        if (!length) {\r\n            return -1;\r\n        }\r\n        var i = length - 1;\r\n        if (arguments.length > 1) {\r\n            i = Math.min(i, toInteger(arguments[1]));\r\n        }\r\n        // handle negative indices\r\n        i = i >= 0 ? i : length - Math.abs(i);\r\n        for (; i >= 0; i--) {\r\n            if (i in self && sought === self[i]) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n}, hasFirefox2LastIndexOfBug);\r\n\r\n//\r\n// Object\r\n// ======\r\n//\r\n\r\n// ES5 15.2.3.14\r\n// http://es5.github.com/#x15.2.3.14\r\n\r\n// http://whattheheadsaid.com/2010/10/a-safer-object-keys-compatibility-implementation\r\nvar hasDontEnumBug = !({'toString': null}).propertyIsEnumerable('toString'),\r\n    hasProtoEnumBug = (function () {}).propertyIsEnumerable('prototype'),\r\n    dontEnums = [\r\n        \"toString\",\r\n        \"toLocaleString\",\r\n        \"valueOf\",\r\n        \"hasOwnProperty\",\r\n        \"isPrototypeOf\",\r\n        \"propertyIsEnumerable\",\r\n        \"constructor\"\r\n    ],\r\n    dontEnumsLength = dontEnums.length;\r\n\r\ndefineProperties(Object, {\r\n    keys: function keys(object) {\r\n        var isFn = isFunction(object),\r\n            isArgs = isArguments(object),\r\n            isObject = object !== null && typeof object === 'object',\r\n            isStr = isObject && isString(object);\r\n\r\n        if (!isObject && !isFn && !isArgs) {\r\n            throw new TypeError(\"Object.keys called on a non-object\");\r\n        }\r\n\r\n        var theKeys = [];\r\n        var skipProto = hasProtoEnumBug && isFn;\r\n        if (isStr || isArgs) {\r\n            for (var i = 0; i < object.length; ++i) {\r\n                theKeys.push(String(i));\r\n            }\r\n        } else {\r\n            for (var name in object) {\r\n                if (!(skipProto && name === 'prototype') && owns(object, name)) {\r\n                    theKeys.push(String(name));\r\n                }\r\n            }\r\n        }\r\n\r\n        if (hasDontEnumBug) {\r\n            var ctor = object.constructor,\r\n                skipConstructor = ctor && ctor.prototype === object;\r\n            for (var j = 0; j < dontEnumsLength; j++) {\r\n                var dontEnum = dontEnums[j];\r\n                if (!(skipConstructor && dontEnum === 'constructor') && owns(object, dontEnum)) {\r\n                    theKeys.push(dontEnum);\r\n                }\r\n            }\r\n        }\r\n        return theKeys;\r\n    }\r\n});\r\n\r\nvar keysWorksWithArguments = Object.keys && (function () {\r\n    // Safari 5.0 bug\r\n    return Object.keys(arguments).length === 2;\r\n}(1, 2));\r\nvar originalKeys = Object.keys;\r\ndefineProperties(Object, {\r\n    keys: function keys(object) {\r\n        if (isArguments(object)) {\r\n            return originalKeys(ArrayPrototype.slice.call(object));\r\n        } else {\r\n            return originalKeys(object);\r\n        }\r\n    }\r\n}, !keysWorksWithArguments);\r\n\r\n//\r\n// Date\r\n// ====\r\n//\r\n\r\n// ES5 15.9.5.43\r\n// http://es5.github.com/#x15.9.5.43\r\n// This function returns a String value represent the instance in time\r\n// represented by this Date object. The format of the String is the Date Time\r\n// string format defined in 15.9.1.15. All fields are present in the String.\r\n// The time zone is always UTC, denoted by the suffix Z. If the time value of\r\n// this object is not a finite Number a RangeError exception is thrown.\r\nvar negativeDate = -62198755200000;\r\nvar negativeYearString = \"-000001\";\r\nvar hasNegativeDateBug = Date.prototype.toISOString && new Date(negativeDate).toISOString().indexOf(negativeYearString) === -1;\r\n\r\ndefineProperties(Date.prototype, {\r\n    toISOString: function toISOString() {\r\n        var result, length, value, year, month;\r\n        if (!isFinite(this)) {\r\n            throw new RangeError(\"Date.prototype.toISOString called on non-finite value.\");\r\n        }\r\n\r\n        year = this.getUTCFullYear();\r\n\r\n        month = this.getUTCMonth();\r\n        // see https://github.com/es-shims/es5-shim/issues/111\r\n        year += Math.floor(month / 12);\r\n        month = (month % 12 + 12) % 12;\r\n\r\n        // the date time string format is specified in 15.9.1.15.\r\n        result = [month + 1, this.getUTCDate(), this.getUTCHours(), this.getUTCMinutes(), this.getUTCSeconds()];\r\n        year = (\r\n            (year < 0 ? \"-\" : (year > 9999 ? \"+\" : \"\")) +\r\n            (\"00000\" + Math.abs(year)).slice(0 <= year && year <= 9999 ? -4 : -6)\r\n        );\r\n\r\n        length = result.length;\r\n        while (length--) {\r\n            value = result[length];\r\n            // pad months, days, hours, minutes, and seconds to have two\r\n            // digits.\r\n            if (value < 10) {\r\n                result[length] = \"0\" + value;\r\n            }\r\n        }\r\n        // pad milliseconds to have three digits.\r\n        return (\r\n            year + \"-\" + result.slice(0, 2).join(\"-\") +\r\n            \"T\" + result.slice(2).join(\":\") + \".\" +\r\n            (\"000\" + this.getUTCMilliseconds()).slice(-3) + \"Z\"\r\n        );\r\n    }\r\n}, hasNegativeDateBug);\r\n\r\n\r\n// ES5 15.9.5.44\r\n// http://es5.github.com/#x15.9.5.44\r\n// This function provides a String representation of a Date object for use by\r\n// JSON.stringify (15.12.3).\r\nvar dateToJSONIsSupported = false;\r\ntry {\r\n    dateToJSONIsSupported = (\r\n        Date.prototype.toJSON &&\r\n        new Date(NaN).toJSON() === null &&\r\n        new Date(negativeDate).toJSON().indexOf(negativeYearString) !== -1 &&\r\n        Date.prototype.toJSON.call({ // generic\r\n            toISOString: function () {\r\n                return true;\r\n            }\r\n        })\r\n    );\r\n} catch (e) {\r\n}\r\nif (!dateToJSONIsSupported) {\r\n    Date.prototype.toJSON = function toJSON(key) {\r\n        // When the toJSON method is called with argument key, the following\r\n        // steps are taken:\r\n\r\n        // 1.  Let O be the result of calling ToObject, giving it the this\r\n        // value as its argument.\r\n        // 2. Let tv be toPrimitive(O, hint Number).\r\n        var o = Object(this),\r\n            tv = toPrimitive(o),\r\n            toISO;\r\n        // 3. If tv is a Number and is not finite, return null.\r\n        if (typeof tv === \"number\" && !isFinite(tv)) {\r\n            return null;\r\n        }\r\n        // 4. Let toISO be the result of calling the [[Get]] internal method of\r\n        // O with argument \"toISOString\".\r\n        toISO = o.toISOString;\r\n        // 5. If IsCallable(toISO) is false, throw a TypeError exception.\r\n        if (typeof toISO !== \"function\") {\r\n            throw new TypeError(\"toISOString property is not callable\");\r\n        }\r\n        // 6. Return the result of calling the [[Call]] internal method of\r\n        //  toISO with O as the this value and an empty argument list.\r\n        return toISO.call(o);\r\n\r\n        // NOTE 1 The argument is ignored.\r\n\r\n        // NOTE 2 The toJSON function is intentionally generic; it does not\r\n        // require that its this value be a Date object. Therefore, it can be\r\n        // transferred to other kinds of objects for use as a method. However,\r\n        // it does require that any such object have a toISOString method. An\r\n        // object is free to use the argument key to filter its\r\n        // stringification.\r\n    };\r\n}\r\n\r\n// ES5 15.9.4.2\r\n// http://es5.github.com/#x15.9.4.2\r\n// based on work shared by Daniel Friesen (dantman)\r\n// http://gist.github.com/303249\r\nvar supportsExtendedYears = Date.parse('+033658-09-27T01:46:40.000Z') === 1e15;\r\nvar acceptsInvalidDates = !isNaN(Date.parse('2012-04-04T24:00:00.500Z')) || !isNaN(Date.parse('2012-11-31T23:59:59.000Z'));\r\nvar doesNotParseY2KNewYear = isNaN(Date.parse(\"2000-01-01T00:00:00.000Z\"));\r\nif (!Date.parse || doesNotParseY2KNewYear || acceptsInvalidDates || !supportsExtendedYears) {\r\n    // XXX global assignment won't work in embeddings that use\r\n    // an alternate object for the context.\r\n    Date = (function (NativeDate) {\r\n\r\n        // Date.length === 7\r\n        function Date(Y, M, D, h, m, s, ms) {\r\n            var length = arguments.length;\r\n            if (this instanceof NativeDate) {\r\n                var date = length === 1 && String(Y) === Y ? // isString(Y)\r\n                    // We explicitly pass it through parse:\r\n                    new NativeDate(Date.parse(Y)) :\r\n                    // We have to manually make calls depending on argument\r\n                    // length here\r\n                    length >= 7 ? new NativeDate(Y, M, D, h, m, s, ms) :\r\n                    length >= 6 ? new NativeDate(Y, M, D, h, m, s) :\r\n                    length >= 5 ? new NativeDate(Y, M, D, h, m) :\r\n                    length >= 4 ? new NativeDate(Y, M, D, h) :\r\n                    length >= 3 ? new NativeDate(Y, M, D) :\r\n                    length >= 2 ? new NativeDate(Y, M) :\r\n                    length >= 1 ? new NativeDate(Y) :\r\n                                  new NativeDate();\r\n                // Prevent mixups with unfixed Date object\r\n                date.constructor = Date;\r\n                return date;\r\n            }\r\n            return NativeDate.apply(this, arguments);\r\n        }\r\n\r\n        // 15.9.1.15 Date Time String Format.\r\n        var isoDateExpression = new RegExp(\"^\" +\r\n            \"(\\\\d{4}|[\\+\\-]\\\\d{6})\" + // four-digit year capture or sign +\r\n                                      // 6-digit extended year\r\n            \"(?:-(\\\\d{2})\" + // optional month capture\r\n            \"(?:-(\\\\d{2})\" + // optional day capture\r\n            \"(?:\" + // capture hours:minutes:seconds.milliseconds\r\n                \"T(\\\\d{2})\" + // hours capture\r\n                \":(\\\\d{2})\" + // minutes capture\r\n                \"(?:\" + // optional :seconds.milliseconds\r\n                    \":(\\\\d{2})\" + // seconds capture\r\n                    \"(?:(\\\\.\\\\d{1,}))?\" + // milliseconds capture\r\n                \")?\" +\r\n            \"(\" + // capture UTC offset component\r\n                \"Z|\" + // UTC capture\r\n                \"(?:\" + // offset specifier +/-hours:minutes\r\n                    \"([-+])\" + // sign capture\r\n                    \"(\\\\d{2})\" + // hours offset capture\r\n                    \":(\\\\d{2})\" + // minutes offset capture\r\n                \")\" +\r\n            \")?)?)?)?\" +\r\n        \"$\");\r\n\r\n        var months = [\r\n            0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334, 365\r\n        ];\r\n\r\n        function dayFromMonth(year, month) {\r\n            var t = month > 1 ? 1 : 0;\r\n            return (\r\n                months[month] +\r\n                Math.floor((year - 1969 + t) / 4) -\r\n                Math.floor((year - 1901 + t) / 100) +\r\n                Math.floor((year - 1601 + t) / 400) +\r\n                365 * (year - 1970)\r\n            );\r\n        }\r\n\r\n        function toUTC(t) {\r\n            return Number(new NativeDate(1970, 0, 1, 0, 0, 0, t));\r\n        }\r\n\r\n        // Copy any custom methods a 3rd party library may have added\r\n        for (var key in NativeDate) {\r\n            Date[key] = NativeDate[key];\r\n        }\r\n\r\n        // Copy \"native\" methods explicitly; they may be non-enumerable\r\n        Date.now = NativeDate.now;\r\n        Date.UTC = NativeDate.UTC;\r\n        Date.prototype = NativeDate.prototype;\r\n        Date.prototype.constructor = Date;\r\n\r\n        // Upgrade Date.parse to handle simplified ISO 8601 strings\r\n        Date.parse = function parse(string) {\r\n            var match = isoDateExpression.exec(string);\r\n            if (match) {\r\n                // parse months, days, hours, minutes, seconds, and milliseconds\r\n                // provide default values if necessary\r\n                // parse the UTC offset component\r\n                var year = Number(match[1]),\r\n                    month = Number(match[2] || 1) - 1,\r\n                    day = Number(match[3] || 1) - 1,\r\n                    hour = Number(match[4] || 0),\r\n                    minute = Number(match[5] || 0),\r\n                    second = Number(match[6] || 0),\r\n                    millisecond = Math.floor(Number(match[7] || 0) * 1000),\r\n                    // When time zone is missed, local offset should be used\r\n                    // (ES 5.1 bug)\r\n                    // see https://bugs.ecmascript.org/show_bug.cgi?id=112\r\n                    isLocalTime = Boolean(match[4] && !match[8]),\r\n                    signOffset = match[9] === \"-\" ? 1 : -1,\r\n                    hourOffset = Number(match[10] || 0),\r\n                    minuteOffset = Number(match[11] || 0),\r\n                    result;\r\n                if (\r\n                    hour < (\r\n                        minute > 0 || second > 0 || millisecond > 0 ?\r\n                        24 : 25\r\n                    ) &&\r\n                    minute < 60 && second < 60 && millisecond < 1000 &&\r\n                    month > -1 && month < 12 && hourOffset < 24 &&\r\n                    minuteOffset < 60 && // detect invalid offsets\r\n                    day > -1 &&\r\n                    day < (\r\n                        dayFromMonth(year, month + 1) -\r\n                        dayFromMonth(year, month)\r\n                    )\r\n                ) {\r\n                    result = (\r\n                        (dayFromMonth(year, month) + day) * 24 +\r\n                        hour +\r\n                        hourOffset * signOffset\r\n                    ) * 60;\r\n                    result = (\r\n                        (result + minute + minuteOffset * signOffset) * 60 +\r\n                        second\r\n                    ) * 1000 + millisecond;\r\n                    if (isLocalTime) {\r\n                        result = toUTC(result);\r\n                    }\r\n                    if (-8.64e15 <= result && result <= 8.64e15) {\r\n                        return result;\r\n                    }\r\n                }\r\n                return NaN;\r\n            }\r\n            return NativeDate.parse.apply(this, arguments);\r\n        };\r\n\r\n        return Date;\r\n    })(Date);\r\n}\r\n\r\n// ES5 15.9.4.4\r\n// http://es5.github.com/#x15.9.4.4\r\nif (!Date.now) {\r\n    Date.now = function now() {\r\n        return new Date().getTime();\r\n    };\r\n}\r\n\r\n\r\n//\r\n// Number\r\n// ======\r\n//\r\n\r\n// ES5.1 15.7.4.5\r\n// http://es5.github.com/#x15.7.4.5\r\nvar hasToFixedBugs = NumberPrototype.toFixed && (\r\n  (0.00008).toFixed(3) !== '0.000'\r\n  || (0.9).toFixed(0) !== '1'\r\n  || (1.255).toFixed(2) !== '1.25'\r\n  || (1000000000000000128).toFixed(0) !== \"1000000000000000128\"\r\n);\r\n\r\nvar toFixedHelpers = {\r\n  base: 1e7,\r\n  size: 6,\r\n  data: [0, 0, 0, 0, 0, 0],\r\n  multiply: function multiply(n, c) {\r\n      var i = -1;\r\n      while (++i < toFixedHelpers.size) {\r\n          c += n * toFixedHelpers.data[i];\r\n          toFixedHelpers.data[i] = c % toFixedHelpers.base;\r\n          c = Math.floor(c / toFixedHelpers.base);\r\n      }\r\n  },\r\n  divide: function divide(n) {\r\n      var i = toFixedHelpers.size, c = 0;\r\n      while (--i >= 0) {\r\n          c += toFixedHelpers.data[i];\r\n          toFixedHelpers.data[i] = Math.floor(c / n);\r\n          c = (c % n) * toFixedHelpers.base;\r\n      }\r\n  },\r\n  numToString: function numToString() {\r\n      var i = toFixedHelpers.size;\r\n      var s = '';\r\n      while (--i >= 0) {\r\n          if (s !== '' || i === 0 || toFixedHelpers.data[i] !== 0) {\r\n              var t = String(toFixedHelpers.data[i]);\r\n              if (s === '') {\r\n                  s = t;\r\n              } else {\r\n                  s += '0000000'.slice(0, 7 - t.length) + t;\r\n              }\r\n          }\r\n      }\r\n      return s;\r\n  },\r\n  pow: function pow(x, n, acc) {\r\n      return (n === 0 ? acc : (n % 2 === 1 ? pow(x, n - 1, acc * x) : pow(x * x, n / 2, acc)));\r\n  },\r\n  log: function log(x) {\r\n      var n = 0;\r\n      while (x >= 4096) {\r\n          n += 12;\r\n          x /= 4096;\r\n      }\r\n      while (x >= 2) {\r\n          n += 1;\r\n          x /= 2;\r\n      }\r\n      return n;\r\n  }\r\n};\r\n\r\ndefineProperties(NumberPrototype, {\r\n    toFixed: function toFixed(fractionDigits) {\r\n        var f, x, s, m, e, z, j, k;\r\n\r\n        // Test for NaN and round fractionDigits down\r\n        f = Number(fractionDigits);\r\n        f = f !== f ? 0 : Math.floor(f);\r\n\r\n        if (f < 0 || f > 20) {\r\n            throw new RangeError(\"Number.toFixed called with invalid number of decimals\");\r\n        }\r\n\r\n        x = Number(this);\r\n\r\n        // Test for NaN\r\n        if (x !== x) {\r\n            return \"NaN\";\r\n        }\r\n\r\n        // If it is too big or small, return the string value of the number\r\n        if (x <= -1e21 || x >= 1e21) {\r\n            return String(x);\r\n        }\r\n\r\n        s = \"\";\r\n\r\n        if (x < 0) {\r\n            s = \"-\";\r\n            x = -x;\r\n        }\r\n\r\n        m = \"0\";\r\n\r\n        if (x > 1e-21) {\r\n            // 1e-21 < x < 1e21\r\n            // -70 < log2(x) < 70\r\n            e = toFixedHelpers.log(x * toFixedHelpers.pow(2, 69, 1)) - 69;\r\n            z = (e < 0 ? x * toFixedHelpers.pow(2, -e, 1) : x / toFixedHelpers.pow(2, e, 1));\r\n            z *= 0x10000000000000; // Math.pow(2, 52);\r\n            e = 52 - e;\r\n\r\n            // -18 < e < 122\r\n            // x = z / 2 ^ e\r\n            if (e > 0) {\r\n                toFixedHelpers.multiply(0, z);\r\n                j = f;\r\n\r\n                while (j >= 7) {\r\n                    toFixedHelpers.multiply(1e7, 0);\r\n                    j -= 7;\r\n                }\r\n\r\n                toFixedHelpers.multiply(toFixedHelpers.pow(10, j, 1), 0);\r\n                j = e - 1;\r\n\r\n                while (j >= 23) {\r\n                    toFixedHelpers.divide(1 << 23);\r\n                    j -= 23;\r\n                }\r\n\r\n                toFixedHelpers.divide(1 << j);\r\n                toFixedHelpers.multiply(1, 1);\r\n                toFixedHelpers.divide(2);\r\n                m = toFixedHelpers.numToString();\r\n            } else {\r\n                toFixedHelpers.multiply(0, z);\r\n                toFixedHelpers.multiply(1 << (-e), 0);\r\n                m = toFixedHelpers.numToString() + '0.00000000000000000000'.slice(2, 2 + f);\r\n            }\r\n        }\r\n\r\n        if (f > 0) {\r\n            k = m.length;\r\n\r\n            if (k <= f) {\r\n                m = s + '0.0000000000000000000'.slice(0, f - k + 2) + m;\r\n            } else {\r\n                m = s + m.slice(0, k - f) + '.' + m.slice(k - f);\r\n            }\r\n        } else {\r\n            m = s + m;\r\n        }\r\n\r\n        return m;\r\n    }\r\n}, hasToFixedBugs);\r\n\r\n\r\n//\r\n// String\r\n// ======\r\n//\r\n\r\n// ES5 15.5.4.14\r\n// http://es5.github.com/#x15.5.4.14\r\n\r\n// [bugfix, IE lt 9, firefox 4, Konqueror, Opera, obscure browsers]\r\n// Many browsers do not split properly with regular expressions or they\r\n// do not perform the split correctly under obscure conditions.\r\n// See http://blog.stevenlevithan.com/archives/cross-browser-split\r\n// I've tested in many browsers and this seems to cover the deviant ones:\r\n//    'ab'.split(/(?:ab)*/) should be [\"\", \"\"], not [\"\"]\r\n//    '.'.split(/(.?)(.?)/) should be [\"\", \".\", \"\", \"\"], not [\"\", \"\"]\r\n//    'tesst'.split(/(s)*/) should be [\"t\", undefined, \"e\", \"s\", \"t\"], not\r\n//       [undefined, \"t\", undefined, \"e\", ...]\r\n//    ''.split(/.?/) should be [], not [\"\"]\r\n//    '.'.split(/()()/) should be [\".\"], not [\"\", \"\", \".\"]\r\n\r\nvar string_split = StringPrototype.split;\r\nif (\r\n    'ab'.split(/(?:ab)*/).length !== 2 ||\r\n    '.'.split(/(.?)(.?)/).length !== 4 ||\r\n    'tesst'.split(/(s)*/)[1] === \"t\" ||\r\n    'test'.split(/(?:)/, -1).length !== 4 ||\r\n    ''.split(/.?/).length ||\r\n    '.'.split(/()()/).length > 1\r\n) {\r\n    (function () {\r\n        var compliantExecNpcg = /()??/.exec(\"\")[1] === void 0; // NPCG: nonparticipating capturing group\r\n\r\n        StringPrototype.split = function (separator, limit) {\r\n            var string = this;\r\n            if (separator === void 0 && limit === 0) {\r\n                return [];\r\n            }\r\n\r\n            // If `separator` is not a regex, use native split\r\n            if (_toString.call(separator) !== \"[object RegExp]\") {\r\n                return string_split.call(this, separator, limit);\r\n            }\r\n\r\n            var output = [],\r\n                flags = (separator.ignoreCase ? \"i\" : \"\") +\r\n                        (separator.multiline  ? \"m\" : \"\") +\r\n                        (separator.extended   ? \"x\" : \"\") + // Proposed for ES6\r\n                        (separator.sticky     ? \"y\" : \"\"), // Firefox 3+\r\n                lastLastIndex = 0,\r\n                // Make `global` and avoid `lastIndex` issues by working with a copy\r\n                separator2, match, lastIndex, lastLength;\r\n            separator = new RegExp(separator.source, flags + \"g\");\r\n            string += \"\"; // Type-convert\r\n            if (!compliantExecNpcg) {\r\n                // Doesn't need flags gy, but they don't hurt\r\n                separator2 = new RegExp(\"^\" + separator.source + \"$(?!\\\\s)\", flags);\r\n            }\r\n            /* Values for `limit`, per the spec:\r\n             * If undefined: 4294967295 // Math.pow(2, 32) - 1\r\n             * If 0, Infinity, or NaN: 0\r\n             * If positive number: limit = Math.floor(limit); if (limit > 4294967295) limit -= 4294967296;\r\n             * If negative number: 4294967296 - Math.floor(Math.abs(limit))\r\n             * If other: Type-convert, then use the above rules\r\n             */\r\n            limit = limit === void 0 ?\r\n                -1 >>> 0 : // Math.pow(2, 32) - 1\r\n                ToUint32(limit);\r\n            while (match = separator.exec(string)) {\r\n                // `separator.lastIndex` is not reliable cross-browser\r\n                lastIndex = match.index + match[0].length;\r\n                if (lastIndex > lastLastIndex) {\r\n                    output.push(string.slice(lastLastIndex, match.index));\r\n                    // Fix browsers whose `exec` methods don't consistently return `undefined` for\r\n                    // nonparticipating capturing groups\r\n                    if (!compliantExecNpcg && match.length > 1) {\r\n                        match[0].replace(separator2, function () {\r\n                            for (var i = 1; i < arguments.length - 2; i++) {\r\n                                if (arguments[i] === void 0) {\r\n                                    match[i] = void 0;\r\n                                }\r\n                            }\r\n                        });\r\n                    }\r\n                    if (match.length > 1 && match.index < string.length) {\r\n                        ArrayPrototype.push.apply(output, match.slice(1));\r\n                    }\r\n                    lastLength = match[0].length;\r\n                    lastLastIndex = lastIndex;\r\n                    if (output.length >= limit) {\r\n                        break;\r\n                    }\r\n                }\r\n                if (separator.lastIndex === match.index) {\r\n                    separator.lastIndex++; // Avoid an infinite loop\r\n                }\r\n            }\r\n            if (lastLastIndex === string.length) {\r\n                if (lastLength || !separator.test(\"\")) {\r\n                    output.push(\"\");\r\n                }\r\n            } else {\r\n                output.push(string.slice(lastLastIndex));\r\n            }\r\n            return output.length > limit ? output.slice(0, limit) : output;\r\n        };\r\n    }());\r\n\r\n// [bugfix, chrome]\r\n// If separator is undefined, then the result array contains just one String,\r\n// which is the this value (converted to a String). If limit is not undefined,\r\n// then the output array is truncated so that it contains no more than limit\r\n// elements.\r\n// \"0\".split(undefined, 0) -> []\r\n} else if (\"0\".split(void 0, 0).length) {\r\n    StringPrototype.split = function split(separator, limit) {\r\n        if (separator === void 0 && limit === 0) { return []; }\r\n        return string_split.call(this, separator, limit);\r\n    };\r\n}\r\n\r\nvar str_replace = StringPrototype.replace;\r\nvar replaceReportsGroupsCorrectly = (function () {\r\n    var groups = [];\r\n    'x'.replace(/x(.)?/g, function (match, group) {\r\n        groups.push(group);\r\n    });\r\n    return groups.length === 1 && typeof groups[0] === 'undefined';\r\n}());\r\n\r\nif (!replaceReportsGroupsCorrectly) {\r\n    StringPrototype.replace = function replace(searchValue, replaceValue) {\r\n        var isFn = isFunction(replaceValue);\r\n        var hasCapturingGroups = isRegex(searchValue) && (/\\)[*?]/).test(searchValue.source);\r\n        if (!isFn || !hasCapturingGroups) {\r\n            return str_replace.call(this, searchValue, replaceValue);\r\n        } else {\r\n            var wrappedReplaceValue = function (match) {\r\n                var length = arguments.length;\r\n                var originalLastIndex = searchValue.lastIndex;\r\n                searchValue.lastIndex = 0;\r\n                var args = searchValue.exec(match);\r\n                searchValue.lastIndex = originalLastIndex;\r\n                args.push(arguments[length - 2], arguments[length - 1]);\r\n                return replaceValue.apply(this, args);\r\n            };\r\n            return str_replace.call(this, searchValue, wrappedReplaceValue);\r\n        }\r\n    };\r\n}\r\n\r\n// ECMA-262, 3rd B.2.3\r\n// Not an ECMAScript standard, although ECMAScript 3rd Edition has a\r\n// non-normative section suggesting uniform semantics and it should be\r\n// normalized across all browsers\r\n// [bugfix, IE lt 9] IE < 9 substr() with negative value not working in IE\r\nvar string_substr = StringPrototype.substr;\r\nvar hasNegativeSubstrBug = \"\".substr && \"0b\".substr(-1) !== \"b\";\r\ndefineProperties(StringPrototype, {\r\n    substr: function substr(start, length) {\r\n        return string_substr.call(\r\n            this,\r\n            start < 0 ? ((start = this.length + start) < 0 ? 0 : start) : start,\r\n            length\r\n        );\r\n    }\r\n}, hasNegativeSubstrBug);\r\n\r\n// ES5 15.5.4.20\r\n// whitespace from: http://es5.github.io/#x15.5.4.20\r\nvar ws = \"\\x09\\x0A\\x0B\\x0C\\x0D\\x20\\xA0\\u1680\\u180E\\u2000\\u2001\\u2002\\u2003\" +\r\n    \"\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000\\u2028\" +\r\n    \"\\u2029\\uFEFF\";\r\nvar zeroWidth = '\\u200b';\r\nvar wsRegexChars = \"[\" + ws + \"]\";\r\nvar trimBeginRegexp = new RegExp(\"^\" + wsRegexChars + wsRegexChars + \"*\");\r\nvar trimEndRegexp = new RegExp(wsRegexChars + wsRegexChars + \"*$\");\r\nvar hasTrimWhitespaceBug = StringPrototype.trim && (ws.trim() || !zeroWidth.trim());\r\ndefineProperties(StringPrototype, {\r\n    // http://blog.stevenlevithan.com/archives/faster-trim-javascript\r\n    // http://perfectionkills.com/whitespace-deviations/\r\n    trim: function trim() {\r\n        if (this === void 0 || this === null) {\r\n            throw new TypeError(\"can't convert \" + this + \" to object\");\r\n        }\r\n        return String(this).replace(trimBeginRegexp, \"\").replace(trimEndRegexp, \"\");\r\n    }\r\n}, hasTrimWhitespaceBug);\r\n\r\n// ES-5 15.1.2.2\r\nif (parseInt(ws + '08') !== 8 || parseInt(ws + '0x16') !== 22) {\r\n    parseInt = (function (origParseInt) {\r\n        var hexRegex = /^0[xX]/;\r\n        return function parseIntES5(str, radix) {\r\n            str = String(str).trim();\r\n            if (!Number(radix)) {\r\n                radix = hexRegex.test(str) ? 16 : 10;\r\n            }\r\n            return origParseInt(str, radix);\r\n        };\r\n    }(parseInt));\r\n}\r\n\r\n}));\r\n",
    "/** @namespace */\nvar ozpIwc=ozpIwc || {};\n\n/**\n\t* @class\n\t*/\nozpIwc.Event=function() {\n\tthis.events={};\n};\n\n/**\n * Registers a handler for the the event.\n * @param {string} event The name of the event to trigger on\n * @param {function} callback Function to be invoked\n * @param {object} [self] Used as the this pointer when callback is invoked.\n * @returns {object} A handle that can be used to unregister the callback via [off()]{@link ozpIwc.Event#off}\n */\nozpIwc.Event.prototype.on=function(event,callback,self) {\n\tvar wrapped=callback;\n\tif(self) {\n\t\twrapped=function() {\n\t\t\tcallback.apply(self,arguments);\n\t\t};\n\t\twrapped.ozpIwcDelegateFor=callback;\n\t}\n\tthis.events[event]=this.events[event]||[];\n\tthis.events[event].push(wrapped);\n\treturn wrapped;\n};\n\n/**\n * Unregisters an event handler previously registered.\n * @param {type} event\n * @param {type} callback\n */\nozpIwc.Event.prototype.off=function(event,callback) {\n\tthis.events[event]=(this.events[event]||[]).filter( function(h) {\n\t\treturn h!==callback && h.ozpIwcDelegateFor !== callback;\n\t});\n};\n\n/**\n * Fires an event that will be received by all handlers.\n * @param {string} eventName  - Name of the event\n * @param {object} event - Event object to pass to the handers.\n * @returns {object} The event after all handlers have processed it\n */\nozpIwc.Event.prototype.trigger=function(eventName,event) {\n\tevent = event || new ozpIwc.CancelableEvent();\n\tvar handlers=this.events[eventName] || [];\n\n\thandlers.forEach(function(h) {\n\t\th(event);\n\t});\n\treturn event;\n};\n\n\n/**\n * Adds an on() and off() function to the target that delegate to this object\n * @param {object} target Target to receive the on/off functions\n */\nozpIwc.Event.prototype.mixinOnOff=function(target) {\n\tvar self=this;\n\ttarget.on=function() { return self.on.apply(self,arguments);};\n\ttarget.off=function() { return self.off.apply(self,arguments);};\n};\n\n/**\n * Convenient base for events that can be canceled.  Provides and manages\n * the properties canceled and cancelReason, as well as the member function\n * cancel().\n * @class\n * @param {object} data - Data that will be copied into the event\n */\nozpIwc.CancelableEvent=function(data) {\n\tdata = data || {};\n\tfor(var k in data) {\n\t\tthis[k]=data[k];\n\t}\n\tthis.canceled=false;\n\tthis.cancelReason=null;\n};\n\n/**\n * Marks the event as canceled.\n * @param {type} reason - A text description of why the event was canceled.\n * @returns {ozpIwc.CancelableEvent} Reference to self\n */\nozpIwc.CancelableEvent.prototype.cancel=function(reason) {\n\treason= reason || \"Unknown\";\n\tthis.canceled=true;\n\tthis.cancelReason=reason;\n\treturn this;\n};\n",
    "/** @namespace */\nvar ozpIwc=ozpIwc || {};\n\n/**\n * @type {object}\n * @property {function} log - Normal log output.\n * @property {function} error - Error output.\n */\nozpIwc.log=ozpIwc.log || {\n\tlog: function() {\n\t\tif(window.console && typeof(window.console.log)===\"function\") {\n\t\t\twindow.console.log.apply(window.console,arguments);\n\t\t}\n\t},\n\terror: function() {\n\t\tif(window.console && typeof(window.console.error)===\"function\") {\n\t\t\twindow.console.error.apply(window.console,arguments);\n\t\t}\n\t}\n};\n",
    "/** @namespace */\nvar ozpIwc=ozpIwc || {};\n\n/** @namespace */\nozpIwc.util=ozpIwc.util || {};\n\n/**\n * Generates a large hexidecimal string to serve as a unique ID.  Not a guid.\n * @returns {String}\n */\nozpIwc.util.generateId=function() {\n    return Math.floor(Math.random() * 0xffffffff).toString(16);\n};\n\n/**\n * Used to get the current epoch time.  Tests overrides this\n * to allow a fast-forward on time-based actions.\n * @returns {Number}\n */\nozpIwc.util.now=function() {\n    return new Date().getTime();\n};\n\n/**\n * Create a class with the given parent in it's prototype chain.\n * @param {function} baseClass - the class being derived from\n * @param {function} newConstructor - the new base class\n * @returns {Function} newConstructor with an augmented prototype\n */\nozpIwc.util.extend=function(baseClass,newConstructor) {\n    if(!baseClass || !baseClass.prototype) {\n        console.error(\"Cannot create a new class for \",newConstructor,\" due to invalid baseclass:\",baseClass);\n        throw new Error(\"Cannot create a new class due to invalid baseClass.  Dependency not loaded first?\");\n    };\n    newConstructor.prototype = Object.create(baseClass.prototype);\n    newConstructor.prototype.constructor = newConstructor;\n    return newConstructor;\n};\n\n/**\n * Invokes the callback handler on another event loop as soon as possible.\n*/\nozpIwc.util.setImmediate=function(f) {\n//    window.setTimeout(f,0);\n    window.setImmediate(f);\n};\n\n/**\n * Detect browser support for structured clones.\n * @returns {boolean} - true if structured clones are supported,\n * false otherwise\n */\nozpIwc.util.structuredCloneSupport=function() {\n    if (ozpIwc.util.structuredCloneSupport.cache !== undefined) {\n        return ozpIwc.util.structuredCloneSupport.cache;\n    }\n    var onlyStrings = false;\n    //If the browser doesn't support structured clones, it will call toString() on the object passed to postMessage.\n    //A bug in FF will cause File clone to fail (see https://bugzilla.mozilla.org/show_bug.cgi?id=722126)\n    //We detect this using a test Blob\n    try {\n        window.postMessage({\n            toString: function () {\n                onlyStrings = true;\n            },\n            blob: new Blob()\n        }, \"*\");\n    } catch (e) {\n        onlyStrings=true;\n    }\n    ozpIwc.util.structuredCloneSupport.cache=!onlyStrings;\n    return ozpIwc.util.structuredCloneSupport.cache;\n};\n\nozpIwc.util.structuredCloneSupport.cache=undefined;\n\n/**\n * Does a deep clone of a serializable object.  Note that this will not\n * clone unserializable objects like DOM elements, Date, RegExp, etc.\n * @param {type} value - value to be cloned.\n * @returns {object} - a deep copy of the object\n */\nozpIwc.util.clone=function(value) {\n\tif(Array.isArray(value) || typeof(value) === 'object') {\n        try {\n            return JSON.parse(JSON.stringify(value));\n        } catch (e) {\n            console.log(e);\n        }\n\t} else {\n\t\treturn value;\n\t}\n};\n\n\n/**\n * Returns true if every needle is found in the haystack.\n * @param {array} haystack - The array to search.\n * @param {array} needles - All of the values to search.\n * @param {function} [equal] - What constitutes equality.  Defaults to a===b.\n * @returns {boolean}\n */\nozpIwc.util.arrayContainsAll=function(haystack,needles,equal) {\n    equal=equal || function(a,b) { return a===b;};\n    return needles.every(function(needle) { \n        return haystack.some(function(hay) { \n            return equal(hay,needle);\n        });\n    });\n};\n\n\n/**\n * Returns true if the value every attribute in needs is equal to \n * value of the same attribute in haystack.\n * @param {array} haystack - The object that must contain all attributes and values.\n * @param {array} needles - The reference object for the attributes and values.\n * @param {function} [equal] - What constitutes equality.  Defaults to a===b.\n * @returns {boolean}\n */\nozpIwc.util.objectContainsAll=function(haystack,needles,equal) {\n    equal=equal || function(a,b) { return a===b;};\n    \n    for(var attribute in needles) {\n        if(!equal(haystack[attribute],needles[attribute])) {\n            return false;\n        }\n    }\n    return true;\n};\n\nozpIwc.util.parseQueryParams=function(query) {\n    query = query || window.location.search;\n    var params={};\n\tvar regex=/\\??([^&=]+)=?([^&]*)/g;\n\tvar match;\n\twhile(match=regex.exec(query)) {\n\t\tparams[match[1]]=decodeURIComponent(match[2]);\n\t}\n    return params;\n};\n\nozpIwc.util.ajax = function (config) {\n\n    var result = new ozpIwc.AsyncAction();\n    var request = new XMLHttpRequest();\n\n    request.onreadystatechange = function() {\n        if (request.readyState !== 4) {\n            return;\n        }\n\n        if (request.status === 200) {\n            result.resolve(\"success\", JSON.parse(this.responseText));\n        } else {\n            result.resolve(\"failure\", this.statusText, this.responseText);\n        }\n    };\n    request.open(config.method, config.href, true);\n\n    if(config.method === \"POST\") {\n        request.send(config.data);\n    }\n    request.setRequestHeader(\"Content-Type\", \"application/json\");\n    request.setRequestHeader(\"Cache-Control\", \"no-cache\");\n    request.send();\n\n    return result;\n};",
    "/*\n * The MIT License (MIT) Copyright (c) 2012 Mike Ihbe\n * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated \n * documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation \n * the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and\n * to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all copies or substantial \n * portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO \n * THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, \n * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/*\n * Original code owned by Mike Ihbe.  Modifications licensed under same terms.\n */\nvar ozpIwc=ozpIwc || {};\nozpIwc.metricsStats=ozpIwc.metricsStats || {};\n\nozpIwc.metricsStats.DEFAULT_POOL_SIZE=1028;\n\nozpIwc.metricsStats.Sample = function(){\n\tthis.clear();\n};\n\nozpIwc.metricsStats.Sample.prototype.update = function(val){ \n\tthis.values.push(val); \n};\n\nozpIwc.metricsStats.Sample.prototype.clear = function(){ \n\tthis.values = []; \n\tthis.count = 0; \n};\nozpIwc.metricsStats.Sample.prototype.size = function(){ \n\treturn this.values.length;\n};\n\nozpIwc.metricsStats.Sample.prototype.getValues = function(){ \n\treturn this.values; \n};\n\n\n/**\n *  Take a uniform sample of size size for all values\n *  @class\n *  @param {Number} [size=ozpIwc.metricsStats.DEFAULT_POOL_SIZE] - The size of the sample pool.\n */\nozpIwc.metricsStats.UniformSample=ozpIwc.util.extend(ozpIwc.metricsStats.Sample,function(size) {\n\tozpIwc.metricsStats.Sample.apply(this);\n  this.limit = size || ozpIwc.metricsStats.DEFAULT_POOL_SIZE;\n});\n\nozpIwc.metricsStats.UniformSample.prototype.update = function(val) {\n  this.count++;\n  if (this.size() < this.limit) {\n    this.values.push(val);\n  } else {\n    var rand = parseInt(Math.random() * this.count);\n    if (rand < this.limit) {\n      this.values[rand] = val;\n    }\n  }\n};\n",
    "// From http://eloquentjavascript.net/appendix2.html, \n// licensed under CCv3.0: http://creativecommons.org/licenses/by/3.0/\n\nvar ozpIwc=ozpIwc || {};\nozpIwc.metricsStats=ozpIwc.metricsStats || {};\n/**\n * This acts as a ordered binary heap for any serializeable JS object or collection of such objects \n * <p>Borrowed from https://github.com/mikejihbe/metrics. Originally from from http://eloquentjavascript.net/appendix2.html\n * <p>Licenced under CCv3.0\n * @class\n * @param {type} scoreFunction\n * @returns {BinaryHeap}\n */\nozpIwc.metricsStats.BinaryHeap = function BinaryHeap(scoreFunction){\n  this.content = [];\n  this.scoreFunction = scoreFunction;\n};\n\nozpIwc.metricsStats.BinaryHeap.prototype = {\n\n  clone: function() {\n    var heap = new ozpIwc.metricsStats.BinaryHeap(this.scoreFunction);\n    // A little hacky, but effective.\n    heap.content = JSON.parse(JSON.stringify(this.content));\n    return heap;\n  },\n\n  push: function(element) {\n    // Add the new element to the end of the array.\n    this.content.push(element);\n    // Allow it to bubble up.\n    this.bubbleUp(this.content.length - 1);\n  },\n\n  peek: function() {\n    return this.content[0];\n  },\n\n  pop: function() {\n    // Store the first element so we can return it later.\n    var result = this.content[0];\n    // Get the element at the end of the array.\n    var end = this.content.pop();\n    // If there are any elements left, put the end element at the\n    // start, and let it sink down.\n    if (this.content.length > 0) {\n      this.content[0] = end;\n      this.sinkDown(0);\n    }\n    return result;\n  },\n\n  remove: function(node) {\n    var len = this.content.length;\n    // To remove a value, we must search through the array to find\n    // it.\n    for (var i = 0; i < len; i++) {\n      if (this.content[i] == node) {\n        // When it is found, the process seen in 'pop' is repeated\n        // to fill up the hole.\n        var end = this.content.pop();\n        if (i != len - 1) {\n          this.content[i] = end;\n          if (this.scoreFunction(end) < this.scoreFunction(node))\n            this.bubbleUp(i);\n          else\n            this.sinkDown(i);\n        }\n        return true;\n      }\n    }\n    throw new Error(\"Node not found.\");\n  },\n\n  size: function() {\n    return this.content.length;\n  },\n\n  bubbleUp: function(n) {\n    // Fetch the element that has to be moved.\n    var element = this.content[n];\n    // When at 0, an element can not go up any further.\n    while (n > 0) {\n      // Compute the parent element's index, and fetch it.\n      var parentN = Math.floor((n + 1) / 2) - 1,\n          parent = this.content[parentN];\n      // Swap the elements if the parent is greater.\n      if (this.scoreFunction(element) < this.scoreFunction(parent)) {\n        this.content[parentN] = element;\n        this.content[n] = parent;\n        // Update 'n' to continue at the new position.\n        n = parentN;\n      }\n      // Found a parent that is less, no need to move it further.\n      else {\n        break;\n      }\n    }\n  },\n\n  sinkDown: function(n) {\n    // Look up the target element and its score.\n    var length = this.content.length,\n        element = this.content[n],\n        elemScore = this.scoreFunction(element);\n\n    while(true) {\n      // Compute the indices of the child elements.\n      var child2N = (n + 1) * 2, child1N = child2N - 1;\n      // This is used to store the new position of the element,\n      // if any.\n      var swap = null;\n      // If the first child exists (is inside the array)...\n      if (child1N < length) {\n        // Look it up and compute its score.\n        var child1 = this.content[child1N],\n            child1Score = this.scoreFunction(child1);\n        // If the score is less than our element's, we need to swap.\n        if (child1Score < elemScore)\n          swap = child1N;\n      }\n      // Do the same checks for the other child.\n      if (child2N < length) {\n        var child2 = this.content[child2N],\n            child2Score = this.scoreFunction(child2);\n        if (child2Score < (swap == null ? elemScore : child1Score))\n          swap = child2N;\n      }\n\n      // If the element needs to be moved, swap it, and continue.\n      if (swap != null) {\n        this.content[n] = this.content[swap];\n        this.content[swap] = element;\n        n = swap;\n      }\n      // Otherwise, we are done.\n      else {\n        break;\n      }\n    }\n  }\n};\n\n",
    "/*\n * The MIT License (MIT) Copyright (c) 2012 Mike Ihbe\n * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated \n * documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation \n * the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and\n * to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all copies or substantial \n * portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO \n * THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, \n * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/*\n * Original code owned by Mike Ihbe.  Modifications licensed under same terms.\n */\nvar ozpIwc=ozpIwc || {};\nozpIwc.metricsStats=ozpIwc.metricsStats || {};\n\n//  Take an exponentially decaying sample of size size of all values\nozpIwc.metricsStats.DEFAULT_RESCALE_THRESHOLD = 60 * 60 * 1000; // 1 hour in milliseconds\nozpIwc.metricsStats.DEFAULT_DECAY_ALPHA=0.015;\n/**\n * This acts as a ordered binary heap for any serializeable JS object or collection of such objects \n * <p>Borrowed from https://github.com/mikejihbe/metrics. \n * @class \n\t*/\nozpIwc.metricsStats.ExponentiallyDecayingSample=ozpIwc.util.extend(ozpIwc.metricsStats.Sample,function(size, alpha) {\n\tozpIwc.metricsStats.Sample.apply(this);\n  this.limit = size || ozpIwc.metricsStats.DEFAULT_POOL_SIZE;\n  this.alpha = alpha || ozpIwc.metricsStats.DEFAULT_DECAY_ALPHA;\n\tthis.rescaleThreshold = ozpIwc.metricsStats.DEFAULT_RESCALE_THRESHOLD;\n});\n\n// This is a relatively expensive operation\nozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.getValues = function() {\n  var values = [];\n  var heap = this.values.clone();\n\tvar elt;\n  while(elt = heap.pop()) {\n    values.push(elt.val);\n  }\n  return values;\n};\n\nozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.size = function() {\n  return this.values.size();\n};\n\nozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.newHeap = function() {\n  return new ozpIwc.metricsStats.BinaryHeap(function(obj){return obj.priority;});\n};\n\nozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.now = function() {\n  return ozpIwc.util.now();\n};\n\nozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.tick = function() {\n  return this.now() / 1000;\n};\n\nozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.clear = function() {\n  this.values = this.newHeap();\n  this.count = 0;\n  this.startTime = this.tick();\n  this.nextScaleTime = this.now() + this.rescaleThreshold;\n};\n\n/*\n* timestamp in milliseconds\n*/\nozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.update = function(val, timestamp) {\n  // Convert timestamp to seconds\n  if (timestamp == undefined) {\n    timestamp = this.tick();\n  } else {\n    timestamp = timestamp / 1000;\n  }\n  var priority = this.weight(timestamp - this.startTime) / Math.random()\n    , value = {val: val, priority: priority};\n  if (this.count < this.limit) {\n    this.count += 1;\n    this.values.push(value);\n  } else {\n    var first = this.values.peek();\n    if (first.priority < priority) {\n      this.values.push(value);\n      this.values.pop();\n    }\n  }\n\n  if (this.now() > this.nextScaleTime) {\n    this.rescale();\n  }\n};\n\nozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.weight = function(time) {\n  return Math.exp(this.alpha * time);\n};\n\nozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.rescale = function() {\n  this.nextScaleTime = this.now() + this.rescaleThreshold;\n  var oldContent = this.values.content\n    , newContent = []\n    , elt\n    , oldStartTime = this.startTime;\n  this.startTime = this.tick();\n  // Downscale every priority by the same factor. Order is unaffected, which is why we're avoiding the cost of popping.\n  for(var i = 0; i < oldContent.length; i++) {\n    newContent.push({val: oldContent[i].val, priority: oldContent[i].priority * Math.exp(-this.alpha * (this.startTime - oldStartTime))});\n  }\n  this.values.content = newContent;\n};\n",
    "/*\n * The MIT License (MIT) Copyright (c) 2012 Mike Ihbe\n * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated \n * documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation \n * the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and\n * to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all copies or substantial \n * portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO \n * THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, \n * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/*\n * Original code owned by Mike Ihbe.  Modifications licensed under same terms.\n */\nvar ozpIwc=ozpIwc || {};\nozpIwc.metricsStats=ozpIwc.metricsStats || {};\n\n/*\n *  Exponentially weighted moving average.\n *  Args: \n *  - alpha:\n *  - interval: time in milliseconds\n */\n\nozpIwc.metricsStats.M1_ALPHA = 1 - Math.exp(-5/60);\nozpIwc.metricsStats.M5_ALPHA = 1 - Math.exp(-5/60/5);\nozpIwc.metricsStats.M15_ALPHA = 1 - Math.exp(-5/60/15);\n\nozpIwc.metricsStats.ExponentiallyWeightedMovingAverage=function(alpha, interval) {\n  this.alpha = alpha;\n  this.interval = interval || 5000;\n  this.currentRate = null;\n  this.uncounted = 0;\n\tthis.lastTick=ozpIwc.util.now();\n};\n\nozpIwc.metricsStats.ExponentiallyWeightedMovingAverage.prototype.update = function(n) {\n  this.uncounted += (n || 1);\n\tthis.tick();\n};\n\n/*\n * Update our rate measurements every interval\n */\nozpIwc.metricsStats.ExponentiallyWeightedMovingAverage.prototype.tick = function() {\n \tvar now=ozpIwc.util.now();\n\tvar age=now-this.lastTick;\n\tif(age > this.interval) {\n\t\tthis.lastTick=now - (age % this.interval);\n\t\tvar requiredTicks=Math.floor(age / this.interval);\n\t\tfor(var i=0; i < requiredTicks; ++i) {\n\t\t\tvar instantRate = this.uncounted / this.interval;\n\t\t\tthis.uncounted = 0;\n\t\t\tif(this.currentRate!==null) {\n\t\t\t\tthis.currentRate += this.alpha * (instantRate - this.currentRate);\n\t\t\t} else {\n\t\t\t\tthis.currentRate = instantRate;\n\t\t\t}\n\t\t}\n\t}\n};\n\n/*\n * Return the rate per second\n */\nozpIwc.metricsStats.ExponentiallyWeightedMovingAverage.prototype.rate = function() {\n  return this.currentRate * 1000;\n};\n",
    "var ozpIwc=ozpIwc || {};\nozpIwc.metricTypes=ozpIwc.metricTypes || {};\n\n/**\n * @typedef {object} ozpIwc.MetricType \n * @property {function} get - returns the current value of the metric\n */\n\nozpIwc.metricTypes.BaseMetric=function() {\n\tthis.value=0;\n    this.name=\"\";\n    this.unitName=\"\";\n};\n\nozpIwc.metricTypes.BaseMetric.prototype.get=function() { \n\treturn this.value; \n};\n\nozpIwc.metricTypes.BaseMetric.prototype.unit=function(val) { \n\tif(val) {\n\t\tthis.unitName=val;\n\t\treturn this;\n\t}\n\treturn this.unitName; \n};\n\n\n\n",
    "/**\r\n * @class\r\n * @extends ozpIwc.MetricType\r\n * A counter running total that can be adjusted up or down.\r\n * Where a meter is set to a known value at each update, a\r\n * counter is incremented up or down by a known change.\r\n */\r\nozpIwc.metricTypes.Counter=ozpIwc.util.extend(ozpIwc.metricTypes.BaseMetric,function() {\r\n\tozpIwc.metricTypes.BaseMetric.apply(this,arguments);\r\n\tthis.value=0;\r\n});\r\n\r\n/**\r\n * @param {Number} [delta=1] - Increment by this value\r\n * @returns {Number} - Value of the counter after increment\r\n */\r\nozpIwc.metricTypes.Counter.prototype.inc=function(delta) { \r\n\treturn this.value+=(delta?delta:1);\r\n};\r\n\r\n/**\r\n * @param {Number} [delta=1] - Decrement by this value\r\n * @returns {Number} - Value of the counter after decrement\r\n */\r\nozpIwc.metricTypes.Counter.prototype.dec=function(delta) { \r\n\treturn this.value-=(delta?delta:1);\r\n};\r\n",
    "ozpIwc.metricTypes=ozpIwc.metricTypes || {};\r\n/**\r\n * @callback ozpIwc.metricTypes.Gauge~gaugeCallback\r\n * @returns {ozpIwc.metricTypes.MetricsTree} \r\n */\r\n\r\n/**\r\n * @class\r\n * @extends ozpIwc.MetricType\r\n * A gauge is an externally defined set of metrics returned by a callback function\r\n * @param {ozpIwc.metricTypes.Gauge~gaugeCallback} metricsCallback\r\n */\r\nozpIwc.metricTypes.Gauge=ozpIwc.util.extend(ozpIwc.metricTypes.BaseMetric,function(metricsCallback) {\r\n\tozpIwc.metricTypes.BaseMetric.apply(this,arguments);\r\n\tthis.callback=metricsCallback;\r\n});\r\n/**\r\n * Set the metrics callback for this gauge.\r\n * @param {ozpIwc.metricTypes.Gauge~gaugeCallback} metricsCallback\r\n * @returns {ozpIwc.metricTypes.Gauge} this\r\n */\r\nozpIwc.metricTypes.Gauge.prototype.set=function(metricsCallback) { \r\n\tthis.callback=metricsCallback;\r\n\treturn this;\r\n};\r\n/**\r\n * Executes the callback and returns a metrics tree.\r\n * @returns {ozpIwc.metricTypes.MetricsTree}\r\n */\r\nozpIwc.metricTypes.Gauge.prototype.get=function() {\r\n    if (this.callback) {\r\n        return this.callback();\r\n    }\r\n    return undefined;\r\n};\r\n",
    "/**\r\n * @class\r\n * @extends ozpIwc.BaseMetric\r\n */\r\nozpIwc.metricTypes.Histogram=ozpIwc.util.extend(ozpIwc.metricTypes.BaseMetric,function() {\r\n\tozpIwc.metricTypes.BaseMetric.apply(this,arguments);\r\n\tthis.sample = new ozpIwc.metricsStats.ExponentiallyDecayingSample();\r\n\tthis.clear();\r\n});\r\n\r\n\r\nozpIwc.metricTypes.Histogram.prototype.clear=function() {\r\n\tthis.sample.clear();\r\n\tthis.min=this.max=null;\r\n\tthis.varianceMean=0;\r\n\tthis.varianceM2=0;\r\n\tthis.sum=0;\r\n\tthis.count=0;\t\r\n};\r\n\r\n/**\r\n * @param {Number} [delta=1] - Increment by this value\r\n * @returns {Number} - Value of the counter after increment\r\n */\r\nozpIwc.metricTypes.Histogram.prototype.mark=function(val,timestamp) { \r\n\ttimestamp = timestamp || ozpIwc.util.now();\r\n\t\r\n\tthis.sample.update(val,timestamp);\r\n\t\r\n\tthis.max=(this.max===null?val:Math.max(this.max,val));\r\n\tthis.min=(this.min===null?val:Math.min(this.min,val));\r\n\tthis.sum+=val;\r\n\tthis.count++;\r\n\t\r\n\tvar delta=val - this.varianceMean;\r\n\tthis.varianceMean += delta/this.count;\r\n\tthis.varianceM2 += delta * (val - this.varianceMean);\r\n\r\n\treturn this.count;\r\n};\r\n\r\nozpIwc.metricTypes.Histogram.prototype.get=function() { \r\n\tvar values=this.sample.getValues().map(function(v){\r\n\t\treturn parseFloat(v);\r\n\t}).sort(function(a,b) { \r\n\t\treturn a-b;\r\n\t});\r\n\tvar percentile=function(p) {\r\n\t\tvar pos=p *(values.length);\r\n\t\tif(pos >= values.length) {\r\n\t\t\treturn values[values.length-1];\r\n\t\t}\r\n\t\tpos=Math.max(0,pos);\r\n\t\tpos=Math.min(pos,values.length+1);\r\n\t\tvar lower = values[Math.floor(pos)-1];\r\n\t\tvar upper = values[Math.floor(pos)];\r\n\t\treturn lower+(pos-Math.floor(pos))*(upper-lower);\r\n\t};\r\n\r\n\treturn {\r\n\t\t'percentile_10': percentile(0.10),\r\n\t\t'percentile_25': percentile(0.25),\t\t\t\t\r\n\t\t'median': percentile(0.50),\t\t\t\t\r\n\t\t'percentile_75': percentile(0.75),\t\t\t\t\r\n\t\t'percentile_90': percentile(0.90),\t\t\t\t\r\n\t\t'percentile_95': percentile(0.95),\t\t\t\t\r\n\t\t'percentile_99': percentile(0.99),\t\t\t\t\r\n\t\t'percentile_999': percentile(0.999),\t\t\t\t\r\n\t\t'variance' : this.count < 1 ? null : this.varianceM2 / (this.count -1),\r\n\t\t'mean' : this.count === 0 ? null : this.varianceMean,\r\n\t\t'stdDev' : this.count < 1 ? null : Math.sqrt(this.varianceM2 / (this.count -1)),\r\n\t\t'count' : this.count,\r\n\t\t'sum' : this.sum,\r\n\t\t'max' : this.max,\r\n\t\t'min' : this.min\r\n\t};\r\n};\r\n\r\n",
    "/**\r\n * @class\r\n * @extends ozpIwc.BaseMetric\r\n */\r\nozpIwc.metricTypes.Meter=ozpIwc.util.extend(ozpIwc.metricTypes.BaseMetric,function() {\r\n\tozpIwc.metricTypes.BaseMetric.apply(this,arguments);\r\n\tthis.m1Rate= new ozpIwc.metricsStats.ExponentiallyWeightedMovingAverage(ozpIwc.metricsStats.M1_ALPHA);\r\n\tthis.m5Rate= new ozpIwc.metricsStats.ExponentiallyWeightedMovingAverage(ozpIwc.metricsStats.M5_ALPHA);\r\n\tthis.m15Rate= new ozpIwc.metricsStats.ExponentiallyWeightedMovingAverage(ozpIwc.metricsStats.M15_ALPHA);\r\n\tthis.startTime=ozpIwc.util.now();\r\n\tthis.value=0;\r\n});\r\n\r\n/**\r\n * @param {Number} [delta=1] - Increment by this value\r\n * @returns {Number} - Value of the counter after increment\r\n */\r\nozpIwc.metricTypes.Meter.prototype.mark=function(delta) { \r\n\tdelta=delta || 1;\r\n\tthis.value+=delta;\r\n\tthis.m1Rate.update(delta);\r\n\tthis.m5Rate.update(delta);\r\n\tthis.m15Rate.update(delta);\r\n\t\r\n\treturn this.value;\r\n};\r\n\r\nozpIwc.metricTypes.Meter.prototype.get=function() { \r\n\treturn {\r\n\t\t'rate_1m' : this.m1Rate.rate(),\r\n\t\t'rate_5m' : this.m5Rate.rate(),\r\n\t\t'rate_15m' : this.m15Rate.rate(),\r\n\t\t'rate_mean' : this.value / (ozpIwc.util.now() - this.startTime) * 1000,\r\n\t\t'count' : this.value\r\n\t};\r\n};\r\n\r\nozpIwc.metricTypes.Meter.prototype.tick=function() { \r\n\tthis.m1Rate.tick();\r\n\tthis.m5Rate.tick();\r\n\tthis.m15Rate.tick();\r\n};\r\n",
    "ozpIwc.metricTypes.Timer=ozpIwc.util.extend(ozpIwc.metricTypes.BaseMetric,function() {\n\tozpIwc.metricTypes.BaseMetric.apply(this,arguments);\n\tthis.meter=new ozpIwc.metricTypes.Meter();\n\tthis.histogram=new ozpIwc.metricTypes.Histogram();\n});\n\nozpIwc.metricTypes.Timer.prototype.mark=function(val,time) {\n\tthis.meter.mark();\n\tthis.histogram.mark(val,time);\n};\n\nozpIwc.metricTypes.Timer.prototype.start=function() {\n\tvar self=this;\n\tvar startTime=ozpIwc.util.now();\n\treturn function() {\n\t\tvar endTime=ozpIwc.util.now();\n\t\tself.mark(endTime-startTime,endTime);\n\t};\n};\n\nozpIwc.metricTypes.Timer.prototype.time=function(callback) {\n\tvar startTime=ozpIwc.util.now();\n\ttry {\n\t\tcallback();\n\t} finally {\n\t\tvar endTime=ozpIwc.util.now();\n\t\tthis.mark(endTime-startTime,endTime);\n\t}\n};\n\nozpIwc.metricTypes.Timer.prototype.get=function() {\n\tvar val=this.histogram.get();\n\tvar meterMetrics=this.meter.get();\n\tfor(var k in meterMetrics) {\n\t\tval[k]=meterMetrics[k];\n\t}\n\treturn val;\n};",
    "var ozpIwc=ozpIwc || {};\r\n\r\n/**\r\n * @class\r\n * A repository of metrics\r\n */\r\nozpIwc.MetricsRegistry=function() {\r\n\tthis.metrics={};\r\n    var self=this;\r\n    this.gauge('registry.metrics.types').set(function() {\r\n        return Object.keys(self.metrics).length;\r\n    });\r\n\r\n};\r\n\r\n/**\r\n * \r\n * @private\r\n * @param {string} name - Name of the metric\r\n * @param {function} type - The constructor of the requested type for this metric.\r\n * @returns {MetricType} - Null if the metric already exists of a different type.  Otherwise a reference to the metric.\r\n */\r\nozpIwc.MetricsRegistry.prototype.findOrCreateMetric=function(name,type) {\r\n\tvar m= this.metrics[name];\r\n    if(!m) {\r\n        m = this.metrics[name] = new type();\r\n        m.name=name;\r\n        return m;\r\n    }\r\n\tif(m instanceof type){\r\n\t\t\treturn m;\r\n\t} else {\r\n\t\t\treturn null;\r\n\t}\t\t\t\r\n};\r\n\r\n/**\r\n * Joins the arguments together into a name.\r\n * @private\r\n * @param {string[]} args - Array or the argument-like \"arguments\" value.\r\n * @returns {string}\r\n */\r\nozpIwc.MetricsRegistry.prototype.makeName=function(args) {\r\n\t// slice is necessary because \"arguments\" isn't a real array, and it's what\r\n\t// is usually passed in, here.\r\n\treturn Array.prototype.slice.call(args).join(\".\");\r\n};\r\n\r\n/**\r\n * @param {...string} name - components of the name\r\n * @returns {ozpIwc.metricTypes.Counter}\r\n */\r\nozpIwc.MetricsRegistry.prototype.counter=function(name) {\r\n\treturn this.findOrCreateMetric(this.makeName(arguments),ozpIwc.metricTypes.Counter);\r\n};\r\n\r\n/**\r\n * @param {...string} name - components of the name\r\n * @returns {ozpIwc.metricTypes.Meter}\r\n */\r\nozpIwc.MetricsRegistry.prototype.meter=function(name) {\r\n\treturn this.findOrCreateMetric(this.makeName(arguments),ozpIwc.metricTypes.Meter);\r\n};\r\n\r\n/**\r\n * @param {...string} name - components of the name\r\n * @returns {ozpIwc.metricTypes.Gauge}\r\n */\r\nozpIwc.MetricsRegistry.prototype.gauge=function(name) {\r\n\treturn this.findOrCreateMetric(this.makeName(arguments),ozpIwc.metricTypes.Gauge);\r\n};\r\n\r\n/**\r\n * @param {...string} name - components of the name\r\n * @returns {ozpIwc.metricTypes.Gauge}\r\n */\r\nozpIwc.MetricsRegistry.prototype.histogram=function(name) {\r\n\treturn this.findOrCreateMetric(this.makeName(arguments),ozpIwc.metricTypes.Histogram);\r\n};\r\n\r\n/**\r\n * @param {...string} name - components of the name\r\n * @returns {ozpIwc.metricTypes.Gauge}\r\n */\r\nozpIwc.MetricsRegistry.prototype.timer=function(name) {\r\n\treturn this.findOrCreateMetric(this.makeName(arguments),ozpIwc.metricTypes.Timer);\r\n};\r\n\r\n/**\r\n * @param {...string} name - components of the name\r\n * @returns {ozpIwc.metricTypes.Gauge}\r\n */\r\nozpIwc.MetricsRegistry.prototype.register=function(name,metric) {\r\n\tthis.metrics[this.makeName(name)]=metric;\r\n\t\r\n\treturn metric;\r\n};\r\n\r\n/**\r\n * \r\n * @returns {unresolved}\r\n */\r\nozpIwc.MetricsRegistry.prototype.toJson=function() {\r\n\tvar rv={};\r\n\tfor(var k in this.metrics) {\r\n\t\tvar path=k.split(\".\");\r\n\t\tvar pos=rv;\r\n\t\twhile(path.length > 1) {\r\n\t\t\tvar current=path.shift();\r\n\t\t\tpos = pos[current]=pos[current] || {};\r\n\t\t}\r\n\t\tpos[path[0]]=this.metrics[k].get();\r\n\t}\r\n\treturn rv;\r\n};\r\n\r\nozpIwc.MetricsRegistry.prototype.allMetrics=function() {\r\n    var rv=[];\r\n    for(var k in this.metrics) {\r\n        rv.push(this.metrics[k]);\r\n    }\r\n    return rv;\r\n};\r\n\r\nozpIwc.metrics=new ozpIwc.MetricsRegistry();\r\n",
    "(function (global, undefined) {\n    \"use strict\";\n\n    if (global.setImmediate) {\n        return;\n    }\n\n    var nextHandle = 1; // Spec says greater than zero\n    var tasksByHandle = {};\n    var currentlyRunningATask = false;\n    var doc = global.document;\n    var setImmediate;\n\n    function addFromSetImmediateArguments(args) {\n        tasksByHandle[nextHandle] = partiallyApplied.apply(undefined, args);\n        return nextHandle++;\n    }\n\n    // This function accepts the same arguments as setImmediate, but\n    // returns a function that requires no arguments.\n    function partiallyApplied(handler) {\n        var args = [].slice.call(arguments, 1);\n        return function() {\n            if (typeof handler === \"function\") {\n                handler.apply(undefined, args);\n            } else {\n                (new Function(\"\" + handler))();\n            }\n        };\n    }\n\n    function runIfPresent(handle) {\n        // From the spec: \"Wait until any invocations of this algorithm started before this one have completed.\"\n        // So if we're currently running a task, we'll need to delay this invocation.\n        if (currentlyRunningATask) {\n            // Delay by doing a setTimeout. setImmediate was tried instead, but in Firefox 7 it generated a\n            // \"too much recursion\" error.\n            setTimeout(partiallyApplied(runIfPresent, handle), 0);\n        } else {\n            var task = tasksByHandle[handle];\n            if (task) {\n                currentlyRunningATask = true;\n                try {\n                    task();\n                } finally {\n                    clearImmediate(handle);\n                    currentlyRunningATask = false;\n                }\n            }\n        }\n    }\n\n    function clearImmediate(handle) {\n        delete tasksByHandle[handle];\n    }\n\n    function installNextTickImplementation() {\n        setImmediate = function() {\n            var handle = addFromSetImmediateArguments(arguments);\n            process.nextTick(partiallyApplied(runIfPresent, handle));\n            return handle;\n        };\n    }\n\n    function canUsePostMessage() {\n        // The test against `importScripts` prevents this implementation from being installed inside a web worker,\n        // where `global.postMessage` means something completely different and can't be used for this purpose.\n        if (global.postMessage && !global.importScripts) {\n            var postMessageIsAsynchronous = true;\n            var oldOnMessage = global.onmessage;\n            global.onmessage = function() {\n                postMessageIsAsynchronous = false;\n            };\n            global.postMessage(\"\", \"*\");\n            global.onmessage = oldOnMessage;\n            return postMessageIsAsynchronous;\n        }\n    }\n\n    function installPostMessageImplementation() {\n        // Installs an event handler on `global` for the `message` event: see\n        // * https://developer.mozilla.org/en/DOM/window.postMessage\n        // * http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages\n\n        var messagePrefix = \"setImmediate$\" + Math.random() + \"$\";\n        var onGlobalMessage = function(event) {\n            if (event.source === global &&\n                typeof event.data === \"string\" &&\n                event.data.indexOf(messagePrefix) === 0) {\n                runIfPresent(+event.data.slice(messagePrefix.length));\n            }\n        };\n\n        if (global.addEventListener) {\n            global.addEventListener(\"message\", onGlobalMessage, false);\n        } else {\n            global.attachEvent(\"onmessage\", onGlobalMessage);\n        }\n\n        setImmediate = function() {\n            var handle = addFromSetImmediateArguments(arguments);\n            global.postMessage(messagePrefix + handle, \"*\");\n            return handle;\n        };\n    }\n\n    function installMessageChannelImplementation() {\n        var channel = new MessageChannel();\n        channel.port1.onmessage = function(event) {\n            var handle = event.data;\n            runIfPresent(handle);\n        };\n\n        setImmediate = function() {\n            var handle = addFromSetImmediateArguments(arguments);\n            channel.port2.postMessage(handle);\n            return handle;\n        };\n    }\n\n    function installReadyStateChangeImplementation() {\n        var html = doc.documentElement;\n        setImmediate = function() {\n            var handle = addFromSetImmediateArguments(arguments);\n            // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n            // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n            var script = doc.createElement(\"script\");\n            script.onreadystatechange = function () {\n                runIfPresent(handle);\n                script.onreadystatechange = null;\n                html.removeChild(script);\n                script = null;\n            };\n            html.appendChild(script);\n            return handle;\n        };\n    }\n\n    function installSetTimeoutImplementation() {\n        setImmediate = function() {\n            var handle = addFromSetImmediateArguments(arguments);\n            setTimeout(partiallyApplied(runIfPresent, handle), 0);\n            return handle;\n        };\n    }\n\n    // If supported, we should attach to the prototype of global, since that is where setTimeout et al. live.\n    var attachTo = Object.getPrototypeOf && Object.getPrototypeOf(global);\n    attachTo = attachTo && attachTo.setTimeout ? attachTo : global;\n\n    // Don't get fooled by e.g. browserify environments.\n    if ({}.toString.call(global.process) === \"[object process]\") {\n        // For Node.js before 0.9\n        installNextTickImplementation();\n\n    } else if (canUsePostMessage()) {\n        // For non-IE10 modern browsers\n        installPostMessageImplementation();\n\n    } else if (global.MessageChannel) {\n        // For web workers, where supported\n        installMessageChannelImplementation();\n\n    } else if (doc && \"onreadystatechange\" in doc.createElement(\"script\")) {\n        // For IE 6–8\n        installReadyStateChangeImplementation();\n\n    } else {\n        // For older browsers\n        installSetTimeoutImplementation();\n    }\n\n    attachTo.setImmediate = setImmediate;\n    attachTo.clearImmediate = clearImmediate;\n}(new Function(\"return this\")()));\n",
    "\nozpIwc.abacPolicies={};\n\n\nozpIwc.abacPolicies.permitWhenObjectHasNoAttributes=function(request) {\n    if(request.object && Object.keys(request.object).length===0) {\n        return \"permit\";\n    }\n    return \"undetermined\";\n};\n\nozpIwc.abacPolicies.subjectHasAllObjectAttributes=function(request) {\n    // if no object permissions, then it's trivially true\n    if(!request.object) {\n        return \"permit\";\n    }\n    var subject = request.subject || {};\n    if(ozpIwc.util.objectContainsAll(subject,request.object,this.implies)) {\n        return \"permit\";\n    }\n    return \"deny\";\n};\n\nozpIwc.abacPolicies.permitAll=function() {\n    return \"permit\";\n};\n\n",
    "var ozpIwc=ozpIwc || {};\n\n/** @typedef {string} ozpIwc.security.Role */\n\n/** @typedef {string} ozpIwc.security.Permission */\n\n/** @typedef { ozpIwc.security.Role[] } ozpIwc.security.Subject */\n\n/** \n * @typedef {object} ozpIwc.security.Actor \n * @property {ozpIwc.security.Subject} securityAttributes\n */\n\n\n/** \n * @class\n */\nozpIwc.BasicAuthentication=function() {\n\tthis.roles={};\n    var self = this;\n    ozpIwc.metrics.gauge('security.authentication.roles').set(function() {\n        return self.getRoleCount();\n    });\n};\n\n/**\n * Returns the number of roles currently defined\n * @returns {number} the number of roles defined\n */\nozpIwc.BasicAuthentication.prototype.getRoleCount=function() {\n    if (!this.roles || !Object.keys(this.roles)) {\n        return 0;\n    }\n    return Object.keys(this.roles).length;\n};\n\n/**\n * Returns the authenticated subject for the given credentials.\n * \n * <p>The preAuthenticatedSubject allows an existing subject to augment their\n * roles using credentials.  For example, PostMessageParticipants are\n * assigned a role equal to their origin, since the browser authoritatively\n * determines that.  The security module can then add additional roles based\n * upon configuration.\n * \n * @param {ozpIwc.security.Credentials} credentials\n * @param {ozpIwc.security.Subject} [preAuthenticatedSubject] - The pre-authenticated\n *   subject that is presenting these credentials.   \n * @returns {ozpIwc.AsyncAction} If the credentials are authenticated, the success handler receives\n *     the subject.\n */\nozpIwc.BasicAuthentication.prototype.login=function(credentials,preAuthenticatedSubject) {\n\tif(!credentials) {\n\t\tthrow \"Must supply credentials for login\";\n\t}\n\tvar action=new ozpIwc.AsyncAction();\n\t\n\tpreAuthenticatedSubject=preAuthenticatedSubject || [];\n\treturn action.resolve(\"success\",preAuthenticatedSubject);\n};\n\n",
    "var ozpIwc=ozpIwc || {};\n\n/** @typedef {string} ozpIwc.security.Role */\n\n/** @typedef {string} ozpIwc.security.Permission */\n\n/** @typedef { ozpIwc.security.Role[] } ozpIwc.security.Subject */\n\n/** \n * @typedef {object} ozpIwc.security.Actor \n * @property {ozpIwc.security.Subject} securityAttributes\n */\n\n\n/** \n * A simple Attribute-Based Access Control implementation\n * @todo Permissions are local to each peer.  Does this need to be synced?\n * \n * @class\n */\nozpIwc.BasicAuthorization=function(config) {\n    config=config || {};\n\tthis.roles={};\n    this.policies= config.policies || [\n//        ozpIwc.abacPolicies.permitAll\n        ozpIwc.abacPolicies.permitWhenObjectHasNoAttributes,\n        ozpIwc.abacPolicies.subjectHasAllObjectAttributes\n    ];\n\n    var self = this;\n    ozpIwc.metrics.gauge('security.authorization.roles').set(function() {\n        return self.getRoleCount();\n    });\n};\n/**\n * Returns the number of roles currently defined\n * @returns {number} the number of roles defined\n */\nozpIwc.BasicAuthorization.prototype.getRoleCount=function() {\n    if (!this.roles || !Object.keys(this.roles)) {\n        return 0;\n    }\n    return Object.keys(this.roles).length;\n};\n\n\nozpIwc.BasicAuthorization.prototype.implies=function(subjectVal,objectVal) {\n    // no object value is trivially true\n    if(objectVal===undefined || objectVal === null) {\n        return true;\n    }\n    // no subject value when there is an object value is trivially false\n    if(subjectVal===undefined || subjectVal === null) {\n        return false;\n    }\n    \n    // convert both to arrays, if necessary\n    subjectVal=Array.isArray(subjectVal)?subjectVal:[subjectVal];\n    objectVal=Array.isArray(objectVal)?objectVal:[objectVal];\n\n    // confirm that every element in objectVal is also in subjectVal\n    return ozpIwc.util.arrayContainsAll(subjectVal,objectVal);\n};\n\n\n/**\n * Confirms that the subject has all of the permissions requested.\n * @param {object} request\n * @returns {ozpIwc.AsyncAction}\n */\nozpIwc.BasicAuthorization.prototype.isPermitted=function(request) {\n\tvar action=new ozpIwc.AsyncAction();\n\t\n    var result=this.policies.some(function(policy) {\n        return policy.call(this,request)===\"permit\";\n    },this);\n    \n    \n    if(result) {\n        return action.resolve(\"success\");\n    } else {\n\t\treturn action.resolve('failure');\n    }\n};\n\n\nozpIwc.authorization=new ozpIwc.BasicAuthorization();",
    "/** @namespace **/\r\nvar ozpIwc = ozpIwc || {};\r\n\r\n/**\r\n * <p>This link connects peers using the HTML5 localstorage API.  It is a second generation version of\r\n * the localStorageLink that bypasses most of the garbage collection issues.\r\n *\r\n * <p> When a packet is sent, this link turns it to a string, creates a key with that value, and\r\n * immediately deletes it.  This still sends the storage event containing the packet as the key.\r\n * This completely eliminates the need to garbage collect the localstorage space, with the associated\r\n * mutex contention and full-buffer issues.\r\n *\r\n * @todo Compress the key\r\n *\r\n * @class\r\n * @param {Object} [config] - Configuration for this link\r\n * @param {ozpIwc.Peer} [config.peer=ozpIwc.defaultPeer] - The peer to connect to.\r\n * @param {string} [config.prefix='ozpIwc'] - Namespace for communicating, must be the same for all peers on the same network.\r\n * @param {string} [config.selfId] - Unique name within the peer network.  Defaults to the peer id.\r\n * @param {Number} [config.maxRetries] - Number of times packet transmission will retry if failed. Defaults to 6.\r\n * @param {Number} [config.queueSize] - Number of packets allowed to be queued at one time. Defaults to 1024.\r\n * @param {Number} [config.fragmentSize] - Size in bytes of which any TransportPacket exceeds will be sent in FragmentPackets.\r\n * @param {Number} [config.fragmentTime] - Time in milliseconds after a fragment is received and additional expected\r\n *                                         fragments are not received that the message is dropped.\r\n */\r\nozpIwc.KeyBroadcastLocalStorageLink = function (config) {\r\n    config = config || {};\r\n\r\n    this.prefix = config.prefix || 'ozpIwc';\r\n    this.peer = config.peer || ozpIwc.defaultPeer;\r\n    this.selfId = config.selfId || this.peer.selfId;\r\n    this.myKeysTimeout = config.myKeysTimeout || 5000; // 5 seconds\r\n    this.otherKeysTimeout = config.otherKeysTimeout || 2 * 60000; // 2 minutes\r\n    this.maxRetries = config.maxRetries || 6;\r\n    this.queueSize = config.queueSize || 1024;\r\n    this.sendQueue = this.sendQueue || [];\r\n    this.fragmentSize = config.fragmentSize || (5 * 1024 * 1024) / 2 / 2; //50% of 5mb, divide by 2 for utf-16 characters\r\n    this.fragmentTimeout = config.fragmentTimeout || 1000; // 1 second\r\n\r\n    //Add fragmenting capabilities\r\n    String.prototype.chunk = function (size) {\r\n        var res = [];\r\n        for (var i = 0; i < this.length; i += size) {\r\n            res.push(this.slice(i, i + size));\r\n        }\r\n        return res;\r\n    };\r\n\r\n    // Hook into the system\r\n    var self = this;\r\n    var packet;\r\n    var receiveStorageEvent = function (event) {\r\n        try {\r\n            packet = JSON.parse(event.key);\r\n        } catch (e) {\r\n            console.log(\"Parse error on \" + event.key);\r\n            ozpIwc.metrics.counter('links.keyBroadcastLocalStorage.packets.parseError').inc();\r\n            return;\r\n        }\r\n        if (packet.data.fragment) {\r\n            self.handleFragment(packet);\r\n        } else {\r\n            self.peer.receive(self.linkId, packet);\r\n            ozpIwc.metrics.counter('links.keyBroadcastLocalStorage.packets.received').inc();\r\n        }\r\n    };\r\n    window.addEventListener('storage', receiveStorageEvent, false);\r\n\r\n    this.peer.on(\"send\", function (event) {\r\n        self.send(event.packet);\r\n    });\r\n\r\n    this.peer.on(\"beforeShutdown\", function () {\r\n        window.removeEventListener('storage', receiveStorageEvent);\r\n    }, this);\r\n\r\n};\r\n\r\n/**\r\n * @typedef ozpIwc.FragmentPacket\r\n * @property {boolean} fragment - Flag for knowing this is a fragment packet. Should be true.\r\n * @property {Number} msgId - The msgId from the TransportPacket broken up into fragments.\r\n * @property {Number} id - The position amongst other fragments of the TransportPacket.\r\n * @property {Number} total - Total number of fragments of the TransportPacket expected.\r\n * @property {String} chunk - A segment of the TransportPacket in string form.\r\n *\r\n */\r\n\r\n/**\r\n * @typedef ozpIwc.FragmentStore\r\n * @property {Number} sequence - The sequence of the latest fragment received.\r\n * @property {Number} total - The total number of fragments expected.\r\n * @property {String} src_peer - The src_peer of the fragments expected.\r\n * @property {Array(String)} chunks - String segments of the TransportPacket.\r\n */\r\n\r\n/**\r\n * Handles fragmented packets received from the router. When all fragments of a message have been received,\r\n * the resulting packet will be passed on to the registered peer of the KeyBroadcastLocalStorageLink.\r\n * @param {ozpIwc.NetworkPacket} packet - NetworkPacket containing an ozpIwc.FragmentPacket as its data property\r\n */\r\nozpIwc.KeyBroadcastLocalStorageLink.prototype.handleFragment = function (packet) {\r\n    // Check to make sure the packet is a fragment and we haven't seen it\r\n    if (this.peer.haveSeen(packet)) {\r\n        return;\r\n    }\r\n\r\n    var key = packet.data.msgId;\r\n\r\n    this.storeFragment(packet);\r\n\r\n    var defragmentedPacket = this.defragmentPacket(this.fragments[key]);\r\n\r\n    if (defragmentedPacket) {\r\n\r\n        // clear the fragment timeout\r\n        window.clearTimeout(this.fragments[key].fragmentTimer);\r\n\r\n        // Remove the last sequence from the known packets to reuse it for the defragmented packet\r\n        var packetIndex = this.peer.packetsSeen[defragmentedPacket.src_peer].indexOf(defragmentedPacket.sequence);\r\n        delete this.peer.packetsSeen[defragmentedPacket.src_peer][packetIndex];\r\n\r\n        this.peer.receive(this.linkId, defragmentedPacket);\r\n        ozpIwc.metrics.counter('links.keyBroadcastLocalStorage.packets.received').inc();\r\n\r\n        delete this.fragments[key];\r\n    }\r\n};\r\n\r\n/**\r\n *  Stores a received fragment. When the first fragment of a message is received, a timer is set to destroy the storage\r\n *  of the message fragments should not all messages be received.\r\n * @param {ozpIwc.NetworkPacket} packet - NetworkPacket containing an ozpIwc.FragmentPacket as its data property\r\n * @returns {boolean} result - true if successful.\r\n */\r\nozpIwc.KeyBroadcastLocalStorageLink.prototype.storeFragment = function (packet) {\r\n    if (!packet.data.fragment) {\r\n        return null;\r\n    }\r\n\r\n    this.fragments = this.fragments || [];\r\n    // NetworkPacket properties\r\n    var sequence = packet.sequence;\r\n    var src_peer = packet.src_peer;\r\n    // FragmentPacket Properties\r\n    var key = packet.data.msgId;\r\n    var id = packet.data.id;\r\n    var chunk = packet.data.chunk;\r\n    var total = packet.data.total;\r\n\r\n    if (key === undefined || id === undefined) {\r\n        return null;\r\n    }\r\n\r\n    // If this is the first fragment of a message, add the storage object\r\n    if (!this.fragments[key]) {\r\n        this.fragments[key] = {};\r\n        this.fragments[key].chunks = [];\r\n\r\n        var self = this;\r\n        self.key = key;\r\n        self.total = total ;\r\n\r\n        // Add a timeout to destroy the fragment should the whole message not be received.\r\n        this.fragments[key].timeoutFunc = function () {\r\n            ozpIwc.metrics.counter('network.packets.dropped').inc();\r\n            ozpIwc.metrics.counter('network.fragments.dropped').inc(self.total );\r\n            delete self.fragments[self.key];\r\n        };\r\n    }\r\n\r\n    // Restart the fragment drop countdown\r\n    window.clearTimeout(this.fragments[key].fragmentTimer);\r\n    this.fragments[key].fragmentTimer = window.setTimeout(this.fragments[key].timeoutFunc, this.fragmentTimeout);\r\n\r\n    // keep a copy of properties needed for defragmenting, the last sequence & src_peer received will be\r\n    // reused in the defragmented packet\r\n    this.fragments[key].total = total || this.fragments[key].total ;\r\n    this.fragments[key].sequence = (sequence !== undefined) ? sequence : this.fragments[key].sequence;\r\n    this.fragments[key].src_peer = src_peer || this.fragments[key].src_peer;\r\n    this.fragments[key].chunks[id] = chunk;\r\n\r\n    // If the necessary properties for defragmenting aren't set the storage fails\r\n    if (this.fragments[key].total === undefined || this.fragments[key].sequence === undefined ||\r\n        this.fragments[key].src_peer === undefined) {\r\n        return null;\r\n    } else {\r\n        ozpIwc.metrics.counter('links.keyBroadcastLocalStorage.fragments.received').inc();\r\n        return true;\r\n    }\r\n};\r\n\r\n/**\r\n * Rebuilds the original packet sent across the keyBroadcastLocalStorageLink from the fragments it was broken up into.\r\n * @param {ozpIwc.FragmentStore} fragments - the grouping of fragments to reconstruct\r\n * @returns {ozpIwc.NetworkPacket} result - the reconstructed NetworkPacket with TransportPacket as its data property.\r\n */\r\nozpIwc.KeyBroadcastLocalStorageLink.prototype.defragmentPacket = function (fragments) {\r\n    if (fragments.total != fragments.chunks.length) {\r\n        return null;\r\n    }\r\n    try {\r\n        var result = JSON.parse(fragments.chunks.join(''));\r\n        return {\r\n            defragmented: true,\r\n            sequence: fragments.sequence,\r\n            src_peer: fragments.src_peer,\r\n            data: result\r\n        };\r\n    } catch (e) {\r\n        return null;\r\n    }\r\n};\r\n\r\n/**\r\n * <p>Publishes a packet to other peers.\r\n * <p>If the sendQueue is full (KeyBroadcastLocalStorageLink.queueSize) send will not occur.\r\n * <p>If the TransportPacket is too large (KeyBroadcastLocalStorageLink.fragmentSize) ozpIwc.FragmentPacket's will\r\n *    be sent instead.\r\n *\r\n * @class\r\n * @param {ozpIwc.NetworkPacket} - packet\r\n */\r\nozpIwc.KeyBroadcastLocalStorageLink.prototype.send = function (packet) {\r\n    var str = JSON.stringify(packet.data);\r\n\r\n    if (str.length < this.fragmentSize) {\r\n        this.queueSend(packet);\r\n    } else {\r\n        var fragments = str.chunk(this.fragmentSize);\r\n\r\n        // Use the original packet as a template, delete the data and\r\n        // generate new packets.\r\n        var self = this;\r\n        self.data= packet.data;\r\n        delete packet.data;\r\n\r\n        var fragmentGen = function (chunk, template) {\r\n\r\n            template.sequence = self.peer.sequenceCounter++;\r\n            template.data = {\r\n                fragment: true,\r\n                msgId: self.data.msgId,\r\n                id: i,\r\n                total: fragments.length,\r\n                chunk: chunk\r\n            };\r\n            return template;\r\n        };\r\n\r\n        // Generate & queue the fragments\r\n        for (var i = 0; i < fragments.length; i++) {\r\n            this.queueSend(fragmentGen(fragments[i], packet));\r\n        }\r\n    }\r\n};\r\n\r\nozpIwc.KeyBroadcastLocalStorageLink.prototype.queueSend = function (packet) {\r\n    if (this.sendQueue.length < this.queueSize) {\r\n        this.sendQueue = this.sendQueue.concat(packet);\r\n        while (this.sendQueue.length > 0) {\r\n            this.attemptSend(this.sendQueue.shift());\r\n        }\r\n    } else {\r\n        ozpIwc.metrics.counter('links.keyBroadcastLocalStorage.packets.failed').inc();\r\n        ozpIwc.log.error(\"Failed to write packet(len=\" + packet.length + \"):\" + \" Send queue full.\");\r\n    }\r\n};\r\n\r\n/**\r\n * <p> Recursively tries sending the packet (KeyBroadcastLocalStorageLink.maxRetries) times\r\n * The packet is dropped and the send fails after reaching max attempts.\r\n *\r\n * @class\r\n * @param {ozpIwc.NetworkPacket} - packet\r\n * @param {Number} [attemptCount] - number of times attempted to send packet.\r\n */\r\nozpIwc.KeyBroadcastLocalStorageLink.prototype.attemptSend = function (packet, retryCount) {\r\n\r\n    var sendStatus = this.sendImpl(packet);\r\n    if (sendStatus) {\r\n        var self = this;\r\n        retryCount = retryCount || 0;\r\n        var timeOut = Math.max(1, Math.pow(2, (retryCount - 1))) - 1;\r\n\r\n        if (retryCount < self.maxRetries) {\r\n            retryCount++;\r\n            // Call again but back off for an exponential amount of time.\r\n            window.setTimeout(function () {\r\n                self.attemptSend(packet, retryCount);\r\n            }, timeOut);\r\n        } else {\r\n            ozpIwc.metrics.counter('links.keyBroadcastLocalStorage.packets.failed').inc();\r\n            ozpIwc.log.error(\"Failed to write packet(len=\" + packet.length + \"):\" + sendStatus);\r\n            return sendStatus;\r\n        }\r\n    }\r\n};\r\n\r\n/**\r\n * <p>Implementation of publishing packets to peers through localStorage.\r\n * <p>If the localStorage is full or a write collision occurs, the send will not occur.\r\n * <p>Returns status of localStorage write, null if success.\r\n *\r\n * @todo move counter.inc() out of the impl and handle in attemptSend?\r\n *\r\n * @class\r\n * @param {ozpIwc.NetworkPacket} - packet\r\n */\r\nozpIwc.KeyBroadcastLocalStorageLink.prototype.sendImpl = function (packet) {\r\n    var sendStatus;\r\n    try {\r\n        var p = JSON.stringify(packet);\r\n        localStorage.setItem(p, \"\");\r\n        ozpIwc.metrics.counter('links.keyBroadcastLocalStorage.packets.sent').inc();\r\n        localStorage.removeItem(p);\r\n        sendStatus = null;\r\n    }\r\n    catch (e) {\r\n        sendStatus = e;\r\n    }\r\n    finally {\r\n        return sendStatus;\r\n    }\r\n};\r\n",
    "/** @namespace **/\r\nvar ozpIwc = ozpIwc || {};\r\n\r\n/**\r\n * <p>This link connects peers using the HTML5 localstorage API.  It handles cleaning up\r\n * the buffer, depduplication of sends, and other trivia.\r\n * \r\n * <p>Individual local storage operations are atomic, but there are no consistency\r\n * gaurantees between multiple calls.  This means a read, modify, write operation may\r\n * create race conditions.  The LocalStorageLink addresses the concurrency problem without\r\n * locks by only allowing creation, read, and delete operations.\r\n * \r\n * <p>Each packet is written to it's own key/value pair in local storage.  The key is the\r\n * of the form \"${prefix}|${selfId}|${timestamp}\".  Each LocalStorageLink owns the lifecycle\r\n * of packets it creates.\r\n * \r\n * For senders:\r\n * <ol>\r\n *   <li> Write a new packet.\r\n *   <li> Wait config.myKeysTimeout milliseconds.\r\n *   <li> Delete own packets where the timestamp is expired.\r\n * </ol>\r\n * \r\n * For receivers:\r\n * <ol>\r\n *   <li> Receive a \"storage\" event containing the new key.\r\n *   <li> Reads the packets from local storage.\r\n * </ol>\r\n * \r\n * <p>The potential race condition is if the packet is deleted before the receiver\r\n * can read it.  In this case, the packet is simply considered lost, but no inconsistent\r\n * data will be read.\r\n * \r\n * <p>Links are responsible for their own packets, but each will clean up other link's packets\r\n * on a much larger expiration window (config.otherKeysTimeout).  Race conditions between\r\n * multiple links interleaving the lockless \"list keys\" and \"delete item\" sequence generates\r\n * a consistent postcondition-- the key will not exist.\r\n * \r\n * @class\r\n * @param {Object} [config] - Configuration for this link\r\n * @param {ozpIwc.Peer} [config.peer=ozpIwc.defaultPeer] - The peer to connect to.\r\n * @param {Number} [config.myKeysTimeout=5000] - Milliseconds to wait before deleting this link's keys.\r\n * @param {Number} [config.otherKeysTimeout=120000] - Milliseconds to wait before cleaning up other link's keys\r\n * @param {string} [config.prefix='ozpIwc'] - Namespace for communicating, must be the same for all peers on the same network.\r\n * @param {string} [config.selfId] - Unique name within the peer network.  Defaults to the peer id.\r\n */\r\nozpIwc.LocalStorageLink = function(config) {\r\n\tconfig=config || {};\r\n\r\n\tthis.prefix=config.prefix || 'ozpIwc';\r\n\tthis.peer=config.peer || ozpIwc.defaultPeer;\r\n\tthis.selfId=config.selfId || this.peer.selfId;\r\n\tthis.myKeysTimeout = config.myKeysTimeout || 5000; // 5 seconds\r\n\tthis.otherKeysTimeout = config.otherKeysTimeout || 2*60000; // 2 minutes\r\n\r\n  // Hook into the system\r\n\tvar self=this;\r\n\t\r\n\tvar receiveStorageEvent=function(event) {\r\n\t\tvar key=self.splitKey(event.key);\r\n\t\tif(key) {\r\n\t\t\tvar packet=JSON.parse(localStorage.getItem(event.key));\r\n\r\n\t\t\tif(!packet) {\r\n\t\t\t\tozpIwc.metrics.counter('links.localStorage.packets.vanished').inc();\r\n\t\t\t} else if(typeof(packet) !== \"object\") {\r\n\t\t\t\tozpIwc.metrics.counter('links.localStorage.packets.notAnObject').inc();\r\n\t\t\t} else {\r\n\t\t\t\tozpIwc.metrics.counter('links.localStorage.packets.receive').inc();\r\n\t\t\t\tself.peer.receive(self.linkId,packet);\r\n\t\t\t} \r\n\t\t};\r\n\t};\r\n\twindow.addEventListener('storage',receiveStorageEvent , false); \r\n\t\r\n\tthis.peer.on(\"send\",function(event) { \r\n\t\tself.send(event.packet); \r\n\t});\r\n\t\r\n\tthis.peer.on(\"beforeShutdown\",function() {\r\n\t\tself.cleanKeys();\r\n\t\twindow.removeEventListener('storage',receiveStorageEvent);\r\n\t},this);\r\n\t\r\n\twindow.setInterval(function() {\r\n\t\tself.cleanKeys();\r\n\t},250); \r\n\r\n\r\n\t// METRICS\r\n\tozpIwc.metrics.gauge('links.localStorage.buffer').set(function() {\r\n\t\tvar\tstats= {\r\n\t\t\t\t\tused: 0,\r\n\t\t\t\t\tmax: 5 *1024 * 1024,\r\n\t\t\t\t\tbufferLen: 0,\r\n\t\t\t\t\tpeerUsage: {},\r\n\t\t\t\t\tpeerPackets: {}\r\n\t\t\t\t\t\r\n\t\t};\r\n\t\tfor(var i=0; i < localStorage.length;++i) {\r\n\t\t\tvar k=localStorage.key(i);\r\n\t\t\tvar v=localStorage.getItem(k);\r\n\t\t\t\r\n\t\t\tvar size=v.length*2;\r\n\t\t\tvar oldKeyTime = ozpIwc.util.now() - this.myKeysTimeout;\r\n\r\n\t\t\tstats.used+=size;\r\n\t\t\t\r\n\t\t\tvar key=self.splitKey(k);\r\n\t\t\tif(key) {\r\n\t\t\t\tstats.peerUsage[key.id] = stats.peerUsage[key.id]?(stats.peerUsage[key.id]+size):size;\r\n\t\t\t\tstats.peerPackets[key.id] = stats.peerPackets[key.id]?(stats.peerPackets[key.id]+1):1;\r\n\t\t\t\tstats.bufferLen++;\r\n\t\t\t\tif(key.createdAt < oldKeyTime) {\r\n\t\t\t\t\tstats.oldKeysCount++;\r\n\t\t\t\t\tstats.oldKeysSize+=size;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\t\r\n\t\treturn stats;\r\n\t});\r\n};\r\n\r\n/**\r\n * Creates a key for the message in localStorage\r\n * @todo Is timestamp granular enough that no two packets can come in at the same time?\r\n * @returns {string} a new key\r\n */\r\nozpIwc.LocalStorageLink.prototype.makeKey=function(sequence) { \r\n\treturn [this.prefix,this.selfId,ozpIwc.util.now(),sequence].join('|');\r\n};\r\n\r\n/**\r\n * If it's a key for a buffered message, split it into the id of the \r\n * link that put it here and the time it was created at.\r\n * @param {type} k The key to split\r\n * @returns {object} The id and createdAt for the key if it's valid, otherwise null.\r\n */\r\nozpIwc.LocalStorageLink.prototype.splitKey=function(k) { \r\n\tvar parts=k.split(\"|\");\r\n\tif(parts.length===4 && parts[0]===this.prefix) {\r\n\t\treturn { id: parts[1], createdAt: parseInt(parts[2]) };\r\n\t}\t\r\n\treturn null;\r\n};\r\n\r\n/**\r\n * Goes through localStorage and looks for expired packets.  Packets owned\r\n * by this link are removed if they are older than myKeysTimeout.  Other\r\n * keys are cleaned if they are older than otherKeysTimeout.\r\n * @todo Coordinate expiration windows.\r\n * @returns {undefined}\r\n */\r\nozpIwc.LocalStorageLink.prototype.cleanKeys=function() {\r\n\tvar now=ozpIwc.util.now();\r\n\tvar myKeyExpiration = now - this.myKeysTimeout;\r\n\tvar otherKeyExpiration = now - this.otherKeysTimeout;\r\n\r\n\tfor(var i=0; i < localStorage.length;++i) {\r\n\t\tvar keyName=localStorage.key(i);\r\n\t\tvar k=this.splitKey(keyName);\r\n\t\tif(k) {\r\n\t\t\tif((k.id===this.selfId && k.createdAt <= myKeyExpiration) \r\n\t\t\t\t\t|| (k.createdAt <= otherKeyExpiration)) {\r\n\t\t\t\tlocalStorage.removeItem(keyName);\r\n\t\t\t}\t\t\t\t\r\n\t\t}\r\n\t};\r\n\r\n\r\n};\r\n/**\r\n * Publishes a packet to other peers.\r\n * @todo Handle local storage being full.\r\n * @param {ozpIwc.NetworkPacket} packet\r\n */\r\nozpIwc.LocalStorageLink.prototype.send=function(packet) { \r\n\tlocalStorage.setItem(this.makeKey(packet.sequence),JSON.stringify(packet));\r\n\tozpIwc.metrics.counter('links.localStorage.packets.sent').inc();\r\n\tvar self=this;\r\n\r\n};\r\n\r\n",
    "var ozpIwc=ozpIwc || {};\r\n\r\n/**\r\n * @typedef ozpIwc.NetworkPacket\r\n * @property {string} src_peer - The id of the peer who broadcast this packet.\r\n * @property {string} sequence - A monotonically increasing, unique identifier for this packet.\r\n * @property {object} data - The payload of this packet.\r\n */\r\n\r\n/**\r\n * @event ozpIwc.Peer#receive\r\n * The peer has received a packet from other peers.\r\n * @property {ozpIwc.NetworkPacket} packet\r\n * @property {string} linkId\r\n */\r\n\r\n\r\n/**\r\n * @event ozpIwc.Peer#preSend\r\n * A cancelable event that allows listeners to override the forwarding of\r\n * a given packet to other peers.\r\n * @extends ozpIwc.CancelableEvent\r\n * @property {ozpIwc.NetworkPacket} packet\r\n */\r\n\r\n/**\r\n * @event ozpIwc.Peer#send\r\n * Notifies that a packet is being sent to other peers.  Links should use this\r\n * event to forward packets to other peers.\r\n * @property {ozpIwc.NetworkPacket} packet\r\n */\r\n\r\n/**\r\n * @event ozpIwc.Peer#beforeShutdown\r\n * Fires when the peer is being explicitly or implicitly shut down.\r\n */\r\n\r\n/**\r\n * The peer handles low-level broadcast communications between multiple browser contexts.\r\n * Links do the actual work of moving the packet to other browser contexts.  The links\r\n * call @{link ozpIwc.Peer#receive} when they need to deliver a packet to this peer and hook\r\n * the @{link event:ozpIwc.Peer#send} event in order to send packets.\r\n * @class\r\n */\r\nozpIwc.Peer=function() {\r\n\r\n    // generate a random 4 byte id\r\n    this.selfId=ozpIwc.util.generateId();\r\n\r\n    // unique ids for all packets sent by this peer\r\n    this.sequenceCounter=0;\r\n\r\n    // track which packets are seen from each peer\r\n    // key is the name of the peer\r\n    // value is an array that contains the last 50 ids seen\r\n    this.packetsSeen={};\r\n\r\n    this.knownPeers={};\r\n\r\n    this.events=new ozpIwc.Event();\r\n    this.events.mixinOnOff(this);\r\n\r\n    var self=this;\r\n\r\n    // Shutdown handling\r\n    this.unloadListener=function() {\r\n        self.shutdown();\r\n    };\r\n    window.addEventListener('beforeunload',this.unloadListener);\r\n\r\n};\r\n\r\nozpIwc.Peer.maxSeqIdPerSource=500;\r\n\r\n/**\r\n * Helper to determine if we've seen this packet before\r\n * @param {ozpIwc.NetworkPacket} packet\r\n * @returns {boolean}\r\n */\r\nozpIwc.Peer.prototype.haveSeen=function(packet) {\r\n    // don't forward our own packets\r\n    if (packet.src_peer === this.selfId) {\r\n        ozpIwc.metrics.counter('network.packets.droppedOwnPacket').inc();\r\n        return true;\r\n    }\r\n    var seen = this.packetsSeen[packet.src_peer];\r\n    if (!seen) {\r\n        seen = this.packetsSeen[packet.src_peer] = [];\r\n    }\r\n\r\n    // abort if we've seen the packet before\r\n    if (seen.indexOf(packet.sequence) >= 0) {\r\n        return true;\r\n    }\r\n\r\n    //remove oldest array members when truncate needed\r\n    seen.unshift(packet.sequence);\r\n    if (seen.length >= ozpIwc.Peer.maxSeqIdPerSource) {\r\n        seen.length = ozpIwc.Peer.maxSeqIdPerSource;\r\n    }\r\n    return false;\r\n};\r\n\r\n/**\r\n * Used by routers to broadcast a packet to network\r\n * @fires ozpIwc.Peer#preSend\r\n * @fires ozpIwc.Peer#send\r\n * @param {ozpIwc.NetworkPacket} packet\r\n */\r\nozpIwc.Peer.prototype.send= function(packet) {\r\n    var networkPacket={\r\n        src_peer: this.selfId,\r\n        sequence: this.sequenceCounter++,\r\n        data: packet\r\n    };\r\n\r\n    var preSendEvent=new ozpIwc.CancelableEvent({'packet': networkPacket});\r\n\r\n    this.events.trigger(\"preSend\",preSendEvent);\r\n    if(!preSendEvent.canceled) {\r\n        ozpIwc.metrics.counter('network.packets.sent').inc();\r\n        this.events.trigger(\"send\",{'packet':networkPacket});\r\n    } else {\r\n        ozpIwc.metrics.counter('network.packets.sendRejected').inc();\r\n    }\r\n};\r\n\r\n/**\r\n * Called by the links when a new packet is recieved.\r\n * @fires ozpIwc.Peer#receive\r\n * @param {string} linkId\r\n * @param {ozpIwc.NetworkPacket} packet\r\n * @returns {unresolved}\r\n */\r\nozpIwc.Peer.prototype.receive=function(linkId,packet) {\r\n    // drop it if we've seen it before\r\n    if(this.haveSeen(packet)) {\r\n        ozpIwc.metrics.counter('network.packets.dropped').inc();\r\n        return;\r\n    }\r\n    ozpIwc.metrics.counter('network.packets.received').inc();\r\n    this.events.trigger(\"receive\",{'packet':packet,'linkId': linkId});\r\n};\r\n\r\n/**\r\n * Explicitly shuts down the peer.\r\n * @fires ozpIwc.Peer#send\r\n */\r\nozpIwc.Peer.prototype.shutdown=function() {\r\n    this.events.trigger(\"beforeShutdown\");\r\n    window.removeEventListener('beforeunload',this.unloadListener);\r\n};\r\n\r\n\t\t\t",
    "var ozpIwc=ozpIwc || {};\n\n/**\n * @class\n * @mixes ozpIwc.security.Actor\n * @property {string} address - The assigned address to this address.\n * @property {ozpIwc.security.Subject} securityAttributes - The security attributes for this participant.\n */\nozpIwc.Participant=function() {\n    this.events=new ozpIwc.Event();\n\tthis.events.mixinOnOff(this);\n\tthis.securityAttributes={};\n    this.msgId=0;\n    var fakeMeter=new ozpIwc.metricTypes.Meter();\n    this.sentPacketsMeter=fakeMeter;\n    this.receivedPacketsMeter=fakeMeter;\n    this.forbiddenPacketsMeter=fakeMeter;\n    \n    this.participantType=this.constructor.name;\n    this.heartBeatContentType=\"application/ozpIwc-address-v1+json\";\n    this.heartBeatStatus={\n        name: this.name,\n        type: this.participantType || this.constructor.name\n    };\n};\n\n/**\n * @param {ozpIwc.PacketContext} packetContext\n * @returns {boolean} true if this packet could have additional recipients\n */\nozpIwc.Participant.prototype.receiveFromRouter=function(packetContext) {\n    var self = this;\n    ozpIwc.authorization.isPermitted({\n        'subject': this.securityAttributes,\n        'object': packetContext.packet.permissions\n    })\n        .success(function(){\n            self.receivedPacketsMeter.mark();\n\n            self.receiveFromRouterImpl(packetContext);\n        })\n        .failure(function() {\n            /** @todo do we send a \"denied\" message to the destination?  drop?  who knows? */\n            self.forbiddenPacketsMeter.mark();\n        });\n};\n\n/**\n * Overridden by inherited Participants.\n * @override\n * @param packetContext\n * @returns {boolean}\n */\nozpIwc.Participant.prototype.receiveFromRouterImpl = function (packetContext) {\n    // doesn't really do anything other than return a bool and prevent \"unused param\" warnings\n    return !packetContext;\n};\n/**\n * @param {ozpIwc.Router} router\n * @param {string} address\n * @returns {boolean} true if this packet could have additional recipients\n */\nozpIwc.Participant.prototype.connectToRouter=function(router,address) {\n    this.address=address;\n    this.router=router;\n    this.securityAttributes.rawAddress=address;\n    this.msgId=0;\n    this.metricRoot=\"participants.\"+ this.address.split(\".\").reverse().join(\".\");\n    this.sentPacketsMeter=ozpIwc.metrics.meter(this.metricRoot,\"sentPackets\").unit(\"packets\");\n    this.receivedPacketsMeter=ozpIwc.metrics.meter(this.metricRoot,\"receivedPackets\").unit(\"packets\");\n    this.forbiddenPacketsMeter=ozpIwc.metrics.meter(this.metricRoot,\"forbiddenPackets\").unit(\"packets\");\n    \n    this.namesResource=\"/address/\"+this.address;\n    this.heartBeatStatus.address=this.address;\n    this.heartBeatStatus.name=this.name;\n    this.heartBeatStatus.type=this.participantType || this.constructor.name;\n\n    this.events.trigger(\"connectedToRouter\");\n};\n\n/**\n * Populates fields relevant to this packet if they aren't already set:\n * src, ver, msgId, and time.\n * @param {ozpIwc.TransportPacket} packet\n * @returns {ozpIwc.TransportPacket}\n */\nozpIwc.Participant.prototype.fixPacket=function(packet) {\n    // clean up the packet a bit on behalf of the sender\n    packet.src=packet.src || this.address;\n    packet.ver = packet.ver || 1;\n\n    // if the packet doesn't have a msgId, generate one\n    packet.msgId = packet.msgId || this.generateMsgId();\n\n    // might as well be helpful and set the time, too\n    packet.time = packet.time || ozpIwc.util.now();\n    return packet;\n};\n\n/**\n * Sends a packet to this participants router.  Calls fixPacket\n * before doing so.\n * @param {ozpIwc.TransportPacket} packet\n * @returns {ozpIwc.TransportPacket}\n */\nozpIwc.Participant.prototype.send=function(packet) {\n    packet=this.fixPacket(packet);\n    this.sentPacketsMeter.mark();\n    this.router.send(packet,this);\n    return packet;\n};\n\n\nozpIwc.Participant.prototype.generateMsgId=function() {\n    return \"i:\" + this.msgId++;\n};\n\nozpIwc.Participant.prototype.heartbeat=function() {\n    if(this.router) {\n        this.send({\n            'dst': \"names.api\",\n            'resource': this.namesResource,\n            'action' : \"set\",\n            'entity' : this.heartBeatStatus,\n            'contentType' : this.heartBeatContentType\n        },function() {/* eat the response*/});\n    }\n};",
    "\nozpIwc.InternalParticipant=ozpIwc.util.extend(ozpIwc.Participant,function(config) {\n    config=config || {};\n\tozpIwc.Participant.apply(this,arguments);\n\tthis.replyCallbacks={};\n\tthis.participantType=\"internal\";\n\tthis.name=config.name;\n\n    var self = this;\n    this.on(\"connectedToRouter\",function() {\n        ozpIwc.metrics.gauge(self.metricRoot,\"registeredCallbacks\").set(function() {\n            return self.getCallbackCount();\n        });\n    });\n});\n\n/**\n * Gets the count of the registered reply callbacks\n * @returns {number} the number of registered callbacks\n */\nozpIwc.InternalParticipant.prototype.getCallbackCount=function() {\n    if (!this.replyCallbacks | !Object.keys(this.replyCallbacks)) {\n        return 0;\n    }\n    return Object.keys(this.replyCallbacks).length;\n};\n\n/**\n * @param {ozpIwc.PacketContext} packetContext\n * @returns {boolean} true if this packet could have additional recipients\n */\nozpIwc.InternalParticipant.prototype.receiveFromRouterImpl=function(packetContext) {\n\tvar packet=packetContext.packet;\n\tif(packet.replyTo && this.replyCallbacks[packet.replyTo]) {\n\t\tif (!this.replyCallbacks[packet.replyTo](packet)) {\n            this.cancelCallback(packet.replyTo);\n        }\n\t} else {\n\t\tthis.events.trigger(\"receive\",packetContext);\n\t}\n};\n\n\nozpIwc.InternalParticipant.prototype.send=function(originalPacket,callback) {\n    var packet=this.fixPacket(originalPacket);\n\tif(callback) {\n\t\tthis.replyCallbacks[packet.msgId]=callback;\n\t}\n    var self=this;\n\tozpIwc.util.setImmediate(function() {\n        ozpIwc.Participant.prototype.send.call(self,packet);\n    });\n\n\treturn packet;\n};\n\nozpIwc.InternalParticipant.prototype.cancelCallback=function(msgId) {\n    var success=false;\n    if (msgId) {\n        delete this.replyCallbacks[msgId];\n        success=true;\n    }\n    return success;\n};\n",
    "var ozpIwc=ozpIwc || {};\r\n\r\n/**\r\n * @typedef ozpIwc.TransportPacket\r\n * @property {string} src - The participant address that sent this packet\r\n * @property {string} dst - The intended recipient of this packet\r\n * @property {Number} ver - Protocol Version.  Should be 1\r\n * @property {Number} msgId - A unique id for this packet.\r\n * @property {object} entity - The payload of this packet.\r\n * @property {object} [permissions] - Permissions required to see the payload of this packet.\r\n * @property {Number} [time] - The time in milliseconds since epoch that this packet was created.\r\n * @property {Number} [replyTo] - Reference to the msgId that this is in reply to.\r\n * @property {string} [action] - Action to be performed.\r\n * @property {string} [resource] - Resource to perform the action upon.\r\n * @property {boolean} [test] - Marker for test packets.\r\n */\r\n\r\n/**\r\n * @class\r\n * @param {object} config\r\n * @param {ozpIwc.TransportPacket} config.packet\r\n * @param {ozpIwc.Router} config.router\r\n * @param {ozpIwc.Participant} [config.srcParticpant]\r\n * @param {ozpIwc.Participant} [config.dstParticpant]\r\n * @property {ozpIwc.TransportPacket} packet\r\n * @property {ozpIwc.Router} router\r\n * @property {ozpIwc.Participant} [srcParticpant]\r\n * @property {ozpIwc.Participant} [dstParticpant]\r\n */\r\nozpIwc.TransportPacketContext=function(config) {\r\n    for(var i in config) {\r\n        this[i]=config[i];\r\n    }\r\n};\r\n\r\n/**\r\n *\r\n * @param {ozpIwc.TransportPacket} response\r\n * @returns {ozpIwc.TransportPacket} the packet that was sent\r\n */\r\nozpIwc.TransportPacketContext.prototype.replyTo=function(response) {\r\n    var now=new Date().getTime();\r\n    response.ver = response.ver || 1;\r\n    response.time = response.time || now;\r\n    response.replyTo=response.replyTo || this.packet.msgId;\r\n    response.src=response.src || this.packet.dst;\r\n    response.dst=response.dst || this.packet.src;\r\n    if(this.dstParticipant) {\r\n        this.dstParticipant.send(response);\r\n    } else{\r\n        response.msgId = response.msgId || now;\r\n        this.router.send(response);\r\n    }\r\n    return response;\r\n};\r\n\r\n/**\r\n * @event ozpIwc.Router#preRegisterParticipant\r\n * @mixes ozpIwc.CancelableEvent\r\n * @property {ozpIwc.TransportPacket} [packet] - The packet to be delivered\r\n * @property {object} registration - Information provided by the participant about it's registration\r\n * @property {ozpIwc.Participant} participant - The participant that will receive the packet\r\n */\r\n\r\n/**\r\n * @event ozpIwc.Router#preSend\r\n * @mixes ozpIwc.CancelableEvent\r\n * @property {ozpIwc.TransportPacket} packet - The packet to be sent\r\n * @property {ozpIwc.Participant} participant - The participant that sent the packet\r\n */\r\n\r\n/**\r\n * @event ozpIwc.Router#preDeliver\r\n * @mixes ozpIwc.CancelableEvent\r\n * @property {ozpIwc.TransportPacket} packet - The packet to be delivered\r\n * @property {ozpIwc.Participant} participant - The participant that will receive the packet\r\n */\r\n\r\n/**\r\n * @event ozpIwc.Router#send\r\n * @property {ozpIwc.TransportPacket} packet - The packet to be delivered\r\n */\r\n\r\n/**\r\n * @event ozpIwc.Router#prePeerReceive\r\n * @mixes ozpIwc.CancelableEvent\r\n * @property {ozpIwc.TransportPacket} packet\r\n * @property {ozpIwc.NetworkPacket} rawPacket\r\n */\r\n\r\n/**\r\n * @class\r\n * @param {object} [config]\r\n * @param {ozpIwc.Peer} [config.peer=ozpIwc.defaultPeer]\r\n */\r\nozpIwc.Router=function(config) {\r\n    config=config || {};\r\n    this.peer=config.peer || ozpIwc.defaultPeer;\r\n\r\n//\tthis.nobodyAddress=\"$nobody\";\r\n//\tthis.routerControlAddress='$transport';\r\n\tvar self=this;\r\n\r\n\tthis.self_id=ozpIwc.util.generateId();\r\n\t\r\n\t// Stores all local addresses\r\n\tthis.participants={};\r\n\t\r\n\tozpIwc.metrics.gauge(\"transport.participants\").set(function() {\r\n\t\treturn Object.keys(self.participants).length;\r\n\t});\r\n\r\n\tthis.events=new ozpIwc.Event();\r\n\tthis.events.mixinOnOff(this);\r\n\t\r\n\t// Wire up to the peer\r\n\tthis.peer.on(\"receive\",function(event) {\r\n\t\tself.receiveFromPeer(event.packet);\r\n\t});\r\n\t\r\n\tvar checkFormat=function(event) {\r\n\t\tvar message=event.packet;\r\n\t\tif(message.ver !== 1) {\r\n\t\t\tevent.cancel(\"badVersion\");\r\n\t\t}\r\n\t\tif(!message.src) {\r\n\t\t\tevent.cancel(\"nullSource\");\r\n\t\t}\r\n\t\tif(!message.dst) {\r\n\t\t\tevent.cancel(\"nullDestination\");\r\n\t\t}\r\n\t\tif(event.canceled) {\r\n\t\t\tozpIwc.metrics.counter(\"transport.packets.invalidFormat\").inc();\r\n\t\t}\r\n\t};\r\n\tthis.events.on(\"preSend\",checkFormat);\r\n\tthis.watchdog=new ozpIwc.RouterWatchdog({router: this});\r\n\tthis.registerParticipant(this.watchdog);\r\n\r\n    ozpIwc.metrics.gauge('transport.router.participants').set(function() {\r\n        return self.getParticipantCount();\r\n    });\r\n};\r\n\r\n/**\r\n * gets the count of participants who have registered with the router\r\n * @returns {number} the number of registered participants\r\n */\r\nozpIwc.Router.prototype.getParticipantCount=function() {\r\n    if (!this.participants || !Object.keys(this.participants)) {\r\n        return 0;\r\n    }\r\n    return Object.keys(this.participants).length;\r\n\r\n};\r\n\r\nozpIwc.Router.prototype.shutdown=function() {\r\n    this.watchdog.shutdown();\r\n};\r\n\r\n/**\r\n * Allows a listener to add a new participant.\r\n * @fires ozpIwc.Router#registerParticipant\r\n * @param {object} participant the participant object that contains a send() function.\r\n * @param {object} packet The handshake requesting registration.\r\n * @returns {string} returns participant id\r\n */\r\nozpIwc.Router.prototype.registerParticipant=function(participant,packet) {\r\n    packet = packet || {};\r\n    var address;\r\n    do {\r\n        address=ozpIwc.util.generateId()+\".\"+this.self_id;\r\n    } while(this.participants.hasOwnProperty(address));\r\n\r\n    var registerEvent=new ozpIwc.CancelableEvent({\r\n        'packet': packet,\r\n        'registration': packet.entity,\r\n        'participant': participant\r\n    });\r\n    this.events.trigger(\"preRegisterParticipant\",registerEvent);\r\n\r\n    if(registerEvent.canceled){\r\n        // someone vetoed this participant\r\n        ozpIwc.log.log(\"registeredParticipant[DENIED] origin:\"+participant.origin+\r\n            \" because \" + registerEvent.cancelReason);\r\n        return null;\r\n    }\r\n\r\n    this.participants[address] = participant;\r\n    participant.connectToRouter(this,address);\r\n    var registeredEvent=new ozpIwc.CancelableEvent({\r\n        'packet': packet,\r\n        'participant': participant\r\n    });\r\n    this.events.trigger(\"registeredParticipant\",registeredEvent);\r\n\r\n//\tozpIwc.log.log(\"registeredParticipant[\"+participant_id+\"] origin:\"+participant.origin);\r\n    return address;\r\n};\r\n\r\n/**\r\n * @fires ozpIwc.Router#preSend\r\n * @param {ozpIwc.TransportPacket} packet\r\n * @param {ozpIwc.Participant} sendingParticipant\r\n */\r\nozpIwc.Router.prototype.deliverLocal=function(packet,sendingParticipant) {\r\n    if(!packet) {\r\n        throw \"Cannot deliver a null packet!\";\r\n    }\r\n    var localParticipant=this.participants[packet.dst];\r\n    if(!localParticipant) {\r\n        return;\r\n    }\r\n    var packetContext=new ozpIwc.TransportPacketContext({\r\n        'packet':packet,\r\n        'router': this,\r\n        'srcParticipant': sendingParticipant,\r\n        'dstParticipant': localParticipant\r\n    });\r\n\r\n    var preDeliverEvent=new ozpIwc.CancelableEvent({\r\n        'packet': packet,\r\n        'dstParticipant': localParticipant,\r\n        'srcParticipant': sendingParticipant\r\n    });\r\n\r\n    if(this.events.trigger(\"preDeliver\",preDeliverEvent).canceled) {\r\n        ozpIwc.metrics.counter(\"transport.packets.rejected\").inc();\r\n        return;\r\n    }\r\n\r\n    ozpIwc.authorization.isPermitted({\r\n        'subject':localParticipant.securityAttributes,\r\n        'object': packet.permissions,\r\n        'action': {'action': 'receive'}\r\n    })\r\n        .success(function() {\r\n            ozpIwc.metrics.counter(\"transport.packets.delivered\").inc();\r\n            localParticipant.receiveFromRouter(packetContext);\r\n        })\r\n        .failure(function() {\r\n            /** @todo do we send a \"denied\" message to the destination?  drop?  who knows? */\r\n            ozpIwc.metrics.counter(\"transport.packets.forbidden\").inc();\r\n        });\r\n\r\n};\r\n\r\n\r\n/**\r\n * Registers a participant for a multicast group\r\n * @param {ozpIwc.Participant} participant\r\n * @param {String[]} multicastGroups\r\n */\r\nozpIwc.Router.prototype.registerMulticast=function(participant,multicastGroups) {\r\n    var self=this;\r\n    multicastGroups.forEach(function(groupName) {\r\n        var g=self.participants[groupName];\r\n        if(!g) {\r\n            g=self.participants[groupName]=new ozpIwc.MulticastParticipant(groupName);\r\n        }\r\n        g.addMember(participant);\r\n        if (participant.address) {\r\n            var registeredEvent = new ozpIwc.CancelableEvent({\r\n                'entity': {'group': groupName, 'address': participant.address}\r\n            });\r\n            self.events.trigger(\"registeredMulticast\", registeredEvent);\r\n        } else {\r\n            console.log(\"no address for \" +  participant.participantType + \" \" + participant.name + \"with address \" + participant.address + \" for group \" + groupName);\r\n        }\r\n        //console.log(\"registered \" + participant.participantType + \" \" + participant.name + \"with address \" + participant.address + \" for group \" + groupName);\r\n    });\r\n    return multicastGroups;\r\n};\r\n\r\n/**\r\n * Used by participant listeners to route a message to other participants.\r\n * @fires ozpIwc.Router#preSend\r\n * @fires ozpIwc.Router#send\r\n * @param {ozpIwc.TransportPacket} packet The packet to route.\r\n * @param {ozpIwc.Participant} sendingParticipant Information about the participant that is attempting to send\r\n *   the packet.\r\n * @returns {undefined}\r\n */\r\nozpIwc.Router.prototype.send=function(packet,sendingParticipant) {\r\n\r\n    var preSendEvent=new ozpIwc.CancelableEvent({\r\n        'packet': packet,\r\n        'participant': sendingParticipant\r\n    });\r\n    this.events.trigger(\"preSend\",preSendEvent);\r\n\r\n    if(preSendEvent.canceled) {\r\n        ozpIwc.metrics.counter(\"transport.packets.sendCanceled\");\r\n        return;\r\n    }\r\n    ozpIwc.metrics.counter(\"transport.packets.sent\").inc();\r\n    this.deliverLocal(packet,sendingParticipant);\r\n    this.events.trigger(\"send\",{'packet': packet});\r\n    this.peer.send(packet);\r\n};\r\n\r\n/**\r\n * Receive a packet from the peer\r\n * @fires ozpIwc.Router#peerReceive\r\n * @param packet {ozpIwc.TransportPacket} the packet to receive\r\n */\r\nozpIwc.Router.prototype.receiveFromPeer=function(packet) {\r\n    ozpIwc.metrics.counter(\"transport.packets.receivedFromPeer\").inc();\r\n    var peerReceiveEvent=new ozpIwc.CancelableEvent({\r\n        'packet' : packet.data,\r\n        'rawPacket' : packet\r\n    });\r\n    this.events.trigger(\"prePeerReceive\",peerReceiveEvent);\r\n\r\n    if(!peerReceiveEvent.canceled){\r\n        this.deliverLocal(packet.data);\r\n    }\r\n};\r\n\r\n",
    "var ozpIwc=ozpIwc || {};\n\n/**\n * Baseclass for APIs that need leader election.  Uses the Bully algorithm for leader election.\n * @class\n * @param {object} config\n * @param {String} config.name \n *        The name of this API.\n * @param {string} [config.electionAddress=config.name+\".election\"] \n *        The multicast channel for running elections.  \n *        The leader will register to receive multicast on this channel.\n * @param {number} [config.priority=Math.Random] \n *        How strongly this node feels it should be leader.\n * @param {function} [config.priorityLessThan] \n *        Function that provides a strict total ordering on the priority.  Default is \"<\".\n * @param {number} [config.electionTimeout=250] \n *        Number of milliseconds to wait before declaring victory on an election. \n \n */\nozpIwc.LeaderGroupParticipant=ozpIwc.util.extend(ozpIwc.InternalParticipant,function(config) {\n\tozpIwc.InternalParticipant.apply(this,arguments);\n\n\tif(!config.name) {\n\t\tthrow \"Config must contain a name value\";\n\t}\n\t\n\t// Networking info\n\tthis.name=config.name;\n\t\n\tthis.electionAddress=config.electionAddress || (this.name + \".election\");\n\n\t// Election times and how to score them\n\tthis.priority = config.priority || ozpIwc.defaultLeaderPriority || -ozpIwc.util.now();\n\tthis.priorityLessThan = config.priorityLessThan || function(l,r) { return l < r; };\n\tthis.electionTimeout=config.electionTimeout || 250; // quarter second\n\tthis.leaderState=\"connecting\";\n\tthis.electionQueue=[];\n\t\n\t// tracking the current leader\n\tthis.leader=null;\n\tthis.leaderPriority=null;\n\n\tthis.participantType=\"leaderGroup\";\n\tthis.name=config.name;\n\t\n\tthis.on(\"startElection\",function() {\n\t\t\tthis.electionQueue=[];\n\t},this);\n\t\n\tthis.on(\"becameLeader\",function() {\n\t\tthis.electionQueue.forEach(function(p) {\n\t\t\tthis.forwardToTarget(p);\n\t\t},this);\n\t\tthis.electionQueue=[];\n\t},this);\n\n\tthis.on(\"newLeader\",function() {\n\t\tthis.electionQueue=[];\n\t},this);\n\tvar self=this;\n\t\n\t// handoff when we shut down\n\twindow.addEventListener(\"beforeunload\",function() {\n        //Priority has to be the minimum possible\n        self.priority=-Number.MAX_VALUE;\n        self.leaderPriority=-Number.MAX_VALUE;\n        if(self.leaderState === \"leader\") {\n            self.events.trigger(\"unloadState\");\n        }\n\t});\n\n    ozpIwc.metrics.gauge('transport.leaderGroup.election').set(function() {\n        var queue = self.getElectionQueue();\n        return {'queue': queue ? queue.length : 0};\n    });\n\tthis.on(\"connectedToRouter\",function() {\n        this.router.registerMulticast(this,[this.electionAddress,this.name]);\n        this.startElection();\n    },this);\n    this.on(\"receive\",this.routePacket,this);\n});\n\n/**\n * Retrieve the election queue. Called by closures which need access to the\n * queue as it grows\n * @returns {Array} the election queue\n */\nozpIwc.LeaderGroupParticipant.prototype.getElectionQueue=function() {\n    return this.electionQueue;\n};\n\n\n/**\n * Checks to see if the leadership group is in an election\n * @returns {Boolean} True if in an election state, otherwise false\n */\nozpIwc.LeaderGroupParticipant.prototype.inElection=function() {\n\treturn !!this.electionTimer;\n};\n\n/**\n * Checks to see if this instance is the leader of it's group.\n * @returns {Boolean}\n */\nozpIwc.LeaderGroupParticipant.prototype.isLeader=function() {\n\treturn this.leader === this.address;\n};\n\n/**\n * Sends a message to the leadership group.\n * @private\n * @param {string} type - the type of message-- \"election\" or \"victory\"\n */\nozpIwc.LeaderGroupParticipant.prototype.sendElectionMessage=function(type, config) {\n    config = config || {};\n    var state = config.state || {};\n\tthis.send({\n\t\t'src': this.address,\n\t\t'dst': this.electionAddress,\n\t\t'action': type,\n\t\t'entity': {\n\t\t\t'priority': this.priority,\n            'state': state\n\t\t}\n\t});\n};\n\n/**\n * Attempt to start a new election.\n * @protected\n * @returns {undefined}\n * @fire ozpIwc.LeaderGroupParticipant#startElection\n * @fire ozpIwc.LeaderGroupParticipant#becameLeader\n */\nozpIwc.LeaderGroupParticipant.prototype.startElection=function(config) {\n    config = config || {};\n    var state = config.state || {};\n\n\t// don't start a new election if we are in one\n\tif(this.inElection()) {\n\t\treturn;\n\t}\n\tthis.leaderState=\"election\";\n\tthis.events.trigger(\"startElection\");\n\n    this.victoryDebounce = null;\n\t\n\tvar self=this;\n\t// if no one overrules us, declare victory\n\tthis.electionTimer=window.setTimeout(function() {\n\t\tself.cancelElection();\n        self.leaderState = \"leader\";\n        self.leader=self.address;\n        self.leaderPriority=self.priority;\n        self.events.trigger(\"becameLeader\");\n\n        self.sendElectionMessage(\"victory\");\n\n        // Debouncing before setting state.\n        self.victoryDebounce = window.setTimeout(function(){\n            if (self.leaderState === \"leader\") {\n                if (self.stateStore && Object.keys(self.stateStore).length > 0) {\n                    self.events.trigger(\"acquireState\", self.stateStore);\n                    self.stateStore = {};\n                }\n            }\n        },100);\n\t},this.electionTimeout);\n\n\tthis.sendElectionMessage(\"election\", {state: state});\n};\n\n/**\n * Cancels an in-progress election that we started.\n * @protected\n * @fire ozpIwc.LeaderGroupParticipant#endElection\n */\nozpIwc.LeaderGroupParticipant.prototype.cancelElection=function() {\n\tif(this.electionTimer) {\n        window.clearTimeout(this.electionTimer);\n        this.electionTimer=null;\n        window.clearTimeout(this.victoryDebounce);\n        this.victoryDebounce=null;\n        this.events.trigger(\"endElection\");\n\t}\n};\n\n/**\n * Receives a packet on the election control group or forwards it to the target implementation\n * that of this leadership group.\n * @param {ozpIwc.TransportPacket} packet\n * @returns {boolean}\n */\nozpIwc.LeaderGroupParticipant.prototype.routePacket=function(packetContext) {\n\tvar packet=packetContext.packet;\n\tpacketContext.leaderState=this.leaderState;\n    if(packet.src === this.address) {\n        // drop our own packets that found their way here\n        return;\n    }\n    if(packet.dst === this.electionAddress) {\n        if(packet.src === this.address) {\n\t\t\t// even if we see our own messages, we shouldn't act upon them\n\t\t\treturn;\n\t\t} else if(packet.action === \"election\") {\n\t\t\tthis.handleElectionMessage(packet);\n\t\t} else if(packet.action === \"victory\") {\n\t\t\tthis.handleVictoryMessage(packet);\n\t\t}\n    } else {\n\t\tthis.forwardToTarget(packetContext);\n\t}\t\t\n};\n\nozpIwc.LeaderGroupParticipant.prototype.forwardToTarget=function(packetContext) {\n\tif(this.leaderState === \"election\" || this.leaderState === \"connecting\") {\n\t\tthis.electionQueue.push(packetContext);\n\t\treturn;\n\t}\n\tpacketContext.leaderState=this.leaderState;\n\tthis.events.trigger(\"receiveApiPacket\",packetContext);\n};\n\t\n\t\n/**\n * Respond to someone else starting an election.\n * @private\n * @param {ozpIwc.TransportPacket} electionMessage\n * @returns {undefined}\n */\nozpIwc.LeaderGroupParticipant.prototype.handleElectionMessage=function(electionMessage) {\n    //If a state was received, store it case participant becomes the leader\n    if(Object.keys(electionMessage.entity.state).length > 0){\n        this.stateStore = electionMessage.entity.state;\n    }\n\t// is the new election lower priority than us?\n\tif(this.priorityLessThan(electionMessage.entity.priority,this.priority)) {\n\t\t// Quell the rebellion!\n\t\tthis.startElection();\n\t} else {\n\t\t// Abandon dreams of leadership\n\t\tthis.cancelElection();\n\t}\n};\n\n/**\n * Handle someone else declaring victory.\n * @fire ozpIwc.LeaderGroupParticipant#newLeader\n * @param {ozpIwc.TransportPacket} victoryMessage\n */\nozpIwc.LeaderGroupParticipant.prototype.handleVictoryMessage=function(victoryMessage) {\n\tif(this.priorityLessThan(victoryMessage.entity.priority,this.priority)) {\n\t\t// someone usurped our leadership! start an election!\n\t\tthis.startElection();\n\t} else {\n\t\t// submit to the bully\n\t\tthis.leader=victoryMessage.src;\n\t\tthis.leaderPriority=victoryMessage.entity.priority;\n\t\tthis.cancelElection();\n\t\tthis.leaderState=\"member\";\n\t\tthis.events.trigger(\"newLeader\");\n        this.stateStore = {};\n\t}\n};\n\n\nozpIwc.LeaderGroupParticipant.prototype.heartbeatStatus=function() {\n\tvar status= ozpIwc.Participant.prototype.heartbeatStatus.apply(this,arguments);\n\tstatus.leaderState=this.leaderState;\n\tstatus.leaderPriority=this.priority;\n\treturn status;\n};",
    "var ozpIwc=ozpIwc || {};\n\n\n\n\n/**\n * @class\n * @extends ozpIwc.Participant\n * @param {string} name\n */\nozpIwc.MulticastParticipant=ozpIwc.util.extend(ozpIwc.Participant,function(name) {\n\tthis.name=name;\n\tthis.participantType=\"multicast\";\n\n    ozpIwc.Participant.apply(this,arguments);\n\tthis.members=[];\n    \n    this.namesResource=\"/multicast/\"+this.name;\n    \n    this.heartBeatContentType=\"application/ozpIwc-multicast-address-v1+json\";\n    this.heartBeatStatus.members=[];\n    this.on(\"connectedToRouter\",function() {\n        this.namesResource=\"/multicast/\" + this.name;\n    },this);\n});\n\n/**\n * Receives a packet on behalf of the multicast group.\n * @param {ozpIwc.TransportPacket} packet\n * @returns {Boolean}\n */\nozpIwc.MulticastParticipant.prototype.receiveFromRouterImpl=function(packet) {\n\tthis.members.forEach(function(m) {\n        // as we send to each member, update the context to make it believe that it's the only recipient\n        packet.dstParticipant=m;\n        m.receiveFromRouter(packet);\n    });\n\treturn false;\n};\n\n/**\n * \n * @param {ozpIwc.Participant} participant\n */\nozpIwc.MulticastParticipant.prototype.addMember=function(participant) {\n\tthis.members.push(participant);\n    this.heartBeatStatus.members.push(participant.address);\n};",
    "/** @namespace */\r\nvar ozpIwc=ozpIwc || {};\r\n\r\n/**\r\n * @class ozpIwc.PostMessageParticipant\r\n * @extends ozpIwc.Participant\r\n * @param {object} config\r\n * @param {string} config.origin\r\n * @param {object} config.sourceWindow\r\n * @param {object} config.credentials\r\n */\r\nozpIwc.PostMessageParticipant=ozpIwc.util.extend(ozpIwc.Participant,function(config) {\r\n\tozpIwc.Participant.apply(this,arguments);\r\n\tthis.origin=this.name=config.origin;\r\n\tthis.sourceWindow=config.sourceWindow;\r\n    this.credentials=config.credentials;\r\n\tthis.participantType=\"postMessageProxy\";\r\n    this.securityAttributes.origin=this.origin;\r\n    this.on(\"connectedToRouter\",function() {\r\n        this.securityAttributes.sendAs=this.address;\r\n        this.securityAttributes.receiveAs=this.address;\r\n    },this);\r\n    \r\n    this.heartBeatStatus.origin=this.origin;\r\n});\r\n\r\n/**\r\n * @override\r\n * Receives a packet on behalf of this participant and forwards it via PostMessage.\r\n * @param {ozpIwc.TransportPacketContext} packetContext\r\n */\r\nozpIwc.PostMessageParticipant.prototype.receiveFromRouterImpl=function(packetContext) {\r\n    var self = this;\r\n    return ozpIwc.authorization.isPermitted({\r\n        'subject': this.securityAttributes,\r\n        'object':  {\r\n            receiveAs: packetContext.packet.dst\r\n        }\r\n    })\r\n        .success(function(){\r\n            self.sendToRecipient(packetContext.packet);\r\n        })\r\n        .failure(function(){\r\n            ozpIwc.metrics.counter(\"transport.packets.forbidden\").inc();\r\n        });\r\n};\r\n\r\n/**\r\n * Sends a message to the other end of our connection.  Wraps any string mangling\r\n * necessary by the postMessage implementation of the browser.\r\n * @param {ozpIwc.TransportPacket} packet\r\n * @todo Only IE requires the packet to be stringified before sending, should use feature detection?\r\n * @returns {undefined}\r\n */\r\nozpIwc.PostMessageParticipant.prototype.sendToRecipient=function(packet) {\r\n    var data=packet;\r\n    if (!ozpIwc.util.structuredCloneSupport()) {\r\n         data=JSON.stringify(packet);\r\n    }\r\n\tthis.sourceWindow.postMessage(data,this.origin);\r\n};\r\n\r\n/**\r\n * The participant hijacks anything addressed to \"$transport\" and serves it\r\n * directly.  This isolates basic connection checking from the router, itself.\r\n * @param {object} packet\r\n * @returns {undefined}\r\n */\r\nozpIwc.PostMessageParticipant.prototype.handleTransportPacket=function(packet) {\r\n\tvar reply={\r\n\t\t'ver': 1,\r\n\t\t'dst': this.address,\r\n\t\t'src': '$transport',\r\n\t\t'replyTo': packet.msgId,\r\n\t\t'msgId': this.generateMsgId(),\r\n\t\t'entity': {\r\n\t\t\t\"address\": this.address\r\n\t\t}\r\n\t};\r\n\tthis.sendToRecipient(reply);\r\n};\r\n\r\n\r\n/**\r\n *\r\n * @todo track the last used timestamp and make sure we don't send a duplicate messageId\r\n * @param {ozpIwc.TransportPacket} packet\r\n * @param {type} event\r\n * @returns {undefined}\r\n */\r\nozpIwc.PostMessageParticipant.prototype.forwardFromPostMessage=function(packet,event) {\r\n\tif(typeof(packet) !== \"object\") {\r\n\t\tozpIwc.log.error(\"Unknown packet received: \" + JSON.stringify(packet));\r\n\t\treturn;\r\n\t}\r\n\tif(event.origin !== this.origin) {\r\n\t\t/** @todo participant changing origins should set off more alarms, probably */\r\n\t\tozpIwc.metrics.counter(\"transport.\"+this.address+\".invalidSenderOrigin\").inc();\r\n\t\treturn;\r\n\t}\r\n\r\n\tpacket=this.fixPacket(packet);\r\n\r\n\t// if it's addressed to $transport, hijack it\r\n\tif(packet.dst === \"$transport\") {\r\n\t\tthis.handleTransportPacket(packet);\r\n\t} else {\r\n\t\tthis.router.send(packet,this);\r\n\t}\r\n};\r\n\r\n/**\r\n * Sends a packet to this participants router.  Calls fixPacket\r\n * before doing so.\r\n * @override\r\n * @param {ozpIwc.TransportPacket} packet\r\n * @returns {ozpIwc.TransportPacket}\r\n*/\r\nozpIwc.PostMessageParticipant.prototype.send=function(packet) {\r\n    packet=this.fixPacket(packet);\r\n    var self = this;\r\n    return ozpIwc.authorization.isPermitted({\r\n        'subject': this.securityAttributes,\r\n        'object': {\r\n            sendAs: packet.src\r\n        }\r\n    })\r\n        .success(function(){\r\n            self.router.send(packet,this);\r\n        })\r\n        .failure(function(){\r\n            ozpIwc.metrics.counter(\"transport.packets.forbidden\").inc();\r\n        });\r\n};\r\n\r\n\r\n/**\r\n * @class\r\n * @param {object} config\r\n * @param {ozpIwc.Router} config.router\r\n */\r\nozpIwc.PostMessageParticipantListener=function(config) {\r\n\tconfig = config || {};\r\n\tthis.participants=[];\r\n\tthis.router=config.router || ozpIwc.defaultRouter;\r\n\r\n\tvar self=this;\r\n\r\n\twindow.addEventListener(\"message\", function(event) {\r\n\t\tself.receiveFromPostMessage(event);\r\n\t}, false);\r\n\r\n    ozpIwc.metrics.gauge('transport.postMessageListener.participants').set(function() {\r\n        return self.getParticipantCount();\r\n    });\r\n};\r\n\r\n/**\r\n * gets the count of known participants\r\n * @returns {number} the number of known participants\r\n */\r\nozpIwc.PostMessageParticipantListener.prototype.getParticipantCount=function() {\r\n    if (!this.participants) {\r\n        return 0;\r\n    }\r\n    return this.participants.length;\r\n};\r\n\r\n/**\r\n * Finds the participant associated with the given window.  Unfortunately, this is an\r\n * o(n) algorithm, since there doesn't seem to be any way to hash, order, or any other way to\r\n * compare windows other than equality.\r\n * @param {object} sourceWindow - the participant window handle from message's event.source\r\n */\r\nozpIwc.PostMessageParticipantListener.prototype.findParticipant=function(sourceWindow) {\r\n\tfor(var i=0; i< this.participants.length; ++i) {\r\n\t\tif(this.participants[i].sourceWindow === sourceWindow) {\r\n\t\t\treturn this.participants[i];\r\n\t\t}\r\n\t};\r\n};\r\n\r\n/**\r\n * Process a post message that is received from a peer\r\n * @param {object} event - The event received from the \"message\" event handler\r\n * @param {string} event.origin\r\n * @param {object} event.source\r\n * @param {ozpIwc.TransportPacket} event.data\r\n */\r\nozpIwc.PostMessageParticipantListener.prototype.receiveFromPostMessage=function(event) {\r\n\tvar participant=this.findParticipant(event.source);\r\n\tvar packet=event.data;\r\n\r\n\tif(typeof(event.data)===\"string\") {\r\n\t\ttry {\r\n            packet=JSON.parse(event.data);\r\n        } catch(e) {\r\n            // assume that it's some other library using the bus and let it go\r\n            return;\r\n        }\r\n\t}\r\n\t// if this is a window who hasn't talked to us before, sign them up\r\n\tif(!participant) {\r\n\t\tparticipant=new ozpIwc.PostMessageParticipant({\r\n\t\t\t'origin': event.origin,\r\n\t\t\t'sourceWindow': event.source,\r\n\t\t\t'credentials': packet.entity\r\n\t\t});\r\n\t\tthis.router.registerParticipant(participant,packet);\r\n\t\tthis.participants.push(participant);\r\n\t}\r\n\tparticipant.forwardFromPostMessage(packet,event);\r\n};\r\n",
    "/**\n * @class\n */\nozpIwc.RouterWatchdog = ozpIwc.util.extend(ozpIwc.InternalParticipant, function(config) {\n    ozpIwc.InternalParticipant.apply(this, arguments);\n\n    this.participantType = \"routerWatchdog\";\n    var self = this;\n    this.on(\"connected\", function() {\n        this.name = this.router.self_id;\n    }, this);\n\n    this.heartbeatFrequency = config.heartbeatFrequency || 10000;\n\n    this.on(\"connectedToRouter\", this.setupWatches, this);\n});\n\nozpIwc.RouterWatchdog.prototype.setupWatches = function() {\n    this.name = this.router.self_id;\n    var self=this;\n    var heartbeat=function() {\n        self.send({\n            dst: \"names.api\",\n            action: \"set\",\n            resource: \"/router/\" + self.router.self_id,\n            contentType: \"application/ozpIwc-router-v1+json\",\n            entity: {\n                'address': self.router.self_id,\n                'participants': self.router.getParticipantCount()\n            }\n        });\n\n        for (var k in self.router.participants) {\n            var participant=self.router.participants[k];\n            if(participant instanceof ozpIwc.MulticastParticipant) {\n                self.send({\n                    'dst': \"names.api\",\n                    'resource': participant.namesResource,\n                    'action' : \"set\",\n                    'entity' : participant.heartBeatStatus,\n                    'contentType' : participant.heartBeatContentType              \n                });\n            } else {\n                participant.heartbeat();\n            }            \n        }\n\n    };\n//    heartbeat();\n    \n    this.timer = window.setInterval(heartbeat, this.heartbeatFrequency);\n};\n\nozpIwc.RouterWatchdog.prototype.shutdown = function() {\n    window.clearInterval(this.timer);\n};\n\n",
    "\n/**\n * The base class for values in the various APIs.  Designed to be extended with API-specific\n * concerns and validation.\n * @class\n * @param {object} config\n * @param {string} config.name - the name of this resource\n */\nozpIwc.CommonApiValue = function(config) {\n\tconfig = config || {};\n\tthis.watchers= config.watchers || [];\n\tthis.resource=config.resource;\n    this.allowedContentTypes=config.allowedContentTypes;\n    this.entity=config.entity;\n\tthis.contentType=config.contentType;\n\tthis.permissions=config.permissions || {};\n\tthis.version=config.version || 0;\n    \n    this.persist=true;\n    this.deleted=true;\n};\n\n/**\n * Sets a data based upon the content of the packet.  Automatically updates the content type,\n * permissions, entity, and updates the version.\n * \n * @param {ozpIwc.TransportPacket} packet\n * @returns {undefined}\n */\nozpIwc.CommonApiValue.prototype.set=function(packet) {\n\tif(this.isValidContentType(packet.contentType)) {\n\t\tthis.permissions=packet.permissions || this.permissions;\n\t\tthis.contentType=packet.contentType;\n\t\tthis.entity=packet.entity;\n\t\tthis.version++;\n\t}\n};\n/**\n * Adds a new watcher based upon the contents of the packet.\n * @param {ozpIwc.TransportPacket} packet\n * @returns {undefined}\n */\nozpIwc.CommonApiValue.prototype.watch=function(packet) {\n\tthis.watchers.push({\n\t\tsrc: packet.src,\n\t\tmsgId: packet.msgId\n\t});\n};\n\n/**\n * Removes a previously registered watcher.  An unwatch on\n * someone who isn't actually watching is not an error-- \n * the post condition is satisfied.\n * \n * @param {ozpIwc.TransportPacket} packet\n * @returns {undefined}\n */\nozpIwc.CommonApiValue.prototype.unwatch=function(packet) {\n\tthis.watchers=this.watchers.filter(function(w) {\n\t\treturn packet.replyTo !== w.msgId && packet.src !==w.src;\n\t});\n};\n\n/**\n * Invokes the callback on each watcher.\n * @param {function} callback\n * @param {object} [self] - Used as 'this' for the callback.  Defaults to the Value object.\n * @returns {undefined}\n */\nozpIwc.CommonApiValue.prototype.eachWatcher=function(callback,self) {\n\tself=self || this;\n\treturn this.watchers.map(callback,self);\n};\n\n/**\n * Resets the data to an empy state-- undefined entity and contentType, no permissions,\n * and version of 0.  It does NOT remove watchers.  This allows for watches on values\n * that do not exist yet, or will be created in the future.\n * \n * @returns {undefined}\n */\nozpIwc.CommonApiValue.prototype.deleteData=function() {\n\tthis.entity=undefined;\n\tthis.contentType=undefined;\n\tthis.permissions=[];\n\tthis.version=0;\n    this.deleted=true;\n};\n\n/**\n * Turns this value into a packet.\n * \n * @param {ozpIwc.TransportPacket} base - Fields to be merged into the packet.\n * @returns {ozpIwc.TransportPacket}\n */\nozpIwc.CommonApiValue.prototype.toPacket=function(base) {\n\tbase = base || {};\n\tbase.entity=ozpIwc.util.clone(this.entity);\n\tbase.contentType=this.contentType;\n\tbase.permissions=ozpIwc.util.clone(this.permissions);\n\tbase.eTag=this.version;\n\tbase.resource=this.resource;\n\treturn base;\n};\n\n/**\n * Determines if the contentType is acceptable to this value.  Intended to be\n * overriden by subclasses.\n * @param {string} contentType\n * @returns {Boolean}\n */\nozpIwc.CommonApiValue.prototype.isValidContentType=function(contentType) {\n    if(this.allowedContentTypes && this.allowedContentTypes.indexOf(contentType) < 0) {\n        throw new ozpIwc.ApiError(\"badContent\",\n                \"Bad contentType \" + contentType +\", expected \" + this.allowedContentTypes.join(\",\"));\n     } else {\n        return true;\n    }\n};\n\n/**\n * Generates a point-in-time snapshot of this value that can later be sent to\n * {@link ozpIwc.CommonApiValue#changesSince} to determine the changes made to the value.\n * This value should be considered opaque to consumers.\n * \n * <p> For API subclasses, the default behavior is to simply call toPacket().  Subclasses\n * can override this, but should likely override {@link ozpIwc.CommonApiValue#changesSince}\n * as well.\n * \n * @returns {object}\n */\nozpIwc.CommonApiValue.prototype.snapshot=function() {\n\treturn this.toPacket();\n};\n\n/**\n * From a given snapshot, create a change notifications.  This is not a delta, rather it's\n * change structure.\n * <p> API subclasses can override if there are additional change notifications (e.g. children in DataApi).\n\n * @param {object} snapshot\n * @returns {ozpIwc.CommonApiValue.prototype.changesSince.Anonym$1}\n */\nozpIwc.CommonApiValue.prototype.changesSince=function(snapshot) {\n\tif(snapshot.eTag === this.version) {\n        return null;\n    }\n\treturn {\n\t\t\t'newValue': ozpIwc.util.clone(this.entity),\n\t\t\t'oldValue': snapshot.entity\n\t};\n};\n\n/**\n * Returns true if the value of this is impacted by the value of node.\n * For nodes that base their value off of other nodes, override this function.\n * @param {type} node \n * @returns boolean\n */\nozpIwc.CommonApiValue.prototype.isUpdateNeeded=function(node) {\n    return false;\n};\n\n/**\n * Update this node based upon the changes made to changedNodes.\n * @param {ozpIwc.CommonApiValue[]} changedNodes - Array of all nodes for which isUpdatedNeeded returned true.\n * @returns {ozpIwc.CommonApiValue.changes}\n */\nozpIwc.CommonApiValue.prototype.updateContent=function(changedNodes) {\n    return null;\n};",
    "\nozpIwc.CommonApiCollectionValue = ozpIwc.util.extend(ozpIwc.CommonApiValue,function(config) {\n\tozpIwc.CommonApiValue.apply(this,arguments);\n    this.persist=false;    \n    this.pattern=config.pattern;\n    this.entity=[];\n});\n\nozpIwc.CommonApiCollectionValue.prototype.isUpdateNeeded=function(node) {\n    return node.resource.match(this.pattern);\n};\n\nozpIwc.CommonApiCollectionValue.prototype.updateContent=function(changedNodes) {\n    this.version++;\n    this.entity=changedNodes.map(function(changedNode) { return changedNode.resource; });\n};\n\nozpIwc.CommonApiCollectionValue.prototype.set=function() {\n    throw new ozpIwc.ApiError(\"noPermission\",\"This resource cannot be modified.\");\n};\n",
    "ozpIwc.ApiError=ozpIwc.util.extend(Error,function(action,message) {\n    Error.call(this,message);\n    this.name=\"ApiError\";\n    this.errorAction=action;\n    this.message=message;\n});",
    "/**\n * The Common API Base implements the API Common Conventions.  It is intended to be subclassed by\n * the specific API implementations.\n * @class\n */\nozpIwc.CommonApiBase = function(config) {\n\tconfig = config || {};\n\tthis.participant=config.participant;\n    this.participant.on(\"unloadState\",ozpIwc.CommonApiBase.prototype.unloadState,this);\n    this.participant.on(\"acquireState\",ozpIwc.CommonApiBase.prototype.setState,this);\n\tthis.participant.on(\"receiveApiPacket\",ozpIwc.CommonApiBase.prototype.routePacket,this);\n\n\tthis.events = new ozpIwc.Event();\n    this.events.mixinOnOff(this);\n    \n    \n    this.dynamicNodes=[];\n    this.data={};\n};\n/**\n * Creates a new value for the given packet's request.  Subclasses must override this\n * function to return the proper value based upon the packet's resource, content type, or\n * other parameters.\n * \n * @abstract\n * @param {ozpIwc.TransportPacket} packet\n * @returns {ozpIwc.CommonApiValue} an object implementing the commonApiValue interfaces\n */\nozpIwc.CommonApiBase.prototype.makeValue=function(/*packet*/) {\n\tthrow new Error(\"Subclasses of CommonApiBase must implement the makeValue(packet) function.\");\n};\n\n/**\n * Determines whether the action implied by the packet is permitted to occur on\n * node in question.\n * @todo the refactoring of security to allow action-level permissions\n * @todo make the packetContext have the srcSubject inside of it\n * @param {ozpIwc.CommonApiValue} node\n * @param {ozpIwc.TransportPacketContext} packetContext\n * @returns {ozpIwc.AsyncAction}\n */\nozpIwc.CommonApiBase.prototype.isPermitted=function(node,packetContext) {\n\tvar subject=packetContext.srcSubject || {\n        'rawAddress':packetContext.packet.src\n    };\n\n\treturn ozpIwc.authorization.isPermitted({\n        'subject': subject,\n        'object': node.permissions,\n        'action': {'action':packetContext.action}\n    });\n};\n\n\n/** \n * Turn an event into a list of change packets to be sent to the watchers.\n * @param {object} evt\n * @param {object} evt.node - The node being changed.\n */\nozpIwc.CommonApiBase.prototype.notifyWatchers=function(node,changes) {\n    if(!changes) {\n        return;\n    }\n\tnode.eachWatcher(function(watcher) {\n\t\t// @TODO check that the recipient has permission to both the new and old values\n\t\tvar reply={\n\t\t\t'dst'   : watcher.src,\n            'src'   : this.participant.name,\n\t\t    'replyTo' : watcher.msgId,\n\t\t\t'response': 'changed',\n\t\t\t'resource': node.resource,\n\t\t\t'permissions': node.permissions,\n\t\t\t'entity': changes\n\t\t};\n        \n\t\tthis.participant.send(reply);\n\t},this);\n};\n\n/**\n * For a given packet, return the value if it already exists, otherwise create the value\n * using makeValue()\n * @protected\n * @param {ozpIwc.TransportPacket} packet\n */\nozpIwc.CommonApiBase.prototype.findOrMakeValue=function(packet) {\n    if(packet.resource === null || packet.resource === undefined) {\n        // return a throw-away value\n        return new ozpIwc.CommonApiValue();\n    }\n\tvar node=this.data[packet.resource];\n\n\tif(!node) {\n\t\tnode=this.data[packet.resource]=this.makeValue(packet);\n\t}\n\treturn node;\n};\n\n/**\n * \n * Determines if the given resource exists.\n * @param {string} resource\n * @returns {boolean}\n */\nozpIwc.CommonApiBase.prototype.hasKey=function(resource) {\n\treturn resource in this.data;\n};\n\n/**\n * Generates a keyname that does not already exist and starts\n * with a given prefix.\n * @param {String} prefix\n * @returns {String}\n */\nozpIwc.CommonApiBase.prototype.createKey=function(prefix) {\n\tprefix=prefix || \"\";\n\tvar key;\n\tdo {\n\t\tkey=prefix + ozpIwc.util.generateId();\n\t} while(this.hasKey(key));\n\treturn key;\n};\n\n/**\n* Route a packet to the appropriate handler.  The routing path is based upon\n * the action and whether a resource is defined. If the handler does not exist, it is routed \n * to defaultHandler(node,packetContext)\n * \n * Has Resource: handleAction(node,packetContext)\n *\n * No resource: rootHandleAction(node,packetContext)\n * \n * Where \"Action\" is replaced with the packet's action, lowercase with first letter capitalized\n * (e.g. \"doSomething\" invokes \"handleDosomething\")\n * Note that node will usually be null for the rootHandlerAction calls.\n * <ul>\n * <li> Pre-routing checks\t<ul>\n *\t\t<li> Permission check</li>\n *\t\t<li> ACL Checks (todo)</li>\n *\t\t<li> Precondition checks</li>\n * </ul></li>\n * <li> Post-routing actions <ul>\n *\t\t<li> Reply to requester </li>\n *\t\t<li> If node version changed, notify all watchers </li>\n * </ul></li>\n * @param {ozpIwc.TransportPacketContext} packetContext\n * @returns {undefined}\n */\nozpIwc.CommonApiBase.prototype.routePacket=function(packetContext) {\n\tvar packet=packetContext.packet;\n    this.events.trigger(\"receive\",packetContext);\n    var self=this;\n    var errorWrap=function(f) {\n        try {\n            f.apply(self);\n        } catch(e) {\n            packetContext.replyTo({\n                'response': e.errorAction || \"unknownError\",\n                'entity': e.message\n            });\n            return;\n        }\n    };\n\tif(packetContext.leaderState !== 'leader')\t{\n\t\t// if not leader, just drop it.\n\t\treturn;\n\t}\n    \n    if(packet.response && !packet.action) {\n        console.log(this.participant.name + \" dropping response packet \",packet);\n        // if it's a response packet that didn't wire an explicit handler, drop the sucker\n        return;\n    }\n    var node;\n    \n    errorWrap(function() {\n        var handler=this.findHandler(packetContext);\n        this.validateResource(node,packetContext);\n        node=this.findOrMakeValue(packetContext.packet);\n\n        this.isPermitted(node,packetContext)\n            .success(function() {\n                errorWrap(function() {\n                    this.validatePreconditions(node,packetContext);\n                    var snapshot=node.snapshot();\n                    handler.call(this,node,packetContext);\n                    this.notifyWatchers(node,node.changesSince(snapshot));\n\n                    // update all the collection values\n                    this.dynamicNodes.forEach(function(resource) {\n                        var node=this.data[resource];\n                        if(node) {\n                            this.updateDynamicNode(node);\n                        }\n                    },this);\n                });\n            },this)\n            .failure(function() {\n                packetContext.replyTo({'response':'noPerm'});\t\t\t\t\n            });\n    });\n};\n\nozpIwc.CommonApiBase.prototype.findHandler=function(packetContext) {\n    var action=packetContext.packet.action;\n    var resource=packetContext.packet.resource;\n    \n    var handler;\n\n    if(resource===null || resource===undefined) {\n        handler=\"rootHandle\";\n    } else {\n        handler=\"handle\";\n    }\n    \n\tif(action) {\n\t\thandler+=action.charAt(0).toUpperCase() + action.slice(1).toLowerCase();\n\t} else {\n        handler=\"defaultHandler\";\n    }\n    \n\tif(!handler || typeof(this[handler]) !== 'function') {\n       handler=\"defaultHandler\";\n\t}\n    return this[handler];\n};\n\n\n\n\nozpIwc.CommonApiBase.prototype.validateResource=function(/* node,packetContext */) {\n\treturn true;\n};\n\nozpIwc.CommonApiBase.prototype.validatePreconditions=function(node,packetContext) {\n\tif(packetContext.packet.ifTag && packetContext.packet.ifTag!==node.version) {\n        throw new ozpIwc.ApiError('noMatch',\"Latest version is \" + node.version);\n    }\n};\n\nozpIwc.CommonApiBase.prototype.validateContentType=function(node,packetContext) {\n    return true;\n};\n\nozpIwc.CommonApiBase.prototype.updateDynamicNode=function(node) {\n    var ofInterest=[];\n\n    for(var k in this.data) {\n        if(node.isUpdateNeeded(this.data[k])){\n            ofInterest.push(this.data[k]);\n        }                        \n    }\n\n    if(ofInterest) {\n        var snapshot=node.snapshot();\n        node.updateContent(ofInterest);\n        this.notifyWatchers(node,node.changesSince(snapshot));\n    }\n};\n\nozpIwc.CommonApiBase.prototype.addDynamicNode=function(resource,node) {\n    this.data[resource]=node;\n    node.resource=resource;\n    this.dynamicNodes.push(resource);\n    this.updateDynamicNode(node);\n};\n\nozpIwc.CommonApiBase.prototype.defaultHandler=function(node,packetContext) {\n    packetContext.replyTo({\n        'response': 'badAction',\n        'entity': packetContext.packet.action\n    });\n};\n\n/**\n * @param {ozpIwc.CommonApiValue} node\n * @param {ozpIwc.TransportPacketContext} packetContext\n */\nozpIwc.CommonApiBase.prototype.handleGet=function(node,packetContext) {\n\tpacketContext.replyTo(node.toPacket({'response': 'ok'}));\n};\n\n/**\n * @param {ozpIwc.CommonApiValue} node\n * @param {ozpIwc.TransportPacketContext} packetContext\n */\nozpIwc.CommonApiBase.prototype.handleSet=function(node,packetContext) {\n\tnode.set(packetContext.packet);\n\tpacketContext.replyTo({'response':'ok'});\n};\n\n/**\n * @param {ozpIwc.CommonApiValue} node\n * @param {ozpIwc.TransportPacketContext} packetContext\n */\nozpIwc.CommonApiBase.prototype.handleDelete=function(node,packetContext) {\n\tnode.deleteData();\n\tpacketContext.replyTo({'response':'ok'});\n};\n\n/**\n * @param {ozpIwc.CommonApiValue} node\n * @param {ozpIwc.TransportPacketContext} packetContext\n */\nozpIwc.CommonApiBase.prototype.handleWatch=function(node,packetContext) {\n\tnode.watch(packetContext.packet);\n\t\n\t// @TODO: Reply with the entity? Immediately send a change notice to the new watcher?  \n\tpacketContext.replyTo({'response': 'ok'});\n};\n\n/**\n * @param {ozpIwc.CommonApiValue} node\n * @param {ozpIwc.TransportPacketContext} packetContext\n */\nozpIwc.CommonApiBase.prototype.handleUnwatch=function(node,packetContext) {\n\tnode.unwatch(packetContext.packet);\n\t\n\tpacketContext.replyTo({'response':'ok'});\n};\n\n/**\n * Called when the leader participant fires its beforeUnload state. Releases the Api's data property\n * to be consumed by all, then used by the new leader.\n */\nozpIwc.CommonApiBase.prototype.unloadState = function(){\n    this.participant.startElection({state:this.data});\n    this.data = {};\n};\n\n/**\n * Called when the leader participant looses its leadership. This occurs when a new participant joins with a higher\n * priority\n */\nozpIwc.CommonApiBase.prototype.transferState = function(){\n    this.participant.sendElectionMessage(\"prevLeader\", {\n        state:this.data,\n        prevLeader: this.participant.address\n    });\n    this.data = {};\n};\n\n/**\n * Sets the APIs data property. Removes current values, then constructs each API value anew.\n * @param state\n */\nozpIwc.CommonApiBase.prototype.setState = function(state) {\n    this.data = {};\n    for (var key in state) {\n        this.findOrMakeValue(state[key]);\n    }\n};\n\n /** @param {ozpIwc.CommonApiValue} node\n * @param {ozpIwc.TransportPacketContext} packetContext\n */\nozpIwc.CommonApiBase.prototype.rootHandleList=function(node,packetContext) {\n    packetContext.replyTo({\n        'response':'ok',\n        'entity': Object.keys(this.data)\n    });\n};\n\n",
    "ozpIwc.DataApi = ozpIwc.util.extend(ozpIwc.CommonApiBase,function(config) {\n\tozpIwc.CommonApiBase.apply(this,arguments);\n    var self = this;\n    if (config.href && config.loadServerDataEmbedded) {\n        this.loadServerDataEmbedded({href: config.href})\n            .success(function () {\n                //Add on load code here\n            });\n    }\n});\n\nozpIwc.DataApi.prototype.makeValue = function(packet){\n    return new ozpIwc.DataApiValue(packet);\n};\n\nozpIwc.DataApi.prototype.createChild=function(node,packetContext) {\n\tvar key=this.createKey(node.resource+\"/\");\n\n\t// save the new child\n\tvar childNode=this.findOrMakeValue({'resource':key});\n\tchildNode.set(packetContext.packet);\n\treturn childNode;\n};\n\nozpIwc.DataApi.prototype.handleList=function(node,packetContext) {\n\tpacketContext.replyTo({\n        'response': 'ok',\n        'entity': node.listChildren()\n    });\n};\n\n/**\n * @param {ozpIwc.CommonApiValue} node\n * @param {ozpIwc.TransportPacketContext} packetContext\n */\nozpIwc.DataApi.prototype.handleAddchild=function(node,packetContext) {\n\tvar childNode=this.createChild(node,packetContext);\n\n\tnode.addChild(childNode.resource);\n\t\n\tpacketContext.replyTo({\n        'response':'ok',\n        'entity' : {\n            'resource': childNode.resource\n        }\n    });\n};\n\n/**\n * @param {ozpIwc.CommonApiValue} node\n * @param {ozpIwc.TransportPacketContext} packetContext\n */\nozpIwc.DataApi.prototype.handleRemovechild=function(node,packetContext) {\n    node.removeChild(packetContext.packet.entity.resource);\n\t// delegate to the handleGet call\n\tpacketContext.replyTo({\n        'response':'ok'\n    });\n};\n\n/**\n * Expects a complete Data API data store tree returned from the specified href. Data must be of hal/json type and the\n * stored tree must be in the '_embedded' property.\n *\n * @param config {Object}\n * @param config.href {String}\n * @returns {ozpIwc.AsyncAction}\n */\nozpIwc.DataApi.prototype.loadServerDataEmbedded = function (config) {\n    var self = this;\n    var asyncResponse = new ozpIwc.AsyncAction();\n    ozpIwc.util.ajax({\n        href: config.href,\n        method: \"GET\"\n    })\n        .success(function (data) {\n            // Take the root path from where the intent data is stored so that we can remove it from each object that\n            // becomes a intent value.\n            var rootPath = data._links.self.href;\n            for (var i in data._embedded['ozp:dataObjects']) {\n                var object = data._embedded['ozp:dataObjects'][i];\n                object.children = object.children || [];\n\n                var loadPacket = {\n                    packet: {\n                        resource: object._links.self.href.replace(rootPath, ''),\n                        entity: object.entity\n                    }\n                };\n                var node = self.findOrMakeValue(loadPacket.packet);\n\n                for (var i = 0; i < object.children.length; i++){\n                    node.addChild(object.children[i]);\n                }\n                node.set(loadPacket.packet);\n            }\n            asyncResponse.resolve(\"success\");\n        });\n\n    return asyncResponse;\n};",
    "\nozpIwc.DataApiValue = ozpIwc.util.extend(ozpIwc.CommonApiValue,function(config) {\n\tozpIwc.CommonApiValue.apply(this,arguments);\n    config = config || {};\n\tthis.children=config.children || [];\n});\n\n/**\n * \n * @param {string} child - name of the child record of this\n * @returns {undefined}\n */\nozpIwc.DataApiValue.prototype.addChild=function(child) {\n    if(this.children.indexOf(child) < 0) {\n        this.children.push(child);\n    \tthis.version++;\n    }\n};\n\n/**\n * \n * @param {string} child - name of the child record of this\n * @returns {undefined}\n */\nozpIwc.DataApiValue.prototype.removeChild=function(child) {\n    var originalLen=this.children.length;\n    this.children=this.children.filter(function(c) {\n        return c !== child;\n    });\n    if(originalLen !== this.children.length) {\n     \tthis.version++;\n    }\n};\n\n/**\n * \n * @param {string} child - name of the child record of this\n * @returns {undefined}\n */\nozpIwc.DataApiValue.prototype.listChildren=function() {\n    return ozpIwc.util.clone(this.children);\n};\n\n/**\n * \n * @param {string} child - name of the child record of this\n * @returns {undefined}\n */\nozpIwc.DataApiValue.prototype.toPacket=function() {\n\tvar packet=ozpIwc.CommonApiValue.prototype.toPacket.apply(this,arguments);\n\tpacket.links=packet.links || {};\n\tpacket.links.children=this.listChildren();\n\treturn packet;\n};\n\nozpIwc.DataApiValue.prototype.changesSince=function(snapshot) {\n    var changes=ozpIwc.CommonApiValue.prototype.changesSince.apply(this,arguments);\n\tif(changes) {\n        changes.removedChildren=snapshot.links.children.filter(function(f) {\n            return this.indexOf(f) < 0;\n        },this.children);\n        changes.addedChildren=this.children.filter(function(f) {\n            return this.indexOf(f) < 0;\n        },snapshot.links.children);\n\t}\n    return changes;\n};",
    "/**\n * The Intents API. Subclasses The Common Api Base.\n * @class\n * @params config {Object}\n * @params config.href {String} - URI of the server side Data storage to load the Intents Api with\n * @params config.loadServerData {Boolean} - Flag to load server side data.\n * @params config.loadServerDataEmbedded {Boolean} - Flag to load embedded version of server side data.\n *                                                  Takes precedence over config.loadServerData\n */\nozpIwc.IntentsApi = ozpIwc.util.extend(ozpIwc.CommonApiBase, function (config) {\n    ozpIwc.CommonApiBase.apply(this, arguments);\n    this.events.on(\"receive\", ozpIwc.IntentsApi.prototype.parseResource, this);\n    var self = this;\n    if (config.href && config.loadServerDataEmbedded) {\n        this.loadServerDataEmbedded({href: config.href})\n            .success(function () {\n                //Add on load code here\n            });\n    } else if (config.href && config.loadServerData) {\n        this.loadServerData({href: config.href})\n            .success(function () {\n                //Add on load code here\n            });\n    }\n\n\n});\n\n/**\n * Internal method, not intended for API use. Used for handling resource path parsing.\n * @param  {string} resource - the resource path to be evaluated.\n * @returns {object} parsedResource\n * @returns {string} parsedResource.type - the type of the resource\n * @returns {string} parsedResource.subtype - the subtype of the resource\n * @returns {string} parsedResource.verb - the verb (action) of the resource\n * @returns {string} parsedResource.handler - the handler of the resource\n * @returns {string} parsedResource.capabilityRes - the resource path of this resource's capability\n * @returns {string} parsedResource.definitionRes - the resource path of this resource's definition\n * @returns {string} parsedResource.handlerRes - the resource path of this resource's handler\n * @returns {string} parsedResource.intentValueType - returns the value type given the resource path (capability, definition, handler)\n */\nozpIwc.IntentsApi.prototype.parseResource = function (packetContext) {\n    if(!packetContext.packet.resource) {\n        return;\n    }\n    var resourceSplit = packetContext.packet.resource.split('/');\n    var result = {\n        type: resourceSplit[1],\n        subtype: resourceSplit[2],\n        verb: resourceSplit[3],\n        handler: resourceSplit[4]\n    };\n    if (result.type && result.subtype) {\n        if (result.verb) {\n            if (result.handler) {\n                result.intentValueType = 'handler';\n                result.handlerRes = '/' + resourceSplit[1] + '/' + resourceSplit[2] + '/' + resourceSplit[3] + '/' + resourceSplit[4];\n                result.definitionRes = '/' + resourceSplit[1] + '/' + resourceSplit[2] + '/' + resourceSplit[3];\n                result.capabilityRes = '/' + resourceSplit[1] + '/' + resourceSplit[2];\n            } else {\n                result.intentValueType = 'definition';\n                result.definitionRes = '/' + resourceSplit[1] + '/' + resourceSplit[2] + '/' + resourceSplit[3];\n                result.capabilityRes = '/' + resourceSplit[1] + '/' + resourceSplit[2];\n            }\n        } else {\n            result.intentValueType = 'capabilities';\n            result.capabilityRes = '/' + resourceSplit[1] + '/' + resourceSplit[2];\n        }\n        packetContext.packet.parsedResource = result;\n    }\n    return packetContext;\n};\n\n/**\n * Takes the resource of the given packet and creates an empty value in the IntentsApi. Chaining of creation is\n * accounted for (A handler requires a definition, which requires a capability).\n * @param {object} packet\n * @returns {IntentsApiHandlerValue|IntentsAPiDefinitionValue|IntentsApiCapabilityValue}\n */\nozpIwc.IntentsApi.prototype.makeValue = function (packet) {\n    if (!packet.packetResource) {\n        packet = ozpIwc.IntentsApi.prototype.parseResource({packet: packet}).packet;\n    }\n    switch (packet.parsedResource.intentValueType) {\n        case 'handler':\n            return this.getHandler(packet);\n        case 'definition':\n            return this.getDefinition(packet);\n        case 'capabilities':\n            return this.getCapability(packet);\n        default:\n            return null;\n    }\n};\n\n/**\n * Internal method, not intended for API use. Uses constructor parameter to determine what is constructed if the\n * resource does not exist.\n * @param {string} resource - the resource path of the desired value.\n * @param {Function} constructor - constructor function to be used if value does not exist.\n * @returns {IntentsApiHandlerValue|IntentsAPiDefinitionValue|IntentsApiCapabilityValue} node - node has only the resource parameter initialized.\n */\nozpIwc.IntentsApi.prototype.getGeneric = function (resource, constructor) {\n    var node = this.data[resource];\n    if (!node) {\n        node = this.data[resource] = new constructor({resource: resource});\n    }\n    return node;\n};\n\n/**\n * Returns the given capability in the IntentsApi. Constructs a new one if it does not exist.\n * @param {object} parsedResource - the  parsed resource of the desired value. Created from parsedResource().\n * @returns {IntentsApiCapabilityValue} value - the capability value requested.\n */\nozpIwc.IntentsApi.prototype.getCapability = function (packet) {\n    return this.getGeneric(packet.parsedResource.capabilityRes, ozpIwc.IntentsApiCapabilityValue);\n};\n\n/**\n * Returns the given definition in the IntentsApi. Constructs a new one if it does not exist. Constructs a capability\n * if necessary.\n * @param {object} parsedResource - the  parsed resource of the desired value. Created from parsedResource().\n * @returns {IntentsAPiDefinitionValue} value - the definition value requested.\n */\nozpIwc.IntentsApi.prototype.getDefinition = function (packet) {\n    var capability = this.getCapability(packet);\n    capability.entity = capability.entity || {};\n    capability.entity.definitions = capability.entity.definitions || [];\n\n    var definitionIndex = capability.entity.definitions.indexOf(packet.parsedResource.definitionRes);\n    if (definitionIndex === -1) {\n        capability.pushDefinition(packet.parsedResource.definitionRes);\n    }\n\n    return this.getGeneric(packet.parsedResource.definitionRes, ozpIwc.IntentsApiDefinitionValue);\n};\n\n/**\n * Returns the given handler in the IntentsApi. Constructs a new one if it does not exist. Constructs a definition\n * and capability if necessary.\n * @param {object} parsedResource - the  parsed resource of the desired value. Created from parsedResource().\n * @returns {IntentsApiHandlerValue} value - the handler value requested.\n */\nozpIwc.IntentsApi.prototype.getHandler = function (packet) {\n    var definition = this.getDefinition(packet);\n    definition.entity = definition.entity || {};\n    definition.entity.handlers = definition.entity.handlers || [];\n\n    var handlerIndex = definition.entity.handlers.indexOf(packet.parsedResource.handlerRes);\n    if (handlerIndex === -1) {\n        definition.pushHandler(packet.parsedResource.handlerRes);\n    }\n\n    return this.getGeneric(packet.parsedResource.handlerRes, ozpIwc.IntentsApiHandlerValue);\n};\n\n/**\n * Creates and registers a handler to the given definition resource path.\n * @param {object} node - the handler value to register, or the definition value the handler will register to\n * (handler will receive a generated key if definition value is provided).\n * @param {ozpIwc.TransportPacketContext} packetContext - the packet received by the router.\n */\nozpIwc.IntentsApi.prototype.handleRegister = function (node, packetContext) {\n    if (packetContext.packet.parsedResource.intentValueType === 'definition') {\n        packetContext.packet.parsedResource.handlerRes = this.createKey(packetContext.packet.resource + '/');\n    } else if (packetContext.packet.parsedResource.intentValueType !== 'handler') {\n        packetContext.replyTo({\n            'response': 'badResource'\n        });\n        return null;\n    }\n\n    var handler = this.getHandler(packetContext.packet);\n    handler.set(packetContext);\n\n    packetContext.replyTo({\n        'response': 'ok',\n        'entity': handler.resource\n    });\n};\n\n/**\n * Unregisters and destroys the handler assigned to the given handler resource path.\n * @param {object} node - the handler value to unregister from its definition.\n * @param {ozpIwc.TransportPacketContext} packetContext - the packet received by the router.\n */\nozpIwc.IntentsApi.prototype.handleUnregister = function (node, packetContext) {\n    var definitionPath = packetContext.packet.parsedResource.definitionRes;\n    var handlerPath = packetContext.packet.parsedResource.handlerRes;\n\n    var index = this.data[definitionPath].entity.handlers.indexOf(handlerPath);\n\n    if (index > -1) {\n        this.data[definitionPath].entity.handlers.splice(index, 1);\n    }\n    delete this.data[handlerPath];\n    packetContext.replyTo({'response': 'ok'});\n};\n\n/**\n * Invokes the appropriate handler for the intent from one of the following methods:\n *  <li> user preference specifies which handler to use. </li>\n *  <li> by prompting the user to select which handler to use. </li>\n *  <li> by receiving a handler resource instead of a definition resource </li>\n *  @todo <li> user preference specifies which handler to use. </li>\n *  @todo <li> by prompting the user to select which handler to use. </li>\n * @param {object} node - the definition or handler value used to invoke the intent.\n * @param {ozpIwc.TransportPacketContext} packetContext - the packet received by the router.\n */\nozpIwc.IntentsApi.prototype.handleInvoke = function (node, packetContext) {\n    switch (packetContext.packet.parsedResource.intentValueType) {\n        case 'handler':\n            node.invoke(packetContext.packet);\n            break;\n\n        case 'definition':\n            //TODO get user preference of which handler to use?\n            var handlerPreference = 0;\n            if (node.handlers.length > 0) {\n                var handler = node.handlers[handlerPreference];\n                this.data[handler].invoke(packet);\n            } else {\n                packetContext.replyTo({'response': 'badResource'});\n            }\n            break;\n\n        default:\n            packetContext.replyTo({'response': 'badResource'});\n            break;\n    }\n};\n\n/**\n * Listen for broadcast intents.\n * @todo unimplemented\n * @param {object} node - ?\n * @param {ozpIwc.TransportPacketContext} packetContext - the packet received by the router.\n */\nozpIwc.IntentsApi.prototype.handleListen = function (node, packetContext) {\n    //TODO handleListen()\n//    var parse = this.parseResource(packetContext.packet.resource);\n//    if (parse.intentValueType !== 'definition') {\n//        return packetContext.replyTo({\n//            'response': 'badResource'\n//        });\n//    }\n};\n\n/**\n * Handle a broadcast intent.\n * @todo unimplemented\n * @param {object} node - ?\n * @param {ozpIwc.TransportPacketContext} packetContext - the packet received by the router.\n */\nozpIwc.IntentsApi.prototype.handleBroadcast = function (node, packetContext) {\n    //TODO handleBroadcast()\n//    var parse = this.parseResource(packetContext.packet.resource);\n//    if (parse.intentValueType !== 'definition') {\n//        return packetContext.replyTo({\n//            'response': 'badResource'\n//        });\n//    }\n//    for (var i in node.handlers) {\n//        this.data[node.handlers[i]].invoke(packetContext.packet);\n//    }\n};\n\n\n/**\n * Expects a complete Intents data store tree returned from the specified href. Data must be of hal/json type and the\n * stored tree must be in the '_embedded' property.\n *\n * @param config {Object}\n * @param config.href {String}\n * @returns {ozpIwc.AsyncAction}\n */\nozpIwc.IntentsApi.prototype.loadServerDataEmbedded = function (config) {\n    var self = this;\n    var asyncResponse = new ozpIwc.AsyncAction();\n    ozpIwc.util.ajax({\n        href: config.href,\n        method: \"GET\"\n    })\n        .success(function (data) {\n            // Take the root path from where the intent data is stored so that we can remove it from each object that\n            // becomes a intent value.\n            var rootPath = data._links.self.href;\n            for (var i in data._embedded['ozp:intentTypes']) {\n                var type = data._embedded['ozp:intentTypes'][i];\n                for (var j in type._embedded['ozp:intentSubTypes']) {\n                    var subType = type._embedded['ozp:intentSubTypes'][j];\n                    for (var k in subType._embedded['ozp:intentActions']) {\n                        var action = subType._embedded['ozp:intentActions'][k];\n                        var loadPacket = {\n                            packet: {\n                                resource: action._links.self.href.replace(rootPath, ''),\n                                entity: action\n                            }\n                        };\n\n                        self.parseResource(loadPacket);\n                        var def = self.getDefinition(loadPacket.packet);\n                        def.set(loadPacket.packet);\n                    }\n                }\n            }\n            asyncResponse.resolve(\"success\");\n        });\n\n    return asyncResponse;\n};\n\n/**\n * Expects the root of an intents data store to be returned from the specified href. Data must be of hal/json\n * type and the stored tree is gathered through the '_links' property.\n *\n * @param config {Object}\n * @param config.href {String}\n * @returns {ozpIwc.AsyncAction}\n */\nozpIwc.IntentsApi.prototype.loadServerData = function (config) {\n    var self = this;\n    var asyncResponse = new ozpIwc.AsyncAction();\n    var counter = {\n        types: {\n            total: 0,\n            received: 0\n        },\n        subTypes: {\n            total: 0,\n            received: 0\n        },\n        actions: {\n            total: 0,\n            received: 0\n        }\n    };\n    // Get API root\n    ozpIwc.util.ajax({\n        href: config.href,\n        method: \"GET\"\n    })\n        .success(function (data) {\n            // Take the root path from where the intent data is stored so that we can remove it from each object that\n            // becomes a intent value.\n            var rootPath = data._links.self.href;\n\n            counter.types.total += data._links['ozp:intentTypes'].length;\n            for (var i in data._links['ozp:intentTypes']) {\n                ozpIwc.util.ajax({\n                    href: data._links['ozp:intentTypes'][i].href,\n                    method: \"GET\"\n                })\n                    .success(function (data) {\n                        counter.types.received++;\n                        // Get subTypes\n                        counter.subTypes.total += data._links['ozp:intentSubTypes'].length;\n                        for (var j in data._links['ozp:intentSubTypes']) {\n                            ozpIwc.util.ajax({\n                                href: data._links['ozp:intentSubTypes'][j].href,\n                                method: \"GET\"\n                            })\n                                .success(function (data) {\n                                    counter.subTypes.received++;\n                                    //Get Actions\n                                    counter.actions.total += data._links['ozp:intentActions'].length;\n                                    for (var k in data._links['ozp:intentActions']) {\n                                        ozpIwc.util.ajax({\n                                            href: data._links['ozp:intentActions'][k].href,\n                                            method: \"GET\"\n                                        })\n                                            .success(function (data) {\n\n                                                counter.actions.received++;\n                                                //Build out the API with the retrieved values\n                                                var loadPacket = {\n                                                    packet: {\n                                                        resource: data._links.self.href.replace(rootPath, ''),\n                                                        entity: data\n                                                    }\n                                                };\n                                                self.parseResource(loadPacket);\n                                                var def = self.getDefinition(loadPacket.packet);\n                                                def.set(loadPacket.packet);\n                                                if (counter.actions.received === counter.actions.total &&\n                                                    counter.subTypes.received === counter.subTypes.total &&\n                                                    counter.types.received == counter.types.total) {\n                                                    asyncResponse.resolve(\"success\");\n                                                }\n                                            });\n                                    }\n                                });\n                        }\n                    });\n            }\n        });\n    return asyncResponse;\n};\n",
    "/**\n * The capability value for an intent. adheres to the ozp-intents-type-capabilities-v1+json content type.\n * @class\n * @param {object} config\n *@param {object} config.entity\n * @param {string} config.entity.definitions - the list of definitions in this intent capability.\n */\nozpIwc.IntentsApiCapabilityValue = ozpIwc.util.extend(ozpIwc.CommonApiValue, function (config) {\n    ozpIwc.CommonApiValue.apply(this, arguments);\n});\n\n/**\n * Adds a definition to the end of the capability's list of definitions.\n * @param {string} definition - name of the definition added to this capability.\n */\nozpIwc.IntentsApiCapabilityValue.prototype.pushDefinition = function (definition) {\n    this.entity.definitions = this.entity.definitions || [];\n    this.entity.definitions.push(definition);\n    this.version++;\n};\n\n/**\n * Adds a definition to the beginning of the capability's list of definitions.\n * @param {string} definition - name of the definition added to this capability.\n */\nozpIwc.IntentsApiCapabilityValue.prototype.unshiftDefinition = function (definition) {\n    this.entity.definitions = this.entity.definitions || [];\n    this.entity.definitions.unshift(definition);\n    this.version++;\n};\n\n/**\n * Removes a definition from the end of the capability's list of definitions.\n * @returns {string} definition - name of the definition removed from this capability.\n */\nozpIwc.IntentsApiCapabilityValue.prototype.popDefinition = function () {\n    if (this.entity.definitions && this.entity.definitions.length > 0) {\n        this.version++;\n        return this.entity.definitions.pop();\n    }\n};\n\n/**\n * Removes a definition from the beginning of the capability's list of definitions.\n * @returns {string} definition - name of the definition removed from this capability.\n */\nozpIwc.IntentsApiCapabilityValue.prototype.shiftDefinition = function () {\n    if (this.entity.definitions && this.entity.definitions.length > 0) {\n        this.version++;\n        return this.entity.definitions.shift();\n    }\n};\n\n/**\n * Lists all definitions of the given capability.\n * @returns {Array} definitions - list of definitions in this capability.\n */\nozpIwc.IntentsApiCapabilityValue.prototype.listDefinitions = function () {\n    return this.entity.definitions;\n};",
    "/**\n * The definition value for an intent. adheres to the ozp-intents-definition-v1+json content type.\n * @class\n * @param {object} config\n * @param {object} config.entity\n * @param {string} config.entity.type - the type of this intent definition.\n * @param {string} config.entity.action - the action of this intent definition.\n * @param {string} config.entity.icon - the icon for this intent definition.\n * @param {string} config.entity.label - the label for this intent definition.\n * @param {string} config.entity.handlers - the list of handlers for the definition.\n */\nozpIwc.IntentsApiDefinitionValue = ozpIwc.util.extend(ozpIwc.CommonApiValue, function (config) {\n    ozpIwc.CommonApiValue.apply(this, arguments);\n});\n\n/**\n *\n * Adds a handler to the end of the definition's list of handler.\n * @param {string} definition - name of the handler added to this definition.\n */\nozpIwc.IntentsApiDefinitionValue.prototype.pushHandler = function (handler) {\n    this.entity.handlers = this.entity.handlers || [];\n    this.entity.handlers.push(handler);\n    this.version++;\n};\n\n/**\n * Adds a handler to the beginning of the definition's list of handler.\n * @param {string} definition - name of the handler added to this definition.\n */\nozpIwc.IntentsApiDefinitionValue.prototype.unshiftHandler = function (handler) {\n    this.entity.handlers = this.entity.handlers || [];\n    this.entity.handlers.unshift(handler);\n    this.version++;\n};\n\n/**\n * Removes a handler from the end of the definition's list of handlers.\n * @returns {string} handler - name of the handler removed from this definition.\n */\nozpIwc.IntentsApiDefinitionValue.prototype.popHandler = function () {\n    if (this.entity.handlers && this.entity.handlers.length > 0) {\n        this.version++;\n        return this.entity.handlers.pop();\n    }\n};\n\n/**\n * Removes a handler from the beginning of the definition's list of handlers.\n * @returns {string} handler - name of the handler removed from this definition.\n */\nozpIwc.IntentsApiDefinitionValue.prototype.shiftHandler = function () {\n    if (this.entity.handlers && this.entity.handlers.length > 0) {\n        this.version++;\n        return this.entity.handlers.shift();\n    }\n};\n\n/**\n * Lists all handlers of the given intent definition.\n * @returns {Array} handlers - list of handlers in this capability.\n */\nozpIwc.IntentsApiDefinitionValue.prototype.listHandlers = function () {\n    return this.entity.handlers;\n};",
    "/**\n * The handler value for an intent. adheres to the ozp-intents-handler-v1+json content type.\n * @class\n * @param {object} config\n * @param {object} config.entity\n * @param {string} config.entity.type - the type of this intent handler.\n * @param {string} config.entity.action - the action of this intent handler.\n * @param {string} config.entity.icon - the icon for this intent handler.\n * @param {string} config.entity.label - the label for this intent handler.\n * @param {string} config.entity.invokeIntent - the resource that will be called when handling an invoked intent.\n */\nozpIwc.IntentsApiHandlerValue = ozpIwc.util.extend(ozpIwc.CommonApiValue, function (config) {\n    ozpIwc.CommonApiValue.apply(this, arguments);\n});\n\n/**\n * Invokes the handler with the given packet information.\n * @param {object} packet - information passed to the activity receiving the intent.\n */\nozpIwc.IntentsApiHandlerValue.prototype.invoke = function (packet) {\n    this.set(packet);\n//    console.error('Invoking of intents.api handlers is not implemented.' +\n//        'Override ozpIwc.IntentsApiHandlerValue.invoke to implement');\n};\n",
    "ozpIwc.NamesApi = ozpIwc.util.extend(ozpIwc.CommonApiBase, function() {\n    ozpIwc.CommonApiBase.apply(this, arguments);\n    \n    // map the alias \"/me\" to \"/address/{packet.src}\" upon receiving the packet\n    this.on(\"receive\", function(packetContext) {\n        var packet = packetContext.packet;\n        if (packet.resource) {\n            packet.resource = packet.resource.replace(/\\/me/, packetContext.packet.src);\n        }\n    });\n    \n    this.addDynamicNode(\"/address\",new ozpIwc.CommonApiCollectionValue({\n        pattern: /^\\/address\\/.*$/,\n        contentType: \"application/ozpIwc-address-v1+json\"\n    }));\n    this.addDynamicNode(\"/multicast\",new ozpIwc.CommonApiCollectionValue({\n        pattern: /^\\/multicast\\/.*$/,\n        contentType: \"application/ozpIwc-multicast-address-v1+json\"        \n    }));\n    this.addDynamicNode(\"/router\",new ozpIwc.CommonApiCollectionValue({\n        pattern: /^\\/router\\/.*$/,\n        contentType: \"application/ozpIwc-router-v1+json\"        \n    }));\n    this.addDynamicNode(\"/api\",new ozpIwc.CommonApiCollectionValue({\n        pattern: /^\\/api\\/.*$/,\n        contentType: \"application/ozpIwc-api-descriptor-v1+json\"        \n    }));\n\n});\n\nozpIwc.NamesApi.prototype.validateResource=function(node,packetContext) {\n    return packetContext.packet.resource.match(/^\\/(api|address|multicast|router|me)/);\n};\n\nozpIwc.NamesApi.prototype.makeValue = function(packet) {\n    \n    var path=packet.resource.split(\"/\");\n    var config={\n        resource: packet.resource,\n        contentType: packet.contentType\n    };\n    \n    // only handle the root elements for now...\n    switch(path[1]) {\n        case \"api\": config.allowedContentTypes=[\"application/ozpIwc-api-descriptor-v1+json\"]; break;\n        case \"address\": config.allowedContentTypes=[\"application/ozpIwc-address-v1+json\"]; break;\n        case \"multicast\": config.allowedContentTypes=[\"application/ozpIwc-multicast-address-v1+json\"]; break;\n        case \"router\": config.allowedContentTypes=[\"application/ozpIwc-router-v1+json\"]; break;\n\n        default:\n            throw new ozpIwc.ApiError(\"badResource\",\"Not a valid path of names.api: \" + path[1] + \" in \" + packet.resource);\n    }\n    return new ozpIwc.NamesApiValue(config);            \n};\n",
    "ozpIwc.NamesApiValue = ozpIwc.util.extend(ozpIwc.CommonApiValue,function(config) {\n    if(!config || !config.allowedContentTypes) {\n        throw new Error(\"NamesAPIValue must be configured with allowedContentTypes.\");\n    }\n\tozpIwc.CommonApiValue.apply(this,arguments);\n});\n",
    "var ozpIwc=ozpIwc || {};\n\nozpIwc.SystemApi = ozpIwc.util.extend(ozpIwc.CommonApiBase,function(config) {\n    ozpIwc.CommonApiBase.apply(this,arguments);\n    this.participant.securityAttributes=config.securityAttributes;\n    if (config.userHref) {\n        this.loadServerDataEmbedded({href: config.userHref, resource: '/user'})\n            .success(function () {\n                //Add on load code here\n            });\n    }\n    if (config.systemHref) {\n        this.loadServerDataEmbedded({href: config.systemHref, resource: '/system'})\n            .success(function () {\n                //Add on load code here\n            });\n    }\n});\n\nozpIwc.SystemApi.prototype.makeValue = function(packet){\n    return new ozpIwc.SystemApiValue({resource: packet.resource, entity: packet.entity, contentType: packet.contentType, systemApi: this});\n};\n\nozpIwc.SystemApi.prototype.isPermitted=function(node,packetContext) {\n    var originalNode=node;\n    var originalPacketContext=packetContext;\n    if (packetContext.packet.action==='set' || packetContext.packet.action==='delete') {\n        node.permissions.modifyAuthority='apiLoader';\n        if (packetContext.packet.securityAttributes) {\n            packetContext.srcSubject=packetContext.srcSubject || {};\n            Object.keys(packetContext.packet.securityAttributes).forEach(function(key) {\n                packetContext.srcSubject[key]=packetContext.packet.securityAttributes[key];\n            });\n        }\n    } else {\n        delete node.permissions.modifyAuthority;\n    }\n    for (var i in arguments) {\n        if (arguments[i] === originalNode) {\n            arguments[i]=node;\n        } else if (arguments[i] === originalPacketContext) {\n            arguments[i]=packetContext;\n        }\n    }\n    var retVal=ozpIwc.CommonApiBase.prototype.isPermitted.apply(this,arguments);\n    delete node.permissions.modifyAuthority;\n    return retVal\n}\n\n/**\n * Loads the user and system data from the specified href. Data must be of hal/json type and\n * the keys 'user' and 'system' in the '_embedded' property must have object values that\n * correspond to user and system, respectively.\n *\n * @param config {Object}\n * @param config.href {String}\n * @returns {ozpIwc.AsyncAction}\n */\nozpIwc.SystemApi.prototype.loadServerDataEmbedded = function (config) {\n    var self = this;\n    var asyncResponse = new ozpIwc.AsyncAction();\n    ozpIwc.util.ajax({\n        href: config.href,\n        method: \"GET\"\n    })\n        .success(function (data) {\n            var value=self.findOrMakeValue({'resource': config.resource});\n            value.set({entity: data});\n            asyncResponse.resolve(\"success\");\n        })\n        .failure(function(data) {\n            console.log(\"AJAX failure response: \" + data)\n            asyncResponse.resolve(\"failure\",data);\n        });\n\n    return asyncResponse;\n};\n",
    "ozpIwc.SystemApiValue = ozpIwc.util.extend(ozpIwc.CommonApiValue,function(config) {\n    ozpIwc.CommonApiValue.apply(this,arguments);\n    config=config || {};\n    this.systemApi=config.systemApi || ozpIwc.systemApi;\n});\n\nozpIwc.SystemApiValue.prototype.set=function(packet) {\n    if(this.isValidContentType(packet.contentType)) {\n        this.permissions=packet.permissions || this.permissions;\n        this.contentType=packet.contentType;\n        if (this.resource) {\n            if (this.resource.indexOf('/application') === 0) {\n                var id = this.applicationId();\n                if (id) {\n                    this.entity = packet.entity;\n                    var node = this.systemApi.findOrMakeValue({resource: '/application'});\n                    node.set({entity: id})\n                } else {\n                    this.entity = this.entity || [];\n                    if (this.entity.indexOf(packet.entity) < 0) {\n                        this.entity.push(packet.entity);\n                    }\n                }\n            } else {\n                this.entity = packet.entity;\n            }\n            this.version++;\n        }\n    }\n}\n\nozpIwc.SystemApiValue.prototype.deleteData=function(packet) {\n    if (this.resource) {\n        if (this.resource.indexOf('/application') === 0) {\n            var id = this.applicationId();\n            if (id) {\n                var originalEntity=this.entity;\n                ozpIwc.CommonApiValue.prototype.deleteData.apply(this,arguments);\n                if (originalEntity) {\n                    var node = this.systemApi.findOrMakeValue({resource: '/application'});\n                    node.deleteData({entity: id})\n                }\n            } else {\n                if (!this.entity) {\n                    return;\n                }\n                var elementRemoved=false;\n                this.entity=this.entity.filter(function(element) {\n                    var keep=element !== packet.entity;\n                    if (!keep) {\n                        elementRemoved=true;\n                    }\n                    this.version=0;\n                    return keep;\n                });\n                if (elementRemoved){\n                    var node = this.systemApi.findOrMakeValue({resource: '/application/'+packet.entity});\n                    node.deleteData();\n                }\n            }\n        } else {\n            ozpIwc.CommonApiValue.prototype.deleteData.apply(this,arguments);\n        }\n        this.version=0;\n    }\n};\n\nozpIwc.SystemApiValue.prototype.applicationId=function() {\n    var regexp=/\\/application\\/(.*)/;\n    var res=regexp.exec(this.resource);\n    if (res && res.length > 1) {\n        return res[1];\n    }\n    return null;\n};\n\n"
  ]
}