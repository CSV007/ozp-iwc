{"version":3,"file":"ozpIwc-metrics.min.js","sources":["ozpIwc-metrics.js"],"names":["ozpIwc","AsyncAction","this","callbacks","prototype","when","state","callback","self","resolution","apply","value","arguments","resolve","status","Array","slice","call","success","failure","root","factory","define","amd","exports","module","returnExports","doesGetOwnPropertyDescriptorWork","object","sentinel","Object","getOwnPropertyDescriptor","exception","doesDefinePropertyWork","defineProperty","defineGetter","defineSetter","lookupGetter","lookupSetter","Function","prototypeOfObject","owns","bind","hasOwnProperty","supportsAccessors","__defineGetter__","__defineSetter__","__lookupGetter__","__lookupSetter__","getPrototypeOf","proto","__proto__","constructor","getOwnPropertyDescriptorWorksOnObject","getOwnPropertyDescriptorWorksOnDom","document","createElement","getOwnPropertyDescriptorFallback","ERR_NON_OBJECT","property","TypeError","descriptor","enumerable","configurable","notPrototypeOfObject","getter","setter","get","set","writable","getOwnPropertyNames","keys","create","createEmpty","supportsProto","Empty","iframe","parent","body","documentElement","style","display","appendChild","src","empty","contentWindow","removeChild","propertyIsEnumerable","isPrototypeOf","toLocaleString","toString","valueOf","properties","Type","defineProperties","definePropertyWorksOnObject","definePropertyWorksOnDom","definePropertyFallback","definePropertiesFallback","ERR_NON_OBJECT_DESCRIPTOR","ERR_NON_OBJECT_TARGET","ERR_ACCESSORS_NOT_SUPPORTED","seal","freeze","freezeObject","preventExtensions","isSealed","isFrozen","isExtensible","name","returnValue","toInteger","n","Math","floor","abs","isPrimitive","input","type","toPrimitive","val","toStr","isFunction","ArrayPrototype","ObjectPrototype","FunctionPrototype","StringPrototype","String","NumberPrototype","Number","array_slice","array_splice","splice","array_unshift","push","unshift","_toString","isRegex","isArray","obj","isString","isArguments","str","isArgs","length","callee","supportsDescriptors","e","method","forceAssign","map","toObject","o","ToUint32","x","that","target","args","binder","bound","result","concat","boundLength","max","boundArgs","i","join","spliceNoopReturnsEmptyArray","a","spliceWorksWithEmptyObject","start","deleteCount","hasUnshiftReturnValueBug","boxedString","splitString","properlyBoxesContext","properlyBoxesNonStrict","properlyBoxesStrict","_","__","context","forEach","fun","split","thisp","filter","every","some","reduceCoercesToObject","reduce","___","list","reduceRightCoercesToObject","reduceRight","hasFirefox2IndexOfBug","indexOf","sought","hasFirefox2LastIndexOfBug","lastIndexOf","min","hasDontEnumBug","hasProtoEnumBug","dontEnums","dontEnumsLength","isFn","isObject","isStr","theKeys","skipProto","ctor","skipConstructor","j","dontEnum","keysWorksWithArguments","originalKeys","negativeDate","negativeYearString","hasNegativeDateBug","Date","toISOString","year","month","isFinite","RangeError","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","getUTCMilliseconds","dateToJSONIsSupported","toJSON","NaN","toISO","tv","supportsExtendedYears","parse","acceptsInvalidDates","isNaN","doesNotParseY2KNewYear","NativeDate","Y","M","D","h","m","s","ms","date","dayFromMonth","t","months","toUTC","isoDateExpression","RegExp","key","now","UTC","string","match","exec","day","hour","minute","second","millisecond","isLocalTime","Boolean","signOffset","hourOffset","minuteOffset","getTime","hasToFixedBugs","toFixed","toFixedHelpers","base","size","data","multiply","c","divide","numToString","pow","acc","log","fractionDigits","f","z","k","string_split","compliantExecNpcg","separator","limit","separator2","lastIndex","lastLength","output","flags","ignoreCase","multiline","extended","sticky","lastLastIndex","source","index","replace","test","str_replace","replaceReportsGroupsCorrectly","groups","group","searchValue","replaceValue","hasCapturingGroups","wrappedReplaceValue","originalLastIndex","string_substr","substr","hasNegativeSubstrBug","ws","zeroWidth","wsRegexChars","trimBeginRegexp","trimEndRegexp","hasTrimWhitespaceBug","trim","parseInt","origParseInt","hexRegex","radix","Event","events","on","event","wrapped","ozpIwcDelegateFor","off","trigger","eventName","CancelableEvent","handlers","mixinOnOff","canceled","cancelReason","cancel","reason","window","console","error","util","generateId","random","extend","baseClass","newConstructor","Error","setImmediate","structuredCloneSupport","undefined","cache","onlyStrings","postMessage","blob","Blob","clone","JSON","stringify","arrayContainsAll","haystack","needles","equal","b","needle","hay","objectContainsAll","attribute","parseQueryParams","query","location","search","params","regex","decodeURIComponent","ajax","config","request","XMLHttpRequest","onreadystatechange","readyState","responseText","statusText","open","href","send","setRequestHeader","metricsStats","DEFAULT_POOL_SIZE","Sample","clear","update","values","count","getValues","UniformSample","rand","BinaryHeap","scoreFunction","content","heap","element","bubbleUp","peek","pop","end","sinkDown","remove","node","len","parentN","elemScore","child2N","child1N","swap","child1","child1Score","child2","child2Score","DEFAULT_RESCALE_THRESHOLD","DEFAULT_DECAY_ALPHA","ExponentiallyDecayingSample","alpha","rescaleThreshold","elt","newHeap","priority","tick","startTime","nextScaleTime","timestamp","weight","first","rescale","time","exp","oldContent","newContent","oldStartTime","M1_ALPHA","M5_ALPHA","M15_ALPHA","ExponentiallyWeightedMovingAverage","interval","currentRate","uncounted","lastTick","age","requiredTicks","instantRate","rate","metricTypes","BaseMetric","unitName","unit","Counter","inc","delta","dec","Gauge","metricsCallback","Histogram","sample","varianceMean","varianceM2","sum","mark","v","parseFloat","sort","percentile","p","pos","lower","upper","percentile_10","percentile_25","median","percentile_75","percentile_90","percentile_95","percentile_99","percentile_999","variance","mean","stdDev","sqrt","Meter","m1Rate","m5Rate","m15Rate","rate_1m","rate_5m","rate_15m","rate_mean","Timer","meter","histogram","endTime","meterMetrics","MetricsRegistry","metrics","gauge","findOrCreateMetric","makeName","counter","timer","register","metric","toJson","rv","path","current","shift","allMetrics"],"mappings":"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","sourcesContent":["/** @namespace */\nvar ozpIwc=ozpIwc || {};\n\n\n/**\n * A deferred action, but not in the sense of the Javascript standard.\n * @class\n */\nozpIwc.AsyncAction=function() {\n\tthis.callbacks={};\n};\n\nozpIwc.AsyncAction.prototype.when=function(state,callback,self) {\n    self=self || this;\n\t\n\tif(this.resolution === state) {\n\t\tcallback.apply(self,this.value);\n\t} else {\n\t\tthis.callbacks[state]=function() { return callback.apply(self,arguments); };\n\t}\n\treturn this;\n};\n\n\nozpIwc.AsyncAction.prototype.resolve=function(status) {\n\tif(this.resolution) {\n\t\tthrow \"Cannot resolve an already resolved AsyncAction\";\n\t}\n\tvar callback=this.callbacks[status];\n\tthis.resolution=status;\n\tthis.value=Array.prototype.slice.call(arguments,1);\n\t\n\tif(callback) {\n\t\tcallback.apply(this,this.value);\n\t}\n\treturn this;\n};\n\nozpIwc.AsyncAction.prototype.success=function(callback,self) {\n\treturn this.when(\"success\",callback,self);\n};\n\nozpIwc.AsyncAction.prototype.failure=function(callback,self) {\n\treturn this.when(\"failure\",callback,self);\n};\r\n/*!\r\n * https://github.com/es-shims/es5-shim\r\n * @license es5-shim Copyright 2009-2014 by contributors, MIT License\r\n * see https://github.com/es-shims/es5-shim/blob/master/LICENSE\r\n */\r\n\r\n// vim: ts=4 sts=4 sw=4 expandtab\r\n\r\n//Add semicolon to prevent IIFE from being passed as argument to concated code.\r\n;\r\n\r\n// UMD (Universal Module Definition)\r\n// see https://github.com/umdjs/umd/blob/master/returnExports.js\r\n(function (root, factory) {\r\n    if (typeof define === 'function' && define.amd) {\r\n        // AMD. Register as an anonymous module.\r\n        define(factory);\r\n    } else if (typeof exports === 'object') {\r\n        // Node. Does not work with strict CommonJS, but\r\n        // only CommonJS-like enviroments that support module.exports,\r\n        // like Node.\r\n        module.exports = factory();\r\n    } else {\r\n        // Browser globals (root is window)\r\n        root.returnExports = factory();\r\n  }\r\n}(this, function () {\r\n\r\nvar call = Function.prototype.call;\r\nvar prototypeOfObject = Object.prototype;\r\nvar owns = call.bind(prototypeOfObject.hasOwnProperty);\r\n\r\n// If JS engine supports accessors creating shortcuts.\r\nvar defineGetter;\r\nvar defineSetter;\r\nvar lookupGetter;\r\nvar lookupSetter;\r\nvar supportsAccessors = owns(prototypeOfObject, \"__defineGetter__\");\r\nif (supportsAccessors) {\r\n    defineGetter = call.bind(prototypeOfObject.__defineGetter__);\r\n    defineSetter = call.bind(prototypeOfObject.__defineSetter__);\r\n    lookupGetter = call.bind(prototypeOfObject.__lookupGetter__);\r\n    lookupSetter = call.bind(prototypeOfObject.__lookupSetter__);\r\n}\r\n\r\n// ES5 15.2.3.2\r\n// http://es5.github.com/#x15.2.3.2\r\nif (!Object.getPrototypeOf) {\r\n    // https://github.com/es-shims/es5-shim/issues#issue/2\r\n    // http://ejohn.org/blog/objectgetprototypeof/\r\n    // recommended by fschaefer on github\r\n    //\r\n    // sure, and webreflection says ^_^\r\n    // ... this will nerever possibly return null\r\n    // ... Opera Mini breaks here with infinite loops\r\n    Object.getPrototypeOf = function getPrototypeOf(object) {\r\n        var proto = object.__proto__;\r\n        if (proto || proto === null) {\r\n            return proto;\r\n        } else if (object.constructor) {\r\n            return object.constructor.prototype;\r\n        } else {\r\n            return prototypeOfObject;\r\n        }\r\n    };\r\n}\r\n\r\n//ES5 15.2.3.3\r\n//http://es5.github.com/#x15.2.3.3\r\n\r\nfunction doesGetOwnPropertyDescriptorWork(object) {\r\n    try {\r\n        object.sentinel = 0;\r\n        return Object.getOwnPropertyDescriptor(\r\n                object,\r\n                \"sentinel\"\r\n        ).value === 0;\r\n    } catch (exception) {\r\n        // returns falsy\r\n    }\r\n}\r\n\r\n//check whether getOwnPropertyDescriptor works if it's given. Otherwise,\r\n//shim partially.\r\nif (Object.defineProperty) {\r\n    var getOwnPropertyDescriptorWorksOnObject = doesGetOwnPropertyDescriptorWork({});\r\n    var getOwnPropertyDescriptorWorksOnDom = typeof document === \"undefined\" ||\r\n    doesGetOwnPropertyDescriptorWork(document.createElement(\"div\"));\r\n    if (!getOwnPropertyDescriptorWorksOnDom || !getOwnPropertyDescriptorWorksOnObject) {\r\n        var getOwnPropertyDescriptorFallback = Object.getOwnPropertyDescriptor;\r\n    }\r\n}\r\n\r\nif (!Object.getOwnPropertyDescriptor || getOwnPropertyDescriptorFallback) {\r\n    var ERR_NON_OBJECT = \"Object.getOwnPropertyDescriptor called on a non-object: \";\r\n\r\n    Object.getOwnPropertyDescriptor = function getOwnPropertyDescriptor(object, property) {\r\n        if ((typeof object !== \"object\" && typeof object !== \"function\") || object === null) {\r\n            throw new TypeError(ERR_NON_OBJECT + object);\r\n        }\r\n\r\n        // make a valiant attempt to use the real getOwnPropertyDescriptor\r\n        // for I8's DOM elements.\r\n        if (getOwnPropertyDescriptorFallback) {\r\n            try {\r\n                return getOwnPropertyDescriptorFallback.call(Object, object, property);\r\n            } catch (exception) {\r\n                // try the shim if the real one doesn't work\r\n            }\r\n        }\r\n\r\n        // If object does not owns property return undefined immediately.\r\n        if (!owns(object, property)) {\r\n            return;\r\n        }\r\n\r\n        // If object has a property then it's for sure both `enumerable` and\r\n        // `configurable`.\r\n        var descriptor =  { enumerable: true, configurable: true };\r\n\r\n        // If JS engine supports accessor properties then property may be a\r\n        // getter or setter.\r\n        if (supportsAccessors) {\r\n            // Unfortunately `__lookupGetter__` will return a getter even\r\n            // if object has own non getter property along with a same named\r\n            // inherited getter. To avoid misbehavior we temporary remove\r\n            // `__proto__` so that `__lookupGetter__` will return getter only\r\n            // if it's owned by an object.\r\n            var prototype = object.__proto__;\r\n            var notPrototypeOfObject = object !== prototypeOfObject;\r\n            // avoid recursion problem, breaking in Opera Mini when\r\n            // Object.getOwnPropertyDescriptor(Object.prototype, 'toString')\r\n            // or any other Object.prototype accessor\r\n            if (notPrototypeOfObject) {\r\n                object.__proto__ = prototypeOfObject;\r\n            }\r\n\r\n            var getter = lookupGetter(object, property);\r\n            var setter = lookupSetter(object, property);\r\n\r\n            if (notPrototypeOfObject) {\r\n                // Once we have getter and setter we can put values back.\r\n                object.__proto__ = prototype;\r\n            }\r\n\r\n            if (getter || setter) {\r\n                if (getter) {\r\n                    descriptor.get = getter;\r\n                }\r\n                if (setter) {\r\n                    descriptor.set = setter;\r\n                }\r\n                // If it was accessor property we're done and return here\r\n                // in order to avoid adding `value` to the descriptor.\r\n                return descriptor;\r\n            }\r\n        }\r\n\r\n        // If we got this far we know that object has an own property that is\r\n        // not an accessor so we set it as a value and return descriptor.\r\n        descriptor.value = object[property];\r\n        descriptor.writable = true;\r\n        return descriptor;\r\n    };\r\n}\r\n\r\n// ES5 15.2.3.4\r\n// http://es5.github.com/#x15.2.3.4\r\nif (!Object.getOwnPropertyNames) {\r\n    Object.getOwnPropertyNames = function getOwnPropertyNames(object) {\r\n        return Object.keys(object);\r\n    };\r\n}\r\n\r\n// ES5 15.2.3.5\r\n// http://es5.github.com/#x15.2.3.5\r\nif (!Object.create) {\r\n\r\n    // Contributed by Brandon Benvie, October, 2012\r\n    var createEmpty;\r\n    var supportsProto = !({__proto__:null} instanceof Object);\r\n                        // the following produces false positives\r\n                        // in Opera Mini => not a reliable check\r\n                        // Object.prototype.__proto__ === null\r\n    if (supportsProto || typeof document === 'undefined') {\r\n        createEmpty = function () {\r\n            return { \"__proto__\": null };\r\n        };\r\n    } else {\r\n        // In old IE __proto__ can't be used to manually set `null`, nor does\r\n        // any other method exist to make an object that inherits from nothing,\r\n        // aside from Object.prototype itself. Instead, create a new global\r\n        // object and *steal* its Object.prototype and strip it bare. This is\r\n        // used as the prototype to create nullary objects.\r\n        createEmpty = function () {\r\n            var iframe = document.createElement('iframe');\r\n            var parent = document.body || document.documentElement;\r\n            iframe.style.display = 'none';\r\n            parent.appendChild(iframe);\r\n            iframe.src = 'javascript:';\r\n            var empty = iframe.contentWindow.Object.prototype;\r\n            parent.removeChild(iframe);\r\n            iframe = null;\r\n            delete empty.constructor;\r\n            delete empty.hasOwnProperty;\r\n            delete empty.propertyIsEnumerable;\r\n            delete empty.isPrototypeOf;\r\n            delete empty.toLocaleString;\r\n            delete empty.toString;\r\n            delete empty.valueOf;\r\n            empty.__proto__ = null;\r\n\r\n            function Empty() {}\r\n            Empty.prototype = empty;\r\n            // short-circuit future calls\r\n            createEmpty = function () {\r\n                return new Empty();\r\n            };\r\n            return new Empty();\r\n        };\r\n    }\r\n\r\n    Object.create = function create(prototype, properties) {\r\n\r\n        var object;\r\n        function Type() {}  // An empty constructor.\r\n\r\n        if (prototype === null) {\r\n            object = createEmpty();\r\n        } else {\r\n            if (typeof prototype !== \"object\" && typeof prototype !== \"function\") {\r\n                // In the native implementation `parent` can be `null`\r\n                // OR *any* `instanceof Object`  (Object|Function|Array|RegExp|etc)\r\n                // Use `typeof` tho, b/c in old IE, DOM elements are not `instanceof Object`\r\n                // like they are in modern browsers. Using `Object.create` on DOM elements\r\n                // is...err...probably inappropriate, but the native version allows for it.\r\n                throw new TypeError(\"Object prototype may only be an Object or null\"); // same msg as Chrome\r\n            }\r\n            Type.prototype = prototype;\r\n            object = new Type();\r\n            // IE has no built-in implementation of `Object.getPrototypeOf`\r\n            // neither `__proto__`, but this manually setting `__proto__` will\r\n            // guarantee that `Object.getPrototypeOf` will work as expected with\r\n            // objects created using `Object.create`\r\n            object.__proto__ = prototype;\r\n        }\r\n\r\n        if (properties !== void 0) {\r\n            Object.defineProperties(object, properties);\r\n        }\r\n\r\n        return object;\r\n    };\r\n}\r\n\r\n// ES5 15.2.3.6\r\n// http://es5.github.com/#x15.2.3.6\r\n\r\n// Patch for WebKit and IE8 standard mode\r\n// Designed by hax <hax.github.com>\r\n// related issue: https://github.com/es-shims/es5-shim/issues#issue/5\r\n// IE8 Reference:\r\n//     http://msdn.microsoft.com/en-us/library/dd282900.aspx\r\n//     http://msdn.microsoft.com/en-us/library/dd229916.aspx\r\n// WebKit Bugs:\r\n//     https://bugs.webkit.org/show_bug.cgi?id=36423\r\n\r\nfunction doesDefinePropertyWork(object) {\r\n    try {\r\n        Object.defineProperty(object, \"sentinel\", {});\r\n        return \"sentinel\" in object;\r\n    } catch (exception) {\r\n        // returns falsy\r\n    }\r\n}\r\n\r\n// check whether defineProperty works if it's given. Otherwise,\r\n// shim partially.\r\nif (Object.defineProperty) {\r\n    var definePropertyWorksOnObject = doesDefinePropertyWork({});\r\n    var definePropertyWorksOnDom = typeof document === \"undefined\" ||\r\n        doesDefinePropertyWork(document.createElement(\"div\"));\r\n    if (!definePropertyWorksOnObject || !definePropertyWorksOnDom) {\r\n        var definePropertyFallback = Object.defineProperty,\r\n            definePropertiesFallback = Object.defineProperties;\r\n    }\r\n}\r\n\r\nif (!Object.defineProperty || definePropertyFallback) {\r\n    var ERR_NON_OBJECT_DESCRIPTOR = \"Property description must be an object: \";\r\n    var ERR_NON_OBJECT_TARGET = \"Object.defineProperty called on non-object: \"\r\n    var ERR_ACCESSORS_NOT_SUPPORTED = \"getters & setters can not be defined \" +\r\n                                      \"on this javascript engine\";\r\n\r\n    Object.defineProperty = function defineProperty(object, property, descriptor) {\r\n        if ((typeof object !== \"object\" && typeof object !== \"function\") || object === null) {\r\n            throw new TypeError(ERR_NON_OBJECT_TARGET + object);\r\n        }\r\n        if ((typeof descriptor !== \"object\" && typeof descriptor !== \"function\") || descriptor === null) {\r\n            throw new TypeError(ERR_NON_OBJECT_DESCRIPTOR + descriptor);\r\n        }\r\n        // make a valiant attempt to use the real defineProperty\r\n        // for I8's DOM elements.\r\n        if (definePropertyFallback) {\r\n            try {\r\n                return definePropertyFallback.call(Object, object, property, descriptor);\r\n            } catch (exception) {\r\n                // try the shim if the real one doesn't work\r\n            }\r\n        }\r\n\r\n        // If it's a data property.\r\n        if (owns(descriptor, \"value\")) {\r\n            // fail silently if \"writable\", \"enumerable\", or \"configurable\"\r\n            // are requested but not supported\r\n            /*\r\n            // alternate approach:\r\n            if ( // can't implement these features; allow false but not true\r\n                !(owns(descriptor, \"writable\") ? descriptor.writable : true) ||\r\n                !(owns(descriptor, \"enumerable\") ? descriptor.enumerable : true) ||\r\n                !(owns(descriptor, \"configurable\") ? descriptor.configurable : true)\r\n            )\r\n                throw new RangeError(\r\n                    \"This implementation of Object.defineProperty does not \" +\r\n                    \"support configurable, enumerable, or writable.\"\r\n                );\r\n            */\r\n\r\n            if (supportsAccessors && (lookupGetter(object, property) ||\r\n                                      lookupSetter(object, property)))\r\n            {\r\n                // As accessors are supported only on engines implementing\r\n                // `__proto__` we can safely override `__proto__` while defining\r\n                // a property to make sure that we don't hit an inherited\r\n                // accessor.\r\n                var prototype = object.__proto__;\r\n                object.__proto__ = prototypeOfObject;\r\n                // Deleting a property anyway since getter / setter may be\r\n                // defined on object itself.\r\n                delete object[property];\r\n                object[property] = descriptor.value;\r\n                // Setting original `__proto__` back now.\r\n                object.__proto__ = prototype;\r\n            } else {\r\n                object[property] = descriptor.value;\r\n            }\r\n        } else {\r\n            if (!supportsAccessors) {\r\n                throw new TypeError(ERR_ACCESSORS_NOT_SUPPORTED);\r\n            }\r\n            // If we got that far then getters and setters can be defined !!\r\n            if (owns(descriptor, \"get\")) {\r\n                defineGetter(object, property, descriptor.get);\r\n            }\r\n            if (owns(descriptor, \"set\")) {\r\n                defineSetter(object, property, descriptor.set);\r\n            }\r\n        }\r\n        return object;\r\n    };\r\n}\r\n\r\n// ES5 15.2.3.7\r\n// http://es5.github.com/#x15.2.3.7\r\nif (!Object.defineProperties || definePropertiesFallback) {\r\n    Object.defineProperties = function defineProperties(object, properties) {\r\n        // make a valiant attempt to use the real defineProperties\r\n        if (definePropertiesFallback) {\r\n            try {\r\n                return definePropertiesFallback.call(Object, object, properties);\r\n            } catch (exception) {\r\n                // try the shim if the real one doesn't work\r\n            }\r\n        }\r\n\r\n        for (var property in properties) {\r\n            if (owns(properties, property) && property !== \"__proto__\") {\r\n                Object.defineProperty(object, property, properties[property]);\r\n            }\r\n        }\r\n        return object;\r\n    };\r\n}\r\n\r\n// ES5 15.2.3.8\r\n// http://es5.github.com/#x15.2.3.8\r\nif (!Object.seal) {\r\n    Object.seal = function seal(object) {\r\n        // this is misleading and breaks feature-detection, but\r\n        // allows \"securable\" code to \"gracefully\" degrade to working\r\n        // but insecure code.\r\n        return object;\r\n    };\r\n}\r\n\r\n// ES5 15.2.3.9\r\n// http://es5.github.com/#x15.2.3.9\r\nif (!Object.freeze) {\r\n    Object.freeze = function freeze(object) {\r\n        // this is misleading and breaks feature-detection, but\r\n        // allows \"securable\" code to \"gracefully\" degrade to working\r\n        // but insecure code.\r\n        return object;\r\n    };\r\n}\r\n\r\n// detect a Rhino bug and patch it\r\ntry {\r\n    Object.freeze(function () {});\r\n} catch (exception) {\r\n    Object.freeze = (function freeze(freezeObject) {\r\n        return function freeze(object) {\r\n            if (typeof object === \"function\") {\r\n                return object;\r\n            } else {\r\n                return freezeObject(object);\r\n            }\r\n        };\r\n    })(Object.freeze);\r\n}\r\n\r\n// ES5 15.2.3.10\r\n// http://es5.github.com/#x15.2.3.10\r\nif (!Object.preventExtensions) {\r\n    Object.preventExtensions = function preventExtensions(object) {\r\n        // this is misleading and breaks feature-detection, but\r\n        // allows \"securable\" code to \"gracefully\" degrade to working\r\n        // but insecure code.\r\n        return object;\r\n    };\r\n}\r\n\r\n// ES5 15.2.3.11\r\n// http://es5.github.com/#x15.2.3.11\r\nif (!Object.isSealed) {\r\n    Object.isSealed = function isSealed(object) {\r\n        return false;\r\n    };\r\n}\r\n\r\n// ES5 15.2.3.12\r\n// http://es5.github.com/#x15.2.3.12\r\nif (!Object.isFrozen) {\r\n    Object.isFrozen = function isFrozen(object) {\r\n        return false;\r\n    };\r\n}\r\n\r\n// ES5 15.2.3.13\r\n// http://es5.github.com/#x15.2.3.13\r\nif (!Object.isExtensible) {\r\n    Object.isExtensible = function isExtensible(object) {\r\n        // 1. If Type(O) is not Object throw a TypeError exception.\r\n        if (Object(object) !== object) {\r\n            throw new TypeError(); // TODO message\r\n        }\r\n        // 2. Return the Boolean value of the [[Extensible]] internal property of O.\r\n        var name = '';\r\n        while (owns(object, name)) {\r\n            name += '?';\r\n        }\r\n        object[name] = true;\r\n        var returnValue = owns(object, name);\r\n        delete object[name];\r\n        return returnValue;\r\n    };\r\n}\r\n\r\n}));\r\n\r\n\r\n/*!\r\n * https://github.com/es-shims/es5-shim\r\n * @license es5-shim Copyright 2009-2014 by contributors, MIT License\r\n * see https://github.com/es-shims/es5-shim/blob/master/LICENSE\r\n */\r\n\r\n// vim: ts=4 sts=4 sw=4 expandtab\r\n\r\n//Add semicolon to prevent IIFE from being passed as argument to concated code.\r\n;\r\n\r\n// UMD (Universal Module Definition)\r\n// see https://github.com/umdjs/umd/blob/master/returnExports.js\r\n(function (root, factory) {\r\n    if (typeof define === 'function' && define.amd) {\r\n        // AMD. Register as an anonymous module.\r\n        define(factory);\r\n    } else if (typeof exports === 'object') {\r\n        // Node. Does not work with strict CommonJS, but\r\n        // only CommonJS-like enviroments that support module.exports,\r\n        // like Node.\r\n        module.exports = factory();\r\n    } else {\r\n        // Browser globals (root is window)\r\n        root.returnExports = factory();\r\n    }\r\n}(this, function () {\r\n\r\n/**\r\n * Brings an environment as close to ECMAScript 5 compliance\r\n * as is possible with the facilities of erstwhile engines.\r\n *\r\n * Annotated ES5: http://es5.github.com/ (specific links below)\r\n * ES5 Spec: http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-262.pdf\r\n * Required reading: http://javascriptweblog.wordpress.com/2011/12/05/extending-javascript-natives/\r\n */\r\n\r\n// Shortcut to an often accessed properties, in order to avoid multiple\r\n// dereference that costs universally.\r\nvar ArrayPrototype = Array.prototype;\r\nvar ObjectPrototype = Object.prototype;\r\nvar FunctionPrototype = Function.prototype;\r\nvar StringPrototype = String.prototype;\r\nvar NumberPrototype = Number.prototype;\r\nvar array_slice = ArrayPrototype.slice;\r\nvar array_splice = ArrayPrototype.splice;\r\nvar array_push = ArrayPrototype.push;\r\nvar array_unshift = ArrayPrototype.unshift;\r\nvar call = FunctionPrototype.call;\r\n\r\n// Having a toString local variable name breaks in Opera so use _toString.\r\nvar _toString = ObjectPrototype.toString;\r\n\r\nvar isFunction = function (val) {\r\n    return ObjectPrototype.toString.call(val) === '[object Function]';\r\n};\r\nvar isRegex = function (val) {\r\n    return ObjectPrototype.toString.call(val) === '[object RegExp]';\r\n};\r\nvar isArray = function isArray(obj) {\r\n    return _toString.call(obj) === \"[object Array]\";\r\n};\r\nvar isString = function isString(obj) {\r\n    return _toString.call(obj) === \"[object String]\";\r\n};\r\nvar isArguments = function isArguments(value) {\r\n    var str = _toString.call(value);\r\n    var isArgs = str === '[object Arguments]';\r\n    if (!isArgs) {\r\n        isArgs = !isArray(value)\r\n            && value !== null\r\n            && typeof value === 'object'\r\n            && typeof value.length === 'number'\r\n            && value.length >= 0\r\n            && isFunction(value.callee);\r\n    }\r\n    return isArgs;\r\n};\r\n\r\nvar supportsDescriptors = Object.defineProperty && (function () {\r\n    try {\r\n        Object.defineProperty({}, 'x', {});\r\n        return true;\r\n    } catch (e) { /* this is ES3 */\r\n        return false;\r\n    }\r\n}());\r\n\r\n// Define configurable, writable and non-enumerable props\r\n// if they don't exist.\r\nvar defineProperty;\r\nif (supportsDescriptors) {\r\n    defineProperty = function (object, name, method, forceAssign) {\r\n        if (!forceAssign && (name in object)) { return; }\r\n        Object.defineProperty(object, name, {\r\n            configurable: true,\r\n            enumerable: false,\r\n            writable: true,\r\n            value: method\r\n        });\r\n    };\r\n} else {\r\n    defineProperty = function (object, name, method, forceAssign) {\r\n        if (!forceAssign && (name in object)) { return; }\r\n        object[name] = method;\r\n    };\r\n}\r\nvar defineProperties = function (object, map, forceAssign) {\r\n    for (var name in map) {\r\n        if (ObjectPrototype.hasOwnProperty.call(map, name)) {\r\n          defineProperty(object, name, map[name], forceAssign);\r\n        }\r\n    }\r\n};\r\n\r\n//\r\n// Util\r\n// ======\r\n//\r\n\r\n// ES5 9.4\r\n// http://es5.github.com/#x9.4\r\n// http://jsperf.com/to-integer\r\n\r\nfunction toInteger(n) {\r\n    n = +n;\r\n    if (n !== n) { // isNaN\r\n        n = 0;\r\n    } else if (n !== 0 && n !== (1 / 0) && n !== -(1 / 0)) {\r\n        n = (n > 0 || -1) * Math.floor(Math.abs(n));\r\n    }\r\n    return n;\r\n}\r\n\r\nfunction isPrimitive(input) {\r\n    var type = typeof input;\r\n    return (\r\n        input === null ||\r\n        type === \"undefined\" ||\r\n        type === \"boolean\" ||\r\n        type === \"number\" ||\r\n        type === \"string\"\r\n    );\r\n}\r\n\r\nfunction toPrimitive(input) {\r\n    var val, valueOf, toStr;\r\n    if (isPrimitive(input)) {\r\n        return input;\r\n    }\r\n    valueOf = input.valueOf;\r\n    if (isFunction(valueOf)) {\r\n        val = valueOf.call(input);\r\n        if (isPrimitive(val)) {\r\n            return val;\r\n        }\r\n    }\r\n    toStr = input.toString;\r\n    if (isFunction(toStr)) {\r\n        val = toStr.call(input);\r\n        if (isPrimitive(val)) {\r\n            return val;\r\n        }\r\n    }\r\n    throw new TypeError();\r\n}\r\n\r\n// ES5 9.9\r\n// http://es5.github.com/#x9.9\r\nvar toObject = function (o) {\r\n    if (o == null) { // this matches both null and undefined\r\n        throw new TypeError(\"can't convert \" + o + \" to object\");\r\n    }\r\n    return Object(o);\r\n};\r\n\r\nvar ToUint32 = function ToUint32(x) {\r\n    return x >>> 0;\r\n};\r\n\r\n//\r\n// Function\r\n// ========\r\n//\r\n\r\n// ES-5 15.3.4.5\r\n// http://es5.github.com/#x15.3.4.5\r\n\r\nfunction Empty() {}\r\n\r\ndefineProperties(FunctionPrototype, {\r\n    bind: function bind(that) { // .length is 1\r\n        // 1. Let Target be the this value.\r\n        var target = this;\r\n        // 2. If IsCallable(Target) is false, throw a TypeError exception.\r\n        if (!isFunction(target)) {\r\n            throw new TypeError(\"Function.prototype.bind called on incompatible \" + target);\r\n        }\r\n        // 3. Let A be a new (possibly empty) internal list of all of the\r\n        //   argument values provided after thisArg (arg1, arg2 etc), in order.\r\n        // XXX slicedArgs will stand in for \"A\" if used\r\n        var args = array_slice.call(arguments, 1); // for normal call\r\n        // 4. Let F be a new native ECMAScript object.\r\n        // 11. Set the [[Prototype]] internal property of F to the standard\r\n        //   built-in Function prototype object as specified in 15.3.3.1.\r\n        // 12. Set the [[Call]] internal property of F as described in\r\n        //   15.3.4.5.1.\r\n        // 13. Set the [[Construct]] internal property of F as described in\r\n        //   15.3.4.5.2.\r\n        // 14. Set the [[HasInstance]] internal property of F as described in\r\n        //   15.3.4.5.3.\r\n        var binder = function () {\r\n\r\n            if (this instanceof bound) {\r\n                // 15.3.4.5.2 [[Construct]]\r\n                // When the [[Construct]] internal method of a function object,\r\n                // F that was created using the bind function is called with a\r\n                // list of arguments ExtraArgs, the following steps are taken:\r\n                // 1. Let target be the value of F's [[TargetFunction]]\r\n                //   internal property.\r\n                // 2. If target has no [[Construct]] internal method, a\r\n                //   TypeError exception is thrown.\r\n                // 3. Let boundArgs be the value of F's [[BoundArgs]] internal\r\n                //   property.\r\n                // 4. Let args be a new list containing the same values as the\r\n                //   list boundArgs in the same order followed by the same\r\n                //   values as the list ExtraArgs in the same order.\r\n                // 5. Return the result of calling the [[Construct]] internal\r\n                //   method of target providing args as the arguments.\r\n\r\n                var result = target.apply(\r\n                    this,\r\n                    args.concat(array_slice.call(arguments))\r\n                );\r\n                if (Object(result) === result) {\r\n                    return result;\r\n                }\r\n                return this;\r\n\r\n            } else {\r\n                // 15.3.4.5.1 [[Call]]\r\n                // When the [[Call]] internal method of a function object, F,\r\n                // which was created using the bind function is called with a\r\n                // this value and a list of arguments ExtraArgs, the following\r\n                // steps are taken:\r\n                // 1. Let boundArgs be the value of F's [[BoundArgs]] internal\r\n                //   property.\r\n                // 2. Let boundThis be the value of F's [[BoundThis]] internal\r\n                //   property.\r\n                // 3. Let target be the value of F's [[TargetFunction]] internal\r\n                //   property.\r\n                // 4. Let args be a new list containing the same values as the\r\n                //   list boundArgs in the same order followed by the same\r\n                //   values as the list ExtraArgs in the same order.\r\n                // 5. Return the result of calling the [[Call]] internal method\r\n                //   of target providing boundThis as the this value and\r\n                //   providing args as the arguments.\r\n\r\n                // equiv: target.call(this, ...boundArgs, ...args)\r\n                return target.apply(\r\n                    that,\r\n                    args.concat(array_slice.call(arguments))\r\n                );\r\n\r\n            }\r\n\r\n        };\r\n\r\n        // 15. If the [[Class]] internal property of Target is \"Function\", then\r\n        //     a. Let L be the length property of Target minus the length of A.\r\n        //     b. Set the length own property of F to either 0 or L, whichever is\r\n        //       larger.\r\n        // 16. Else set the length own property of F to 0.\r\n\r\n        var boundLength = Math.max(0, target.length - args.length);\r\n\r\n        // 17. Set the attributes of the length own property of F to the values\r\n        //   specified in 15.3.5.1.\r\n        var boundArgs = [];\r\n        for (var i = 0; i < boundLength; i++) {\r\n            boundArgs.push(\"$\" + i);\r\n        }\r\n\r\n        // XXX Build a dynamic function with desired amount of arguments is the only\r\n        // way to set the length property of a function.\r\n        // In environments where Content Security Policies enabled (Chrome extensions,\r\n        // for ex.) all use of eval or Function costructor throws an exception.\r\n        // However in all of these environments Function.prototype.bind exists\r\n        // and so this code will never be executed.\r\n        var bound = Function(\"binder\", \"return function (\" + boundArgs.join(\",\") + \"){return binder.apply(this,arguments)}\")(binder);\r\n\r\n        if (target.prototype) {\r\n            Empty.prototype = target.prototype;\r\n            bound.prototype = new Empty();\r\n            // Clean up dangling references.\r\n            Empty.prototype = null;\r\n        }\r\n\r\n        // TODO\r\n        // 18. Set the [[Extensible]] internal property of F to true.\r\n\r\n        // TODO\r\n        // 19. Let thrower be the [[ThrowTypeError]] function Object (13.2.3).\r\n        // 20. Call the [[DefineOwnProperty]] internal method of F with\r\n        //   arguments \"caller\", PropertyDescriptor {[[Get]]: thrower, [[Set]]:\r\n        //   thrower, [[Enumerable]]: false, [[Configurable]]: false}, and\r\n        //   false.\r\n        // 21. Call the [[DefineOwnProperty]] internal method of F with\r\n        //   arguments \"arguments\", PropertyDescriptor {[[Get]]: thrower,\r\n        //   [[Set]]: thrower, [[Enumerable]]: false, [[Configurable]]: false},\r\n        //   and false.\r\n\r\n        // TODO\r\n        // NOTE Function objects created using Function.prototype.bind do not\r\n        // have a prototype property or the [[Code]], [[FormalParameters]], and\r\n        // [[Scope]] internal properties.\r\n        // XXX can't delete prototype in pure-js.\r\n\r\n        // 22. Return F.\r\n        return bound;\r\n    }\r\n});\r\n\r\n// _Please note: Shortcuts are defined after `Function.prototype.bind` as we\r\n// us it in defining shortcuts.\r\nvar owns = call.bind(ObjectPrototype.hasOwnProperty);\r\n\r\n// If JS engine supports accessors creating shortcuts.\r\nvar defineGetter;\r\nvar defineSetter;\r\nvar lookupGetter;\r\nvar lookupSetter;\r\nvar supportsAccessors;\r\nif ((supportsAccessors = owns(ObjectPrototype, \"__defineGetter__\"))) {\r\n    defineGetter = call.bind(ObjectPrototype.__defineGetter__);\r\n    defineSetter = call.bind(ObjectPrototype.__defineSetter__);\r\n    lookupGetter = call.bind(ObjectPrototype.__lookupGetter__);\r\n    lookupSetter = call.bind(ObjectPrototype.__lookupSetter__);\r\n}\r\n\r\n//\r\n// Array\r\n// =====\r\n//\r\n\r\n// ES5 15.4.4.12\r\n// http://es5.github.com/#x15.4.4.12\r\nvar spliceNoopReturnsEmptyArray = (function () {\r\n    var a = [1, 2];\r\n    var result = a.splice();\r\n    return a.length === 2 && isArray(result) && result.length === 0;\r\n}());\r\ndefineProperties(ArrayPrototype, {\r\n    // Safari 5.0 bug where .splice() returns undefined\r\n    splice: function splice(start, deleteCount) {\r\n        if (arguments.length === 0) {\r\n            return [];\r\n        } else {\r\n            return array_splice.apply(this, arguments);\r\n        }\r\n    }\r\n}, spliceNoopReturnsEmptyArray);\r\n\r\nvar spliceWorksWithEmptyObject = (function () {\r\n    var obj = {};\r\n    ArrayPrototype.splice.call(obj, 0, 0, 1);\r\n    return obj.length === 1;\r\n}());\r\ndefineProperties(ArrayPrototype, {\r\n    splice: function splice(start, deleteCount) {\r\n        if (arguments.length === 0) { return []; }\r\n        var args = arguments;\r\n        this.length = Math.max(toInteger(this.length), 0);\r\n        if (arguments.length > 0 && typeof deleteCount !== 'number') {\r\n            args = array_slice.call(arguments);\r\n            if (args.length < 2) {\r\n                args.push(this.length - start);\r\n            } else {\r\n                args[1] = toInteger(deleteCount);\r\n            }\r\n        }\r\n        return array_splice.apply(this, args);\r\n    }\r\n}, !spliceWorksWithEmptyObject);\r\n\r\n// ES5 15.4.4.12\r\n// http://es5.github.com/#x15.4.4.13\r\n// Return len+argCount.\r\n// [bugfix, ielt8]\r\n// IE < 8 bug: [].unshift(0) === undefined but should be \"1\"\r\nvar hasUnshiftReturnValueBug = [].unshift(0) !== 1;\r\ndefineProperties(ArrayPrototype, {\r\n    unshift: function () {\r\n        array_unshift.apply(this, arguments);\r\n        return this.length;\r\n    }\r\n}, hasUnshiftReturnValueBug);\r\n\r\n// ES5 15.4.3.2\r\n// http://es5.github.com/#x15.4.3.2\r\n// https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/isArray\r\ndefineProperties(Array, { isArray: isArray });\r\n\r\n// The IsCallable() check in the Array functions\r\n// has been replaced with a strict check on the\r\n// internal class of the object to trap cases where\r\n// the provided function was actually a regular\r\n// expression literal, which in V8 and\r\n// JavaScriptCore is a typeof \"function\".  Only in\r\n// V8 are regular expression literals permitted as\r\n// reduce parameters, so it is desirable in the\r\n// general case for the shim to match the more\r\n// strict and common behavior of rejecting regular\r\n// expressions.\r\n\r\n// ES5 15.4.4.18\r\n// http://es5.github.com/#x15.4.4.18\r\n// https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/array/forEach\r\n\r\n// Check failure of by-index access of string characters (IE < 9)\r\n// and failure of `0 in boxedString` (Rhino)\r\nvar boxedString = Object(\"a\");\r\nvar splitString = boxedString[0] !== \"a\" || !(0 in boxedString);\r\n\r\nvar properlyBoxesContext = function properlyBoxed(method) {\r\n    // Check node 0.6.21 bug where third parameter is not boxed\r\n    var properlyBoxesNonStrict = true;\r\n    var properlyBoxesStrict = true;\r\n    if (method) {\r\n        method.call('foo', function (_, __, context) {\r\n            if (typeof context !== 'object') { properlyBoxesNonStrict = false; }\r\n        });\r\n\r\n        method.call([1], function () {\r\n            'use strict';\r\n            properlyBoxesStrict = typeof this === 'string';\r\n        }, 'x');\r\n    }\r\n    return !!method && properlyBoxesNonStrict && properlyBoxesStrict;\r\n};\r\n\r\ndefineProperties(ArrayPrototype, {\r\n    forEach: function forEach(fun /*, thisp*/) {\r\n        var object = toObject(this),\r\n            self = splitString && isString(this) ? this.split('') : object,\r\n            thisp = arguments[1],\r\n            i = -1,\r\n            length = self.length >>> 0;\r\n\r\n        // If no callback function or if callback is not a callable function\r\n        if (!isFunction(fun)) {\r\n            throw new TypeError(); // TODO message\r\n        }\r\n\r\n        while (++i < length) {\r\n            if (i in self) {\r\n                // Invoke the callback function with call, passing arguments:\r\n                // context, property value, property key, thisArg object\r\n                // context\r\n                fun.call(thisp, self[i], i, object);\r\n            }\r\n        }\r\n    }\r\n}, !properlyBoxesContext(ArrayPrototype.forEach));\r\n\r\n// ES5 15.4.4.19\r\n// http://es5.github.com/#x15.4.4.19\r\n// https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Objects/Array/map\r\ndefineProperties(ArrayPrototype, {\r\n    map: function map(fun /*, thisp*/) {\r\n        var object = toObject(this),\r\n            self = splitString && isString(this) ? this.split('') : object,\r\n            length = self.length >>> 0,\r\n            result = Array(length),\r\n            thisp = arguments[1];\r\n\r\n        // If no callback function or if callback is not a callable function\r\n        if (!isFunction(fun)) {\r\n            throw new TypeError(fun + \" is not a function\");\r\n        }\r\n\r\n        for (var i = 0; i < length; i++) {\r\n            if (i in self) {\r\n                result[i] = fun.call(thisp, self[i], i, object);\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n}, !properlyBoxesContext(ArrayPrototype.map));\r\n\r\n// ES5 15.4.4.20\r\n// http://es5.github.com/#x15.4.4.20\r\n// https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Objects/Array/filter\r\ndefineProperties(ArrayPrototype, {\r\n    filter: function filter(fun /*, thisp */) {\r\n        var object = toObject(this),\r\n            self = splitString && isString(this) ? this.split('') : object,\r\n            length = self.length >>> 0,\r\n            result = [],\r\n            value,\r\n            thisp = arguments[1];\r\n\r\n        // If no callback function or if callback is not a callable function\r\n        if (!isFunction(fun)) {\r\n            throw new TypeError(fun + \" is not a function\");\r\n        }\r\n\r\n        for (var i = 0; i < length; i++) {\r\n            if (i in self) {\r\n                value = self[i];\r\n                if (fun.call(thisp, value, i, object)) {\r\n                    result.push(value);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n}, !properlyBoxesContext(ArrayPrototype.filter));\r\n\r\n// ES5 15.4.4.16\r\n// http://es5.github.com/#x15.4.4.16\r\n// https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/every\r\ndefineProperties(ArrayPrototype, {\r\n    every: function every(fun /*, thisp */) {\r\n        var object = toObject(this),\r\n            self = splitString && isString(this) ? this.split('') : object,\r\n            length = self.length >>> 0,\r\n            thisp = arguments[1];\r\n\r\n        // If no callback function or if callback is not a callable function\r\n        if (!isFunction(fun)) {\r\n            throw new TypeError(fun + \" is not a function\");\r\n        }\r\n\r\n        for (var i = 0; i < length; i++) {\r\n            if (i in self && !fun.call(thisp, self[i], i, object)) {\r\n                return false;\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n}, !properlyBoxesContext(ArrayPrototype.every));\r\n\r\n// ES5 15.4.4.17\r\n// http://es5.github.com/#x15.4.4.17\r\n// https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/some\r\ndefineProperties(ArrayPrototype, {\r\n    some: function some(fun /*, thisp */) {\r\n        var object = toObject(this),\r\n            self = splitString && isString(this) ? this.split('') : object,\r\n            length = self.length >>> 0,\r\n            thisp = arguments[1];\r\n\r\n        // If no callback function or if callback is not a callable function\r\n        if (!isFunction(fun)) {\r\n            throw new TypeError(fun + \" is not a function\");\r\n        }\r\n\r\n        for (var i = 0; i < length; i++) {\r\n            if (i in self && fun.call(thisp, self[i], i, object)) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n}, !properlyBoxesContext(ArrayPrototype.some));\r\n\r\n// ES5 15.4.4.21\r\n// http://es5.github.com/#x15.4.4.21\r\n// https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Objects/Array/reduce\r\nvar reduceCoercesToObject = false;\r\nif (ArrayPrototype.reduce) {\r\n    reduceCoercesToObject = typeof ArrayPrototype.reduce.call('es5', function (_, __, ___, list) { return list; }) === 'object';\r\n}\r\ndefineProperties(ArrayPrototype, {\r\n    reduce: function reduce(fun /*, initial*/) {\r\n        var object = toObject(this),\r\n            self = splitString && isString(this) ? this.split('') : object,\r\n            length = self.length >>> 0;\r\n\r\n        // If no callback function or if callback is not a callable function\r\n        if (!isFunction(fun)) {\r\n            throw new TypeError(fun + \" is not a function\");\r\n        }\r\n\r\n        // no value to return if no initial value and an empty array\r\n        if (!length && arguments.length === 1) {\r\n            throw new TypeError(\"reduce of empty array with no initial value\");\r\n        }\r\n\r\n        var i = 0;\r\n        var result;\r\n        if (arguments.length >= 2) {\r\n            result = arguments[1];\r\n        } else {\r\n            do {\r\n                if (i in self) {\r\n                    result = self[i++];\r\n                    break;\r\n                }\r\n\r\n                // if array contains no values, no initial value to return\r\n                if (++i >= length) {\r\n                    throw new TypeError(\"reduce of empty array with no initial value\");\r\n                }\r\n            } while (true);\r\n        }\r\n\r\n        for (; i < length; i++) {\r\n            if (i in self) {\r\n                result = fun.call(void 0, result, self[i], i, object);\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n}, !reduceCoercesToObject);\r\n\r\n// ES5 15.4.4.22\r\n// http://es5.github.com/#x15.4.4.22\r\n// https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Objects/Array/reduceRight\r\nvar reduceRightCoercesToObject = false;\r\nif (ArrayPrototype.reduceRight) {\r\n    reduceRightCoercesToObject = typeof ArrayPrototype.reduceRight.call('es5', function (_, __, ___, list) { return list; }) === 'object';\r\n}\r\ndefineProperties(ArrayPrototype, {\r\n    reduceRight: function reduceRight(fun /*, initial*/) {\r\n        var object = toObject(this),\r\n            self = splitString && isString(this) ? this.split('') : object,\r\n            length = self.length >>> 0;\r\n\r\n        // If no callback function or if callback is not a callable function\r\n        if (!isFunction(fun)) {\r\n            throw new TypeError(fun + \" is not a function\");\r\n        }\r\n\r\n        // no value to return if no initial value, empty array\r\n        if (!length && arguments.length === 1) {\r\n            throw new TypeError(\"reduceRight of empty array with no initial value\");\r\n        }\r\n\r\n        var result, i = length - 1;\r\n        if (arguments.length >= 2) {\r\n            result = arguments[1];\r\n        } else {\r\n            do {\r\n                if (i in self) {\r\n                    result = self[i--];\r\n                    break;\r\n                }\r\n\r\n                // if array contains no values, no initial value to return\r\n                if (--i < 0) {\r\n                    throw new TypeError(\"reduceRight of empty array with no initial value\");\r\n                }\r\n            } while (true);\r\n        }\r\n\r\n        if (i < 0) {\r\n            return result;\r\n        }\r\n\r\n        do {\r\n            if (i in self) {\r\n                result = fun.call(void 0, result, self[i], i, object);\r\n            }\r\n        } while (i--);\r\n\r\n        return result;\r\n    }\r\n}, !reduceRightCoercesToObject);\r\n\r\n// ES5 15.4.4.14\r\n// http://es5.github.com/#x15.4.4.14\r\n// https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/indexOf\r\nvar hasFirefox2IndexOfBug = Array.prototype.indexOf && [0, 1].indexOf(1, 2) !== -1;\r\ndefineProperties(ArrayPrototype, {\r\n    indexOf: function indexOf(sought /*, fromIndex */ ) {\r\n        var self = splitString && isString(this) ? this.split('') : toObject(this),\r\n            length = self.length >>> 0;\r\n\r\n        if (!length) {\r\n            return -1;\r\n        }\r\n\r\n        var i = 0;\r\n        if (arguments.length > 1) {\r\n            i = toInteger(arguments[1]);\r\n        }\r\n\r\n        // handle negative indices\r\n        i = i >= 0 ? i : Math.max(0, length + i);\r\n        for (; i < length; i++) {\r\n            if (i in self && self[i] === sought) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n}, hasFirefox2IndexOfBug);\r\n\r\n// ES5 15.4.4.15\r\n// http://es5.github.com/#x15.4.4.15\r\n// https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/lastIndexOf\r\nvar hasFirefox2LastIndexOfBug = Array.prototype.lastIndexOf && [0, 1].lastIndexOf(0, -3) !== -1;\r\ndefineProperties(ArrayPrototype, {\r\n    lastIndexOf: function lastIndexOf(sought /*, fromIndex */) {\r\n        var self = splitString && isString(this) ? this.split('') : toObject(this),\r\n            length = self.length >>> 0;\r\n\r\n        if (!length) {\r\n            return -1;\r\n        }\r\n        var i = length - 1;\r\n        if (arguments.length > 1) {\r\n            i = Math.min(i, toInteger(arguments[1]));\r\n        }\r\n        // handle negative indices\r\n        i = i >= 0 ? i : length - Math.abs(i);\r\n        for (; i >= 0; i--) {\r\n            if (i in self && sought === self[i]) {\r\n                return i;\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n}, hasFirefox2LastIndexOfBug);\r\n\r\n//\r\n// Object\r\n// ======\r\n//\r\n\r\n// ES5 15.2.3.14\r\n// http://es5.github.com/#x15.2.3.14\r\n\r\n// http://whattheheadsaid.com/2010/10/a-safer-object-keys-compatibility-implementation\r\nvar hasDontEnumBug = !({'toString': null}).propertyIsEnumerable('toString'),\r\n    hasProtoEnumBug = (function () {}).propertyIsEnumerable('prototype'),\r\n    dontEnums = [\r\n        \"toString\",\r\n        \"toLocaleString\",\r\n        \"valueOf\",\r\n        \"hasOwnProperty\",\r\n        \"isPrototypeOf\",\r\n        \"propertyIsEnumerable\",\r\n        \"constructor\"\r\n    ],\r\n    dontEnumsLength = dontEnums.length;\r\n\r\ndefineProperties(Object, {\r\n    keys: function keys(object) {\r\n        var isFn = isFunction(object),\r\n            isArgs = isArguments(object),\r\n            isObject = object !== null && typeof object === 'object',\r\n            isStr = isObject && isString(object);\r\n\r\n        if (!isObject && !isFn && !isArgs) {\r\n            throw new TypeError(\"Object.keys called on a non-object\");\r\n        }\r\n\r\n        var theKeys = [];\r\n        var skipProto = hasProtoEnumBug && isFn;\r\n        if (isStr || isArgs) {\r\n            for (var i = 0; i < object.length; ++i) {\r\n                theKeys.push(String(i));\r\n            }\r\n        } else {\r\n            for (var name in object) {\r\n                if (!(skipProto && name === 'prototype') && owns(object, name)) {\r\n                    theKeys.push(String(name));\r\n                }\r\n            }\r\n        }\r\n\r\n        if (hasDontEnumBug) {\r\n            var ctor = object.constructor,\r\n                skipConstructor = ctor && ctor.prototype === object;\r\n            for (var j = 0; j < dontEnumsLength; j++) {\r\n                var dontEnum = dontEnums[j];\r\n                if (!(skipConstructor && dontEnum === 'constructor') && owns(object, dontEnum)) {\r\n                    theKeys.push(dontEnum);\r\n                }\r\n            }\r\n        }\r\n        return theKeys;\r\n    }\r\n});\r\n\r\nvar keysWorksWithArguments = Object.keys && (function () {\r\n    // Safari 5.0 bug\r\n    return Object.keys(arguments).length === 2;\r\n}(1, 2));\r\nvar originalKeys = Object.keys;\r\ndefineProperties(Object, {\r\n    keys: function keys(object) {\r\n        if (isArguments(object)) {\r\n            return originalKeys(ArrayPrototype.slice.call(object));\r\n        } else {\r\n            return originalKeys(object);\r\n        }\r\n    }\r\n}, !keysWorksWithArguments);\r\n\r\n//\r\n// Date\r\n// ====\r\n//\r\n\r\n// ES5 15.9.5.43\r\n// http://es5.github.com/#x15.9.5.43\r\n// This function returns a String value represent the instance in time\r\n// represented by this Date object. The format of the String is the Date Time\r\n// string format defined in 15.9.1.15. All fields are present in the String.\r\n// The time zone is always UTC, denoted by the suffix Z. If the time value of\r\n// this object is not a finite Number a RangeError exception is thrown.\r\nvar negativeDate = -62198755200000;\r\nvar negativeYearString = \"-000001\";\r\nvar hasNegativeDateBug = Date.prototype.toISOString && new Date(negativeDate).toISOString().indexOf(negativeYearString) === -1;\r\n\r\ndefineProperties(Date.prototype, {\r\n    toISOString: function toISOString() {\r\n        var result, length, value, year, month;\r\n        if (!isFinite(this)) {\r\n            throw new RangeError(\"Date.prototype.toISOString called on non-finite value.\");\r\n        }\r\n\r\n        year = this.getUTCFullYear();\r\n\r\n        month = this.getUTCMonth();\r\n        // see https://github.com/es-shims/es5-shim/issues/111\r\n        year += Math.floor(month / 12);\r\n        month = (month % 12 + 12) % 12;\r\n\r\n        // the date time string format is specified in 15.9.1.15.\r\n        result = [month + 1, this.getUTCDate(), this.getUTCHours(), this.getUTCMinutes(), this.getUTCSeconds()];\r\n        year = (\r\n            (year < 0 ? \"-\" : (year > 9999 ? \"+\" : \"\")) +\r\n            (\"00000\" + Math.abs(year)).slice(0 <= year && year <= 9999 ? -4 : -6)\r\n        );\r\n\r\n        length = result.length;\r\n        while (length--) {\r\n            value = result[length];\r\n            // pad months, days, hours, minutes, and seconds to have two\r\n            // digits.\r\n            if (value < 10) {\r\n                result[length] = \"0\" + value;\r\n            }\r\n        }\r\n        // pad milliseconds to have three digits.\r\n        return (\r\n            year + \"-\" + result.slice(0, 2).join(\"-\") +\r\n            \"T\" + result.slice(2).join(\":\") + \".\" +\r\n            (\"000\" + this.getUTCMilliseconds()).slice(-3) + \"Z\"\r\n        );\r\n    }\r\n}, hasNegativeDateBug);\r\n\r\n\r\n// ES5 15.9.5.44\r\n// http://es5.github.com/#x15.9.5.44\r\n// This function provides a String representation of a Date object for use by\r\n// JSON.stringify (15.12.3).\r\nvar dateToJSONIsSupported = false;\r\ntry {\r\n    dateToJSONIsSupported = (\r\n        Date.prototype.toJSON &&\r\n        new Date(NaN).toJSON() === null &&\r\n        new Date(negativeDate).toJSON().indexOf(negativeYearString) !== -1 &&\r\n        Date.prototype.toJSON.call({ // generic\r\n            toISOString: function () {\r\n                return true;\r\n            }\r\n        })\r\n    );\r\n} catch (e) {\r\n}\r\nif (!dateToJSONIsSupported) {\r\n    Date.prototype.toJSON = function toJSON(key) {\r\n        // When the toJSON method is called with argument key, the following\r\n        // steps are taken:\r\n\r\n        // 1.  Let O be the result of calling ToObject, giving it the this\r\n        // value as its argument.\r\n        // 2. Let tv be toPrimitive(O, hint Number).\r\n        var o = Object(this),\r\n            tv = toPrimitive(o),\r\n            toISO;\r\n        // 3. If tv is a Number and is not finite, return null.\r\n        if (typeof tv === \"number\" && !isFinite(tv)) {\r\n            return null;\r\n        }\r\n        // 4. Let toISO be the result of calling the [[Get]] internal method of\r\n        // O with argument \"toISOString\".\r\n        toISO = o.toISOString;\r\n        // 5. If IsCallable(toISO) is false, throw a TypeError exception.\r\n        if (typeof toISO !== \"function\") {\r\n            throw new TypeError(\"toISOString property is not callable\");\r\n        }\r\n        // 6. Return the result of calling the [[Call]] internal method of\r\n        //  toISO with O as the this value and an empty argument list.\r\n        return toISO.call(o);\r\n\r\n        // NOTE 1 The argument is ignored.\r\n\r\n        // NOTE 2 The toJSON function is intentionally generic; it does not\r\n        // require that its this value be a Date object. Therefore, it can be\r\n        // transferred to other kinds of objects for use as a method. However,\r\n        // it does require that any such object have a toISOString method. An\r\n        // object is free to use the argument key to filter its\r\n        // stringification.\r\n    };\r\n}\r\n\r\n// ES5 15.9.4.2\r\n// http://es5.github.com/#x15.9.4.2\r\n// based on work shared by Daniel Friesen (dantman)\r\n// http://gist.github.com/303249\r\nvar supportsExtendedYears = Date.parse('+033658-09-27T01:46:40.000Z') === 1e15;\r\nvar acceptsInvalidDates = !isNaN(Date.parse('2012-04-04T24:00:00.500Z')) || !isNaN(Date.parse('2012-11-31T23:59:59.000Z'));\r\nvar doesNotParseY2KNewYear = isNaN(Date.parse(\"2000-01-01T00:00:00.000Z\"));\r\nif (!Date.parse || doesNotParseY2KNewYear || acceptsInvalidDates || !supportsExtendedYears) {\r\n    // XXX global assignment won't work in embeddings that use\r\n    // an alternate object for the context.\r\n    Date = (function (NativeDate) {\r\n\r\n        // Date.length === 7\r\n        function Date(Y, M, D, h, m, s, ms) {\r\n            var length = arguments.length;\r\n            if (this instanceof NativeDate) {\r\n                var date = length === 1 && String(Y) === Y ? // isString(Y)\r\n                    // We explicitly pass it through parse:\r\n                    new NativeDate(Date.parse(Y)) :\r\n                    // We have to manually make calls depending on argument\r\n                    // length here\r\n                    length >= 7 ? new NativeDate(Y, M, D, h, m, s, ms) :\r\n                    length >= 6 ? new NativeDate(Y, M, D, h, m, s) :\r\n                    length >= 5 ? new NativeDate(Y, M, D, h, m) :\r\n                    length >= 4 ? new NativeDate(Y, M, D, h) :\r\n                    length >= 3 ? new NativeDate(Y, M, D) :\r\n                    length >= 2 ? new NativeDate(Y, M) :\r\n                    length >= 1 ? new NativeDate(Y) :\r\n                                  new NativeDate();\r\n                // Prevent mixups with unfixed Date object\r\n                date.constructor = Date;\r\n                return date;\r\n            }\r\n            return NativeDate.apply(this, arguments);\r\n        }\r\n\r\n        // 15.9.1.15 Date Time String Format.\r\n        var isoDateExpression = new RegExp(\"^\" +\r\n            \"(\\\\d{4}|[\\+\\-]\\\\d{6})\" + // four-digit year capture or sign +\r\n                                      // 6-digit extended year\r\n            \"(?:-(\\\\d{2})\" + // optional month capture\r\n            \"(?:-(\\\\d{2})\" + // optional day capture\r\n            \"(?:\" + // capture hours:minutes:seconds.milliseconds\r\n                \"T(\\\\d{2})\" + // hours capture\r\n                \":(\\\\d{2})\" + // minutes capture\r\n                \"(?:\" + // optional :seconds.milliseconds\r\n                    \":(\\\\d{2})\" + // seconds capture\r\n                    \"(?:(\\\\.\\\\d{1,}))?\" + // milliseconds capture\r\n                \")?\" +\r\n            \"(\" + // capture UTC offset component\r\n                \"Z|\" + // UTC capture\r\n                \"(?:\" + // offset specifier +/-hours:minutes\r\n                    \"([-+])\" + // sign capture\r\n                    \"(\\\\d{2})\" + // hours offset capture\r\n                    \":(\\\\d{2})\" + // minutes offset capture\r\n                \")\" +\r\n            \")?)?)?)?\" +\r\n        \"$\");\r\n\r\n        var months = [\r\n            0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334, 365\r\n        ];\r\n\r\n        function dayFromMonth(year, month) {\r\n            var t = month > 1 ? 1 : 0;\r\n            return (\r\n                months[month] +\r\n                Math.floor((year - 1969 + t) / 4) -\r\n                Math.floor((year - 1901 + t) / 100) +\r\n                Math.floor((year - 1601 + t) / 400) +\r\n                365 * (year - 1970)\r\n            );\r\n        }\r\n\r\n        function toUTC(t) {\r\n            return Number(new NativeDate(1970, 0, 1, 0, 0, 0, t));\r\n        }\r\n\r\n        // Copy any custom methods a 3rd party library may have added\r\n        for (var key in NativeDate) {\r\n            Date[key] = NativeDate[key];\r\n        }\r\n\r\n        // Copy \"native\" methods explicitly; they may be non-enumerable\r\n        Date.now = NativeDate.now;\r\n        Date.UTC = NativeDate.UTC;\r\n        Date.prototype = NativeDate.prototype;\r\n        Date.prototype.constructor = Date;\r\n\r\n        // Upgrade Date.parse to handle simplified ISO 8601 strings\r\n        Date.parse = function parse(string) {\r\n            var match = isoDateExpression.exec(string);\r\n            if (match) {\r\n                // parse months, days, hours, minutes, seconds, and milliseconds\r\n                // provide default values if necessary\r\n                // parse the UTC offset component\r\n                var year = Number(match[1]),\r\n                    month = Number(match[2] || 1) - 1,\r\n                    day = Number(match[3] || 1) - 1,\r\n                    hour = Number(match[4] || 0),\r\n                    minute = Number(match[5] || 0),\r\n                    second = Number(match[6] || 0),\r\n                    millisecond = Math.floor(Number(match[7] || 0) * 1000),\r\n                    // When time zone is missed, local offset should be used\r\n                    // (ES 5.1 bug)\r\n                    // see https://bugs.ecmascript.org/show_bug.cgi?id=112\r\n                    isLocalTime = Boolean(match[4] && !match[8]),\r\n                    signOffset = match[9] === \"-\" ? 1 : -1,\r\n                    hourOffset = Number(match[10] || 0),\r\n                    minuteOffset = Number(match[11] || 0),\r\n                    result;\r\n                if (\r\n                    hour < (\r\n                        minute > 0 || second > 0 || millisecond > 0 ?\r\n                        24 : 25\r\n                    ) &&\r\n                    minute < 60 && second < 60 && millisecond < 1000 &&\r\n                    month > -1 && month < 12 && hourOffset < 24 &&\r\n                    minuteOffset < 60 && // detect invalid offsets\r\n                    day > -1 &&\r\n                    day < (\r\n                        dayFromMonth(year, month + 1) -\r\n                        dayFromMonth(year, month)\r\n                    )\r\n                ) {\r\n                    result = (\r\n                        (dayFromMonth(year, month) + day) * 24 +\r\n                        hour +\r\n                        hourOffset * signOffset\r\n                    ) * 60;\r\n                    result = (\r\n                        (result + minute + minuteOffset * signOffset) * 60 +\r\n                        second\r\n                    ) * 1000 + millisecond;\r\n                    if (isLocalTime) {\r\n                        result = toUTC(result);\r\n                    }\r\n                    if (-8.64e15 <= result && result <= 8.64e15) {\r\n                        return result;\r\n                    }\r\n                }\r\n                return NaN;\r\n            }\r\n            return NativeDate.parse.apply(this, arguments);\r\n        };\r\n\r\n        return Date;\r\n    })(Date);\r\n}\r\n\r\n// ES5 15.9.4.4\r\n// http://es5.github.com/#x15.9.4.4\r\nif (!Date.now) {\r\n    Date.now = function now() {\r\n        return new Date().getTime();\r\n    };\r\n}\r\n\r\n\r\n//\r\n// Number\r\n// ======\r\n//\r\n\r\n// ES5.1 15.7.4.5\r\n// http://es5.github.com/#x15.7.4.5\r\nvar hasToFixedBugs = NumberPrototype.toFixed && (\r\n  (0.00008).toFixed(3) !== '0.000'\r\n  || (0.9).toFixed(0) !== '1'\r\n  || (1.255).toFixed(2) !== '1.25'\r\n  || (1000000000000000128).toFixed(0) !== \"1000000000000000128\"\r\n);\r\n\r\nvar toFixedHelpers = {\r\n  base: 1e7,\r\n  size: 6,\r\n  data: [0, 0, 0, 0, 0, 0],\r\n  multiply: function multiply(n, c) {\r\n      var i = -1;\r\n      while (++i < toFixedHelpers.size) {\r\n          c += n * toFixedHelpers.data[i];\r\n          toFixedHelpers.data[i] = c % toFixedHelpers.base;\r\n          c = Math.floor(c / toFixedHelpers.base);\r\n      }\r\n  },\r\n  divide: function divide(n) {\r\n      var i = toFixedHelpers.size, c = 0;\r\n      while (--i >= 0) {\r\n          c += toFixedHelpers.data[i];\r\n          toFixedHelpers.data[i] = Math.floor(c / n);\r\n          c = (c % n) * toFixedHelpers.base;\r\n      }\r\n  },\r\n  numToString: function numToString() {\r\n      var i = toFixedHelpers.size;\r\n      var s = '';\r\n      while (--i >= 0) {\r\n          if (s !== '' || i === 0 || toFixedHelpers.data[i] !== 0) {\r\n              var t = String(toFixedHelpers.data[i]);\r\n              if (s === '') {\r\n                  s = t;\r\n              } else {\r\n                  s += '0000000'.slice(0, 7 - t.length) + t;\r\n              }\r\n          }\r\n      }\r\n      return s;\r\n  },\r\n  pow: function pow(x, n, acc) {\r\n      return (n === 0 ? acc : (n % 2 === 1 ? pow(x, n - 1, acc * x) : pow(x * x, n / 2, acc)));\r\n  },\r\n  log: function log(x) {\r\n      var n = 0;\r\n      while (x >= 4096) {\r\n          n += 12;\r\n          x /= 4096;\r\n      }\r\n      while (x >= 2) {\r\n          n += 1;\r\n          x /= 2;\r\n      }\r\n      return n;\r\n  }\r\n};\r\n\r\ndefineProperties(NumberPrototype, {\r\n    toFixed: function toFixed(fractionDigits) {\r\n        var f, x, s, m, e, z, j, k;\r\n\r\n        // Test for NaN and round fractionDigits down\r\n        f = Number(fractionDigits);\r\n        f = f !== f ? 0 : Math.floor(f);\r\n\r\n        if (f < 0 || f > 20) {\r\n            throw new RangeError(\"Number.toFixed called with invalid number of decimals\");\r\n        }\r\n\r\n        x = Number(this);\r\n\r\n        // Test for NaN\r\n        if (x !== x) {\r\n            return \"NaN\";\r\n        }\r\n\r\n        // If it is too big or small, return the string value of the number\r\n        if (x <= -1e21 || x >= 1e21) {\r\n            return String(x);\r\n        }\r\n\r\n        s = \"\";\r\n\r\n        if (x < 0) {\r\n            s = \"-\";\r\n            x = -x;\r\n        }\r\n\r\n        m = \"0\";\r\n\r\n        if (x > 1e-21) {\r\n            // 1e-21 < x < 1e21\r\n            // -70 < log2(x) < 70\r\n            e = toFixedHelpers.log(x * toFixedHelpers.pow(2, 69, 1)) - 69;\r\n            z = (e < 0 ? x * toFixedHelpers.pow(2, -e, 1) : x / toFixedHelpers.pow(2, e, 1));\r\n            z *= 0x10000000000000; // Math.pow(2, 52);\r\n            e = 52 - e;\r\n\r\n            // -18 < e < 122\r\n            // x = z / 2 ^ e\r\n            if (e > 0) {\r\n                toFixedHelpers.multiply(0, z);\r\n                j = f;\r\n\r\n                while (j >= 7) {\r\n                    toFixedHelpers.multiply(1e7, 0);\r\n                    j -= 7;\r\n                }\r\n\r\n                toFixedHelpers.multiply(toFixedHelpers.pow(10, j, 1), 0);\r\n                j = e - 1;\r\n\r\n                while (j >= 23) {\r\n                    toFixedHelpers.divide(1 << 23);\r\n                    j -= 23;\r\n                }\r\n\r\n                toFixedHelpers.divide(1 << j);\r\n                toFixedHelpers.multiply(1, 1);\r\n                toFixedHelpers.divide(2);\r\n                m = toFixedHelpers.numToString();\r\n            } else {\r\n                toFixedHelpers.multiply(0, z);\r\n                toFixedHelpers.multiply(1 << (-e), 0);\r\n                m = toFixedHelpers.numToString() + '0.00000000000000000000'.slice(2, 2 + f);\r\n            }\r\n        }\r\n\r\n        if (f > 0) {\r\n            k = m.length;\r\n\r\n            if (k <= f) {\r\n                m = s + '0.0000000000000000000'.slice(0, f - k + 2) + m;\r\n            } else {\r\n                m = s + m.slice(0, k - f) + '.' + m.slice(k - f);\r\n            }\r\n        } else {\r\n            m = s + m;\r\n        }\r\n\r\n        return m;\r\n    }\r\n}, hasToFixedBugs);\r\n\r\n\r\n//\r\n// String\r\n// ======\r\n//\r\n\r\n// ES5 15.5.4.14\r\n// http://es5.github.com/#x15.5.4.14\r\n\r\n// [bugfix, IE lt 9, firefox 4, Konqueror, Opera, obscure browsers]\r\n// Many browsers do not split properly with regular expressions or they\r\n// do not perform the split correctly under obscure conditions.\r\n// See http://blog.stevenlevithan.com/archives/cross-browser-split\r\n// I've tested in many browsers and this seems to cover the deviant ones:\r\n//    'ab'.split(/(?:ab)*/) should be [\"\", \"\"], not [\"\"]\r\n//    '.'.split(/(.?)(.?)/) should be [\"\", \".\", \"\", \"\"], not [\"\", \"\"]\r\n//    'tesst'.split(/(s)*/) should be [\"t\", undefined, \"e\", \"s\", \"t\"], not\r\n//       [undefined, \"t\", undefined, \"e\", ...]\r\n//    ''.split(/.?/) should be [], not [\"\"]\r\n//    '.'.split(/()()/) should be [\".\"], not [\"\", \"\", \".\"]\r\n\r\nvar string_split = StringPrototype.split;\r\nif (\r\n    'ab'.split(/(?:ab)*/).length !== 2 ||\r\n    '.'.split(/(.?)(.?)/).length !== 4 ||\r\n    'tesst'.split(/(s)*/)[1] === \"t\" ||\r\n    'test'.split(/(?:)/, -1).length !== 4 ||\r\n    ''.split(/.?/).length ||\r\n    '.'.split(/()()/).length > 1\r\n) {\r\n    (function () {\r\n        var compliantExecNpcg = /()??/.exec(\"\")[1] === void 0; // NPCG: nonparticipating capturing group\r\n\r\n        StringPrototype.split = function (separator, limit) {\r\n            var string = this;\r\n            if (separator === void 0 && limit === 0) {\r\n                return [];\r\n            }\r\n\r\n            // If `separator` is not a regex, use native split\r\n            if (_toString.call(separator) !== \"[object RegExp]\") {\r\n                return string_split.call(this, separator, limit);\r\n            }\r\n\r\n            var output = [],\r\n                flags = (separator.ignoreCase ? \"i\" : \"\") +\r\n                        (separator.multiline  ? \"m\" : \"\") +\r\n                        (separator.extended   ? \"x\" : \"\") + // Proposed for ES6\r\n                        (separator.sticky     ? \"y\" : \"\"), // Firefox 3+\r\n                lastLastIndex = 0,\r\n                // Make `global` and avoid `lastIndex` issues by working with a copy\r\n                separator2, match, lastIndex, lastLength;\r\n            separator = new RegExp(separator.source, flags + \"g\");\r\n            string += \"\"; // Type-convert\r\n            if (!compliantExecNpcg) {\r\n                // Doesn't need flags gy, but they don't hurt\r\n                separator2 = new RegExp(\"^\" + separator.source + \"$(?!\\\\s)\", flags);\r\n            }\r\n            /* Values for `limit`, per the spec:\r\n             * If undefined: 4294967295 // Math.pow(2, 32) - 1\r\n             * If 0, Infinity, or NaN: 0\r\n             * If positive number: limit = Math.floor(limit); if (limit > 4294967295) limit -= 4294967296;\r\n             * If negative number: 4294967296 - Math.floor(Math.abs(limit))\r\n             * If other: Type-convert, then use the above rules\r\n             */\r\n            limit = limit === void 0 ?\r\n                -1 >>> 0 : // Math.pow(2, 32) - 1\r\n                ToUint32(limit);\r\n            while (match = separator.exec(string)) {\r\n                // `separator.lastIndex` is not reliable cross-browser\r\n                lastIndex = match.index + match[0].length;\r\n                if (lastIndex > lastLastIndex) {\r\n                    output.push(string.slice(lastLastIndex, match.index));\r\n                    // Fix browsers whose `exec` methods don't consistently return `undefined` for\r\n                    // nonparticipating capturing groups\r\n                    if (!compliantExecNpcg && match.length > 1) {\r\n                        match[0].replace(separator2, function () {\r\n                            for (var i = 1; i < arguments.length - 2; i++) {\r\n                                if (arguments[i] === void 0) {\r\n                                    match[i] = void 0;\r\n                                }\r\n                            }\r\n                        });\r\n                    }\r\n                    if (match.length > 1 && match.index < string.length) {\r\n                        ArrayPrototype.push.apply(output, match.slice(1));\r\n                    }\r\n                    lastLength = match[0].length;\r\n                    lastLastIndex = lastIndex;\r\n                    if (output.length >= limit) {\r\n                        break;\r\n                    }\r\n                }\r\n                if (separator.lastIndex === match.index) {\r\n                    separator.lastIndex++; // Avoid an infinite loop\r\n                }\r\n            }\r\n            if (lastLastIndex === string.length) {\r\n                if (lastLength || !separator.test(\"\")) {\r\n                    output.push(\"\");\r\n                }\r\n            } else {\r\n                output.push(string.slice(lastLastIndex));\r\n            }\r\n            return output.length > limit ? output.slice(0, limit) : output;\r\n        };\r\n    }());\r\n\r\n// [bugfix, chrome]\r\n// If separator is undefined, then the result array contains just one String,\r\n// which is the this value (converted to a String). If limit is not undefined,\r\n// then the output array is truncated so that it contains no more than limit\r\n// elements.\r\n// \"0\".split(undefined, 0) -> []\r\n} else if (\"0\".split(void 0, 0).length) {\r\n    StringPrototype.split = function split(separator, limit) {\r\n        if (separator === void 0 && limit === 0) { return []; }\r\n        return string_split.call(this, separator, limit);\r\n    };\r\n}\r\n\r\nvar str_replace = StringPrototype.replace;\r\nvar replaceReportsGroupsCorrectly = (function () {\r\n    var groups = [];\r\n    'x'.replace(/x(.)?/g, function (match, group) {\r\n        groups.push(group);\r\n    });\r\n    return groups.length === 1 && typeof groups[0] === 'undefined';\r\n}());\r\n\r\nif (!replaceReportsGroupsCorrectly) {\r\n    StringPrototype.replace = function replace(searchValue, replaceValue) {\r\n        var isFn = isFunction(replaceValue);\r\n        var hasCapturingGroups = isRegex(searchValue) && (/\\)[*?]/).test(searchValue.source);\r\n        if (!isFn || !hasCapturingGroups) {\r\n            return str_replace.call(this, searchValue, replaceValue);\r\n        } else {\r\n            var wrappedReplaceValue = function (match) {\r\n                var length = arguments.length;\r\n                var originalLastIndex = searchValue.lastIndex;\r\n                searchValue.lastIndex = 0;\r\n                var args = searchValue.exec(match);\r\n                searchValue.lastIndex = originalLastIndex;\r\n                args.push(arguments[length - 2], arguments[length - 1]);\r\n                return replaceValue.apply(this, args);\r\n            };\r\n            return str_replace.call(this, searchValue, wrappedReplaceValue);\r\n        }\r\n    };\r\n}\r\n\r\n// ECMA-262, 3rd B.2.3\r\n// Not an ECMAScript standard, although ECMAScript 3rd Edition has a\r\n// non-normative section suggesting uniform semantics and it should be\r\n// normalized across all browsers\r\n// [bugfix, IE lt 9] IE < 9 substr() with negative value not working in IE\r\nvar string_substr = StringPrototype.substr;\r\nvar hasNegativeSubstrBug = \"\".substr && \"0b\".substr(-1) !== \"b\";\r\ndefineProperties(StringPrototype, {\r\n    substr: function substr(start, length) {\r\n        return string_substr.call(\r\n            this,\r\n            start < 0 ? ((start = this.length + start) < 0 ? 0 : start) : start,\r\n            length\r\n        );\r\n    }\r\n}, hasNegativeSubstrBug);\r\n\r\n// ES5 15.5.4.20\r\n// whitespace from: http://es5.github.io/#x15.5.4.20\r\nvar ws = \"\\x09\\x0A\\x0B\\x0C\\x0D\\x20\\xA0\\u1680\\u180E\\u2000\\u2001\\u2002\\u2003\" +\r\n    \"\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000\\u2028\" +\r\n    \"\\u2029\\uFEFF\";\r\nvar zeroWidth = '\\u200b';\r\nvar wsRegexChars = \"[\" + ws + \"]\";\r\nvar trimBeginRegexp = new RegExp(\"^\" + wsRegexChars + wsRegexChars + \"*\");\r\nvar trimEndRegexp = new RegExp(wsRegexChars + wsRegexChars + \"*$\");\r\nvar hasTrimWhitespaceBug = StringPrototype.trim && (ws.trim() || !zeroWidth.trim());\r\ndefineProperties(StringPrototype, {\r\n    // http://blog.stevenlevithan.com/archives/faster-trim-javascript\r\n    // http://perfectionkills.com/whitespace-deviations/\r\n    trim: function trim() {\r\n        if (this === void 0 || this === null) {\r\n            throw new TypeError(\"can't convert \" + this + \" to object\");\r\n        }\r\n        return String(this).replace(trimBeginRegexp, \"\").replace(trimEndRegexp, \"\");\r\n    }\r\n}, hasTrimWhitespaceBug);\r\n\r\n// ES-5 15.1.2.2\r\nif (parseInt(ws + '08') !== 8 || parseInt(ws + '0x16') !== 22) {\r\n    parseInt = (function (origParseInt) {\r\n        var hexRegex = /^0[xX]/;\r\n        return function parseIntES5(str, radix) {\r\n            str = String(str).trim();\r\n            if (!Number(radix)) {\r\n                radix = hexRegex.test(str) ? 16 : 10;\r\n            }\r\n            return origParseInt(str, radix);\r\n        };\r\n    }(parseInt));\r\n}\r\n\r\n}));\r\n\r\n/** @namespace */\nvar ozpIwc=ozpIwc || {};\n\n/**\n\t* @class\n\t*/\nozpIwc.Event=function() {\n\tthis.events={};\n};\n\n/**\n * Registers a handler for the the event.\n * @param {string} event The name of the event to trigger on\n * @param {function} callback Function to be invoked\n * @param {object} [self] Used as the this pointer when callback is invoked.\n * @returns {object} A handle that can be used to unregister the callback via [off()]{@link ozpIwc.Event#off}\n */\nozpIwc.Event.prototype.on=function(event,callback,self) {\n\tvar wrapped=callback;\n\tif(self) {\n\t\twrapped=function() {\n\t\t\tcallback.apply(self,arguments);\n\t\t};\n\t\twrapped.ozpIwcDelegateFor=callback;\n\t}\n\tthis.events[event]=this.events[event]||[];\n\tthis.events[event].push(wrapped);\n\treturn wrapped;\n};\n\n/**\n * Unregisters an event handler previously registered.\n * @param {type} event\n * @param {type} callback\n */\nozpIwc.Event.prototype.off=function(event,callback) {\n\tthis.events[event]=(this.events[event]||[]).filter( function(h) {\n\t\treturn h!==callback && h.ozpIwcDelegateFor !== callback;\n\t});\n};\n\n/**\n * Fires an event that will be received by all handlers.\n * @param {string} eventName  - Name of the event\n * @param {object} event - Event object to pass to the handers.\n * @returns {object} The event after all handlers have processed it\n */\nozpIwc.Event.prototype.trigger=function(eventName,event) {\n\tevent = event || new ozpIwc.CancelableEvent();\n\tvar handlers=this.events[eventName] || [];\n\n\thandlers.forEach(function(h) {\n\t\th(event);\n\t});\n\treturn event;\n};\n\n\n/**\n * Adds an on() and off() function to the target that delegate to this object\n * @param {object} target Target to receive the on/off functions\n */\nozpIwc.Event.prototype.mixinOnOff=function(target) {\n\tvar self=this;\n\ttarget.on=function() { return self.on.apply(self,arguments);};\n\ttarget.off=function() { return self.off.apply(self,arguments);};\n};\n\n/**\n * Convenient base for events that can be canceled.  Provides and manages\n * the properties canceled and cancelReason, as well as the member function\n * cancel().\n * @class\n * @param {object} data - Data that will be copied into the event\n */\nozpIwc.CancelableEvent=function(data) {\n\tdata = data || {};\n\tfor(var k in data) {\n\t\tthis[k]=data[k];\n\t}\n\tthis.canceled=false;\n\tthis.cancelReason=null;\n};\n\n/**\n * Marks the event as canceled.\n * @param {type} reason - A text description of why the event was canceled.\n * @returns {ozpIwc.CancelableEvent} Reference to self\n */\nozpIwc.CancelableEvent.prototype.cancel=function(reason) {\n\treason= reason || \"Unknown\";\n\tthis.canceled=true;\n\tthis.cancelReason=reason;\n\treturn this;\n};\n\r\n/** @namespace */\nvar ozpIwc=ozpIwc || {};\n\n/**\n * @type {object}\n * @property {function} log - Normal log output.\n * @property {function} error - Error output.\n */\nozpIwc.log=ozpIwc.log || {\n\tlog: function() {\n\t\tif(window.console && typeof(window.console.log)===\"function\") {\n\t\t\twindow.console.log.apply(window.console,arguments);\n\t\t}\n\t},\n\terror: function() {\n\t\tif(window.console && typeof(window.console.error)===\"function\") {\n\t\t\twindow.console.error.apply(window.console,arguments);\n\t\t}\n\t}\n};\n\r\n/** @namespace */\nvar ozpIwc=ozpIwc || {};\n\n/** @namespace */\nozpIwc.util=ozpIwc.util || {};\n\n/**\n * Generates a large hexidecimal string to serve as a unique ID.  Not a guid.\n * @returns {String}\n */\nozpIwc.util.generateId=function() {\n    return Math.floor(Math.random() * 0xffffffff).toString(16);\n};\n\n/**\n * Used to get the current epoch time.  Tests overrides this\n * to allow a fast-forward on time-based actions.\n * @returns {Number}\n */\nozpIwc.util.now=function() {\n    return new Date().getTime();\n};\n\n/**\n * Create a class with the given parent in it's prototype chain.\n * @param {function} baseClass - the class being derived from\n * @param {function} newConstructor - the new base class\n * @returns {Function} newConstructor with an augmented prototype\n */\nozpIwc.util.extend=function(baseClass,newConstructor) {\n    if(!baseClass || !baseClass.prototype) {\n        console.error(\"Cannot create a new class for \",newConstructor,\" due to invalid baseclass:\",baseClass);\n        throw new Error(\"Cannot create a new class due to invalid baseClass.  Dependency not loaded first?\");\n    };\n    newConstructor.prototype = Object.create(baseClass.prototype);\n    newConstructor.prototype.constructor = newConstructor;\n    return newConstructor;\n};\n\n/**\n * Invokes the callback handler on another event loop as soon as possible.\n*/\nozpIwc.util.setImmediate=function(f) {\n//    window.setTimeout(f,0);\n    window.setImmediate(f);\n};\n\n/**\n * Detect browser support for structured clones.\n * @returns {boolean} - true if structured clones are supported,\n * false otherwise\n */\nozpIwc.util.structuredCloneSupport=function() {\n    if (ozpIwc.util.structuredCloneSupport.cache !== undefined) {\n        return ozpIwc.util.structuredCloneSupport.cache;\n    }\n    var onlyStrings = false;\n    //If the browser doesn't support structured clones, it will call toString() on the object passed to postMessage.\n    //A bug in FF will cause File clone to fail (see https://bugzilla.mozilla.org/show_bug.cgi?id=722126)\n    //We detect this using a test Blob\n    try {\n        window.postMessage({\n            toString: function () {\n                onlyStrings = true;\n            },\n            blob: new Blob()\n        }, \"*\");\n    } catch (e) {\n        onlyStrings=true;\n    }\n    ozpIwc.util.structuredCloneSupport.cache=!onlyStrings;\n    return ozpIwc.util.structuredCloneSupport.cache;\n};\n\nozpIwc.util.structuredCloneSupport.cache=undefined;\n\n/**\n * Does a deep clone of a serializable object.  Note that this will not\n * clone unserializable objects like DOM elements, Date, RegExp, etc.\n * @param {type} value - value to be cloned.\n * @returns {object} - a deep copy of the object\n */\nozpIwc.util.clone=function(value) {\n\tif(Array.isArray(value) || typeof(value) === 'object') {\n        try {\n            return JSON.parse(JSON.stringify(value));\n        } catch (e) {\n            console.log(e);\n        }\n\t} else {\n\t\treturn value;\n\t}\n};\n\n\n/**\n * Returns true if every needle is found in the haystack.\n * @param {array} haystack - The array to search.\n * @param {array} needles - All of the values to search.\n * @param {function} [equal] - What constitutes equality.  Defaults to a===b.\n * @returns {boolean}\n */\nozpIwc.util.arrayContainsAll=function(haystack,needles,equal) {\n    equal=equal || function(a,b) { return a===b;};\n    return needles.every(function(needle) { \n        return haystack.some(function(hay) { \n            return equal(hay,needle);\n        });\n    });\n};\n\n\n/**\n * Returns true if the value every attribute in needs is equal to \n * value of the same attribute in haystack.\n * @param {array} haystack - The object that must contain all attributes and values.\n * @param {array} needles - The reference object for the attributes and values.\n * @param {function} [equal] - What constitutes equality.  Defaults to a===b.\n * @returns {boolean}\n */\nozpIwc.util.objectContainsAll=function(haystack,needles,equal) {\n    equal=equal || function(a,b) { return a===b;};\n    \n    for(var attribute in needles) {\n        if(!equal(haystack[attribute],needles[attribute])) {\n            return false;\n        }\n    }\n    return true;\n};\n\nozpIwc.util.parseQueryParams=function(query) {\n    query = query || window.location.search;\n    var params={};\n\tvar regex=/\\??([^&=]+)=?([^&]*)/g;\n\tvar match;\n\twhile(match=regex.exec(query)) {\n\t\tparams[match[1]]=decodeURIComponent(match[2]);\n\t}\n    return params;\n};\n\nozpIwc.util.ajax = function (config) {\n\n    var result = new ozpIwc.AsyncAction();\n    var request = new XMLHttpRequest();\n\n    request.onreadystatechange = function() {\n        if (request.readyState !== 4) {\n            return;\n        }\n\n        if (request.status === 200) {\n            result.resolve(\"success\", JSON.parse(this.responseText));\n        } else {\n            result.resolve(\"failure\", this.statusText, this.responseText);\n        }\n    };\n    request.open(config.method, config.href, true);\n\n    if(config.method === \"POST\") {\n        request.send(config.data);\n    }\n    request.setRequestHeader(\"Content-Type\", \"application/json\");\n    request.setRequestHeader(\"Cache-Control\", \"no-cache\");\n    request.send();\n\n    return result;\n};\r\n/*\n * The MIT License (MIT) Copyright (c) 2012 Mike Ihbe\n * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated \n * documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation \n * the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and\n * to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all copies or substantial \n * portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO \n * THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, \n * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/*\n * Original code owned by Mike Ihbe.  Modifications licensed under same terms.\n */\nvar ozpIwc=ozpIwc || {};\nozpIwc.metricsStats=ozpIwc.metricsStats || {};\n\nozpIwc.metricsStats.DEFAULT_POOL_SIZE=1028;\n\nozpIwc.metricsStats.Sample = function(){\n\tthis.clear();\n};\n\nozpIwc.metricsStats.Sample.prototype.update = function(val){ \n\tthis.values.push(val); \n};\n\nozpIwc.metricsStats.Sample.prototype.clear = function(){ \n\tthis.values = []; \n\tthis.count = 0; \n};\nozpIwc.metricsStats.Sample.prototype.size = function(){ \n\treturn this.values.length;\n};\n\nozpIwc.metricsStats.Sample.prototype.getValues = function(){ \n\treturn this.values; \n};\n\n\n/**\n *  Take a uniform sample of size size for all values\n *  @class\n *  @param {Number} [size=ozpIwc.metricsStats.DEFAULT_POOL_SIZE] - The size of the sample pool.\n */\nozpIwc.metricsStats.UniformSample=ozpIwc.util.extend(ozpIwc.metricsStats.Sample,function(size) {\n\tozpIwc.metricsStats.Sample.apply(this);\n  this.limit = size || ozpIwc.metricsStats.DEFAULT_POOL_SIZE;\n});\n\nozpIwc.metricsStats.UniformSample.prototype.update = function(val) {\n  this.count++;\n  if (this.size() < this.limit) {\n    this.values.push(val);\n  } else {\n    var rand = parseInt(Math.random() * this.count);\n    if (rand < this.limit) {\n      this.values[rand] = val;\n    }\n  }\n};\n\r\n// From http://eloquentjavascript.net/appendix2.html, \n// licensed under CCv3.0: http://creativecommons.org/licenses/by/3.0/\n\nvar ozpIwc=ozpIwc || {};\nozpIwc.metricsStats=ozpIwc.metricsStats || {};\n/**\n * This acts as a ordered binary heap for any serializeable JS object or collection of such objects \n * <p>Borrowed from https://github.com/mikejihbe/metrics. Originally from from http://eloquentjavascript.net/appendix2.html\n * <p>Licenced under CCv3.0\n * @class\n * @param {type} scoreFunction\n * @returns {BinaryHeap}\n */\nozpIwc.metricsStats.BinaryHeap = function BinaryHeap(scoreFunction){\n  this.content = [];\n  this.scoreFunction = scoreFunction;\n};\n\nozpIwc.metricsStats.BinaryHeap.prototype = {\n\n  clone: function() {\n    var heap = new ozpIwc.metricsStats.BinaryHeap(this.scoreFunction);\n    // A little hacky, but effective.\n    heap.content = JSON.parse(JSON.stringify(this.content));\n    return heap;\n  },\n\n  push: function(element) {\n    // Add the new element to the end of the array.\n    this.content.push(element);\n    // Allow it to bubble up.\n    this.bubbleUp(this.content.length - 1);\n  },\n\n  peek: function() {\n    return this.content[0];\n  },\n\n  pop: function() {\n    // Store the first element so we can return it later.\n    var result = this.content[0];\n    // Get the element at the end of the array.\n    var end = this.content.pop();\n    // If there are any elements left, put the end element at the\n    // start, and let it sink down.\n    if (this.content.length > 0) {\n      this.content[0] = end;\n      this.sinkDown(0);\n    }\n    return result;\n  },\n\n  remove: function(node) {\n    var len = this.content.length;\n    // To remove a value, we must search through the array to find\n    // it.\n    for (var i = 0; i < len; i++) {\n      if (this.content[i] == node) {\n        // When it is found, the process seen in 'pop' is repeated\n        // to fill up the hole.\n        var end = this.content.pop();\n        if (i != len - 1) {\n          this.content[i] = end;\n          if (this.scoreFunction(end) < this.scoreFunction(node))\n            this.bubbleUp(i);\n          else\n            this.sinkDown(i);\n        }\n        return true;\n      }\n    }\n    throw new Error(\"Node not found.\");\n  },\n\n  size: function() {\n    return this.content.length;\n  },\n\n  bubbleUp: function(n) {\n    // Fetch the element that has to be moved.\n    var element = this.content[n];\n    // When at 0, an element can not go up any further.\n    while (n > 0) {\n      // Compute the parent element's index, and fetch it.\n      var parentN = Math.floor((n + 1) / 2) - 1,\n          parent = this.content[parentN];\n      // Swap the elements if the parent is greater.\n      if (this.scoreFunction(element) < this.scoreFunction(parent)) {\n        this.content[parentN] = element;\n        this.content[n] = parent;\n        // Update 'n' to continue at the new position.\n        n = parentN;\n      }\n      // Found a parent that is less, no need to move it further.\n      else {\n        break;\n      }\n    }\n  },\n\n  sinkDown: function(n) {\n    // Look up the target element and its score.\n    var length = this.content.length,\n        element = this.content[n],\n        elemScore = this.scoreFunction(element);\n\n    while(true) {\n      // Compute the indices of the child elements.\n      var child2N = (n + 1) * 2, child1N = child2N - 1;\n      // This is used to store the new position of the element,\n      // if any.\n      var swap = null;\n      // If the first child exists (is inside the array)...\n      if (child1N < length) {\n        // Look it up and compute its score.\n        var child1 = this.content[child1N],\n            child1Score = this.scoreFunction(child1);\n        // If the score is less than our element's, we need to swap.\n        if (child1Score < elemScore)\n          swap = child1N;\n      }\n      // Do the same checks for the other child.\n      if (child2N < length) {\n        var child2 = this.content[child2N],\n            child2Score = this.scoreFunction(child2);\n        if (child2Score < (swap == null ? elemScore : child1Score))\n          swap = child2N;\n      }\n\n      // If the element needs to be moved, swap it, and continue.\n      if (swap != null) {\n        this.content[n] = this.content[swap];\n        this.content[swap] = element;\n        n = swap;\n      }\n      // Otherwise, we are done.\n      else {\n        break;\n      }\n    }\n  }\n};\n\n\r\n/*\n * The MIT License (MIT) Copyright (c) 2012 Mike Ihbe\n * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated \n * documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation \n * the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and\n * to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all copies or substantial \n * portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO \n * THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, \n * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/*\n * Original code owned by Mike Ihbe.  Modifications licensed under same terms.\n */\nvar ozpIwc=ozpIwc || {};\nozpIwc.metricsStats=ozpIwc.metricsStats || {};\n\n//  Take an exponentially decaying sample of size size of all values\nozpIwc.metricsStats.DEFAULT_RESCALE_THRESHOLD = 60 * 60 * 1000; // 1 hour in milliseconds\nozpIwc.metricsStats.DEFAULT_DECAY_ALPHA=0.015;\n/**\n * This acts as a ordered binary heap for any serializeable JS object or collection of such objects \n * <p>Borrowed from https://github.com/mikejihbe/metrics. \n * @class \n\t*/\nozpIwc.metricsStats.ExponentiallyDecayingSample=ozpIwc.util.extend(ozpIwc.metricsStats.Sample,function(size, alpha) {\n\tozpIwc.metricsStats.Sample.apply(this);\n  this.limit = size || ozpIwc.metricsStats.DEFAULT_POOL_SIZE;\n  this.alpha = alpha || ozpIwc.metricsStats.DEFAULT_DECAY_ALPHA;\n\tthis.rescaleThreshold = ozpIwc.metricsStats.DEFAULT_RESCALE_THRESHOLD;\n});\n\n// This is a relatively expensive operation\nozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.getValues = function() {\n  var values = [];\n  var heap = this.values.clone();\n\tvar elt;\n  while(elt = heap.pop()) {\n    values.push(elt.val);\n  }\n  return values;\n};\n\nozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.size = function() {\n  return this.values.size();\n};\n\nozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.newHeap = function() {\n  return new ozpIwc.metricsStats.BinaryHeap(function(obj){return obj.priority;});\n};\n\nozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.now = function() {\n  return ozpIwc.util.now();\n};\n\nozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.tick = function() {\n  return this.now() / 1000;\n};\n\nozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.clear = function() {\n  this.values = this.newHeap();\n  this.count = 0;\n  this.startTime = this.tick();\n  this.nextScaleTime = this.now() + this.rescaleThreshold;\n};\n\n/*\n* timestamp in milliseconds\n*/\nozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.update = function(val, timestamp) {\n  // Convert timestamp to seconds\n  if (timestamp == undefined) {\n    timestamp = this.tick();\n  } else {\n    timestamp = timestamp / 1000;\n  }\n  var priority = this.weight(timestamp - this.startTime) / Math.random()\n    , value = {val: val, priority: priority};\n  if (this.count < this.limit) {\n    this.count += 1;\n    this.values.push(value);\n  } else {\n    var first = this.values.peek();\n    if (first.priority < priority) {\n      this.values.push(value);\n      this.values.pop();\n    }\n  }\n\n  if (this.now() > this.nextScaleTime) {\n    this.rescale();\n  }\n};\n\nozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.weight = function(time) {\n  return Math.exp(this.alpha * time);\n};\n\nozpIwc.metricsStats.ExponentiallyDecayingSample.prototype.rescale = function() {\n  this.nextScaleTime = this.now() + this.rescaleThreshold;\n  var oldContent = this.values.content\n    , newContent = []\n    , elt\n    , oldStartTime = this.startTime;\n  this.startTime = this.tick();\n  // Downscale every priority by the same factor. Order is unaffected, which is why we're avoiding the cost of popping.\n  for(var i = 0; i < oldContent.length; i++) {\n    newContent.push({val: oldContent[i].val, priority: oldContent[i].priority * Math.exp(-this.alpha * (this.startTime - oldStartTime))});\n  }\n  this.values.content = newContent;\n};\n\r\n/*\n * The MIT License (MIT) Copyright (c) 2012 Mike Ihbe\n * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated \n * documentation files (the \"Software\"), to deal in the Software without restriction, including without limitation \n * the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and\n * to permit persons to whom the Software is furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in all copies or substantial \n * portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO \n * THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE \n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, \n * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\n/*\n * Original code owned by Mike Ihbe.  Modifications licensed under same terms.\n */\nvar ozpIwc=ozpIwc || {};\nozpIwc.metricsStats=ozpIwc.metricsStats || {};\n\n/*\n *  Exponentially weighted moving average.\n *  Args: \n *  - alpha:\n *  - interval: time in milliseconds\n */\n\nozpIwc.metricsStats.M1_ALPHA = 1 - Math.exp(-5/60);\nozpIwc.metricsStats.M5_ALPHA = 1 - Math.exp(-5/60/5);\nozpIwc.metricsStats.M15_ALPHA = 1 - Math.exp(-5/60/15);\n\nozpIwc.metricsStats.ExponentiallyWeightedMovingAverage=function(alpha, interval) {\n  this.alpha = alpha;\n  this.interval = interval || 5000;\n  this.currentRate = null;\n  this.uncounted = 0;\n\tthis.lastTick=ozpIwc.util.now();\n};\n\nozpIwc.metricsStats.ExponentiallyWeightedMovingAverage.prototype.update = function(n) {\n  this.uncounted += (n || 1);\n\tthis.tick();\n};\n\n/*\n * Update our rate measurements every interval\n */\nozpIwc.metricsStats.ExponentiallyWeightedMovingAverage.prototype.tick = function() {\n \tvar now=ozpIwc.util.now();\n\tvar age=now-this.lastTick;\n\tif(age > this.interval) {\n\t\tthis.lastTick=now - (age % this.interval);\n\t\tvar requiredTicks=Math.floor(age / this.interval);\n\t\tfor(var i=0; i < requiredTicks; ++i) {\n\t\t\tvar instantRate = this.uncounted / this.interval;\n\t\t\tthis.uncounted = 0;\n\t\t\tif(this.currentRate!==null) {\n\t\t\t\tthis.currentRate += this.alpha * (instantRate - this.currentRate);\n\t\t\t} else {\n\t\t\t\tthis.currentRate = instantRate;\n\t\t\t}\n\t\t}\n\t}\n};\n\n/*\n * Return the rate per second\n */\nozpIwc.metricsStats.ExponentiallyWeightedMovingAverage.prototype.rate = function() {\n  return this.currentRate * 1000;\n};\n\r\nvar ozpIwc=ozpIwc || {};\nozpIwc.metricTypes=ozpIwc.metricTypes || {};\n\n/**\n * @typedef {object} ozpIwc.MetricType \n * @property {function} get - returns the current value of the metric\n */\n\nozpIwc.metricTypes.BaseMetric=function() {\n\tthis.value=0;\n    this.name=\"\";\n    this.unitName=\"\";\n};\n\nozpIwc.metricTypes.BaseMetric.prototype.get=function() { \n\treturn this.value; \n};\n\nozpIwc.metricTypes.BaseMetric.prototype.unit=function(val) { \n\tif(val) {\n\t\tthis.unitName=val;\n\t\treturn this;\n\t}\n\treturn this.unitName; \n};\n\n\n\n\r\n/**\r\n * @class\r\n * @extends ozpIwc.MetricType\r\n * A counter running total that can be adjusted up or down.\r\n * Where a meter is set to a known value at each update, a\r\n * counter is incremented up or down by a known change.\r\n */\r\nozpIwc.metricTypes.Counter=ozpIwc.util.extend(ozpIwc.metricTypes.BaseMetric,function() {\r\n\tozpIwc.metricTypes.BaseMetric.apply(this,arguments);\r\n\tthis.value=0;\r\n});\r\n\r\n/**\r\n * @param {Number} [delta=1] - Increment by this value\r\n * @returns {Number} - Value of the counter after increment\r\n */\r\nozpIwc.metricTypes.Counter.prototype.inc=function(delta) { \r\n\treturn this.value+=(delta?delta:1);\r\n};\r\n\r\n/**\r\n * @param {Number} [delta=1] - Decrement by this value\r\n * @returns {Number} - Value of the counter after decrement\r\n */\r\nozpIwc.metricTypes.Counter.prototype.dec=function(delta) { \r\n\treturn this.value-=(delta?delta:1);\r\n};\r\n\r\nozpIwc.metricTypes=ozpIwc.metricTypes || {};\r\n/**\r\n * @callback ozpIwc.metricTypes.Gauge~gaugeCallback\r\n * @returns {ozpIwc.metricTypes.MetricsTree} \r\n */\r\n\r\n/**\r\n * @class\r\n * @extends ozpIwc.MetricType\r\n * A gauge is an externally defined set of metrics returned by a callback function\r\n * @param {ozpIwc.metricTypes.Gauge~gaugeCallback} metricsCallback\r\n */\r\nozpIwc.metricTypes.Gauge=ozpIwc.util.extend(ozpIwc.metricTypes.BaseMetric,function(metricsCallback) {\r\n\tozpIwc.metricTypes.BaseMetric.apply(this,arguments);\r\n\tthis.callback=metricsCallback;\r\n});\r\n/**\r\n * Set the metrics callback for this gauge.\r\n * @param {ozpIwc.metricTypes.Gauge~gaugeCallback} metricsCallback\r\n * @returns {ozpIwc.metricTypes.Gauge} this\r\n */\r\nozpIwc.metricTypes.Gauge.prototype.set=function(metricsCallback) { \r\n\tthis.callback=metricsCallback;\r\n\treturn this;\r\n};\r\n/**\r\n * Executes the callback and returns a metrics tree.\r\n * @returns {ozpIwc.metricTypes.MetricsTree}\r\n */\r\nozpIwc.metricTypes.Gauge.prototype.get=function() {\r\n    if (this.callback) {\r\n        return this.callback();\r\n    }\r\n    return undefined;\r\n};\r\n\r\n/**\r\n * @class\r\n * @extends ozpIwc.BaseMetric\r\n */\r\nozpIwc.metricTypes.Histogram=ozpIwc.util.extend(ozpIwc.metricTypes.BaseMetric,function() {\r\n\tozpIwc.metricTypes.BaseMetric.apply(this,arguments);\r\n\tthis.sample = new ozpIwc.metricsStats.ExponentiallyDecayingSample();\r\n\tthis.clear();\r\n});\r\n\r\n\r\nozpIwc.metricTypes.Histogram.prototype.clear=function() {\r\n\tthis.sample.clear();\r\n\tthis.min=this.max=null;\r\n\tthis.varianceMean=0;\r\n\tthis.varianceM2=0;\r\n\tthis.sum=0;\r\n\tthis.count=0;\t\r\n};\r\n\r\n/**\r\n * @param {Number} [delta=1] - Increment by this value\r\n * @returns {Number} - Value of the counter after increment\r\n */\r\nozpIwc.metricTypes.Histogram.prototype.mark=function(val,timestamp) { \r\n\ttimestamp = timestamp || ozpIwc.util.now();\r\n\t\r\n\tthis.sample.update(val,timestamp);\r\n\t\r\n\tthis.max=(this.max===null?val:Math.max(this.max,val));\r\n\tthis.min=(this.min===null?val:Math.min(this.min,val));\r\n\tthis.sum+=val;\r\n\tthis.count++;\r\n\t\r\n\tvar delta=val - this.varianceMean;\r\n\tthis.varianceMean += delta/this.count;\r\n\tthis.varianceM2 += delta * (val - this.varianceMean);\r\n\r\n\treturn this.count;\r\n};\r\n\r\nozpIwc.metricTypes.Histogram.prototype.get=function() { \r\n\tvar values=this.sample.getValues().map(function(v){\r\n\t\treturn parseFloat(v);\r\n\t}).sort(function(a,b) { \r\n\t\treturn a-b;\r\n\t});\r\n\tvar percentile=function(p) {\r\n\t\tvar pos=p *(values.length);\r\n\t\tif(pos >= values.length) {\r\n\t\t\treturn values[values.length-1];\r\n\t\t}\r\n\t\tpos=Math.max(0,pos);\r\n\t\tpos=Math.min(pos,values.length+1);\r\n\t\tvar lower = values[Math.floor(pos)-1];\r\n\t\tvar upper = values[Math.floor(pos)];\r\n\t\treturn lower+(pos-Math.floor(pos))*(upper-lower);\r\n\t};\r\n\r\n\treturn {\r\n\t\t'percentile_10': percentile(0.10),\r\n\t\t'percentile_25': percentile(0.25),\t\t\t\t\r\n\t\t'median': percentile(0.50),\t\t\t\t\r\n\t\t'percentile_75': percentile(0.75),\t\t\t\t\r\n\t\t'percentile_90': percentile(0.90),\t\t\t\t\r\n\t\t'percentile_95': percentile(0.95),\t\t\t\t\r\n\t\t'percentile_99': percentile(0.99),\t\t\t\t\r\n\t\t'percentile_999': percentile(0.999),\t\t\t\t\r\n\t\t'variance' : this.count < 1 ? null : this.varianceM2 / (this.count -1),\r\n\t\t'mean' : this.count === 0 ? null : this.varianceMean,\r\n\t\t'stdDev' : this.count < 1 ? null : Math.sqrt(this.varianceM2 / (this.count -1)),\r\n\t\t'count' : this.count,\r\n\t\t'sum' : this.sum,\r\n\t\t'max' : this.max,\r\n\t\t'min' : this.min\r\n\t};\r\n};\r\n\r\n\r\n/**\r\n * @class\r\n * @extends ozpIwc.BaseMetric\r\n */\r\nozpIwc.metricTypes.Meter=ozpIwc.util.extend(ozpIwc.metricTypes.BaseMetric,function() {\r\n\tozpIwc.metricTypes.BaseMetric.apply(this,arguments);\r\n\tthis.m1Rate= new ozpIwc.metricsStats.ExponentiallyWeightedMovingAverage(ozpIwc.metricsStats.M1_ALPHA);\r\n\tthis.m5Rate= new ozpIwc.metricsStats.ExponentiallyWeightedMovingAverage(ozpIwc.metricsStats.M5_ALPHA);\r\n\tthis.m15Rate= new ozpIwc.metricsStats.ExponentiallyWeightedMovingAverage(ozpIwc.metricsStats.M15_ALPHA);\r\n\tthis.startTime=ozpIwc.util.now();\r\n\tthis.value=0;\r\n});\r\n\r\n/**\r\n * @param {Number} [delta=1] - Increment by this value\r\n * @returns {Number} - Value of the counter after increment\r\n */\r\nozpIwc.metricTypes.Meter.prototype.mark=function(delta) { \r\n\tdelta=delta || 1;\r\n\tthis.value+=delta;\r\n\tthis.m1Rate.update(delta);\r\n\tthis.m5Rate.update(delta);\r\n\tthis.m15Rate.update(delta);\r\n\t\r\n\treturn this.value;\r\n};\r\n\r\nozpIwc.metricTypes.Meter.prototype.get=function() { \r\n\treturn {\r\n\t\t'rate_1m' : this.m1Rate.rate(),\r\n\t\t'rate_5m' : this.m5Rate.rate(),\r\n\t\t'rate_15m' : this.m15Rate.rate(),\r\n\t\t'rate_mean' : this.value / (ozpIwc.util.now() - this.startTime) * 1000,\r\n\t\t'count' : this.value\r\n\t};\r\n};\r\n\r\nozpIwc.metricTypes.Meter.prototype.tick=function() { \r\n\tthis.m1Rate.tick();\r\n\tthis.m5Rate.tick();\r\n\tthis.m15Rate.tick();\r\n};\r\n\r\nozpIwc.metricTypes.Timer=ozpIwc.util.extend(ozpIwc.metricTypes.BaseMetric,function() {\n\tozpIwc.metricTypes.BaseMetric.apply(this,arguments);\n\tthis.meter=new ozpIwc.metricTypes.Meter();\n\tthis.histogram=new ozpIwc.metricTypes.Histogram();\n});\n\nozpIwc.metricTypes.Timer.prototype.mark=function(val,time) {\n\tthis.meter.mark();\n\tthis.histogram.mark(val,time);\n};\n\nozpIwc.metricTypes.Timer.prototype.start=function() {\n\tvar self=this;\n\tvar startTime=ozpIwc.util.now();\n\treturn function() {\n\t\tvar endTime=ozpIwc.util.now();\n\t\tself.mark(endTime-startTime,endTime);\n\t};\n};\n\nozpIwc.metricTypes.Timer.prototype.time=function(callback) {\n\tvar startTime=ozpIwc.util.now();\n\ttry {\n\t\tcallback();\n\t} finally {\n\t\tvar endTime=ozpIwc.util.now();\n\t\tthis.mark(endTime-startTime,endTime);\n\t}\n};\n\nozpIwc.metricTypes.Timer.prototype.get=function() {\n\tvar val=this.histogram.get();\n\tvar meterMetrics=this.meter.get();\n\tfor(var k in meterMetrics) {\n\t\tval[k]=meterMetrics[k];\n\t}\n\treturn val;\n};\r\nvar ozpIwc=ozpIwc || {};\r\n\r\n/**\r\n * @class\r\n * A repository of metrics\r\n */\r\nozpIwc.MetricsRegistry=function() {\r\n\tthis.metrics={};\r\n    var self=this;\r\n    this.gauge('registry.metrics.types').set(function() {\r\n        return Object.keys(self.metrics).length;\r\n    });\r\n\r\n};\r\n\r\n/**\r\n * \r\n * @private\r\n * @param {string} name - Name of the metric\r\n * @param {function} type - The constructor of the requested type for this metric.\r\n * @returns {MetricType} - Null if the metric already exists of a different type.  Otherwise a reference to the metric.\r\n */\r\nozpIwc.MetricsRegistry.prototype.findOrCreateMetric=function(name,type) {\r\n\tvar m= this.metrics[name];\r\n    if(!m) {\r\n        m = this.metrics[name] = new type();\r\n        m.name=name;\r\n        return m;\r\n    }\r\n\tif(m instanceof type){\r\n\t\t\treturn m;\r\n\t} else {\r\n\t\t\treturn null;\r\n\t}\t\t\t\r\n};\r\n\r\n/**\r\n * Joins the arguments together into a name.\r\n * @private\r\n * @param {string[]} args - Array or the argument-like \"arguments\" value.\r\n * @returns {string}\r\n */\r\nozpIwc.MetricsRegistry.prototype.makeName=function(args) {\r\n\t// slice is necessary because \"arguments\" isn't a real array, and it's what\r\n\t// is usually passed in, here.\r\n\treturn Array.prototype.slice.call(args).join(\".\");\r\n};\r\n\r\n/**\r\n * @param {...string} name - components of the name\r\n * @returns {ozpIwc.metricTypes.Counter}\r\n */\r\nozpIwc.MetricsRegistry.prototype.counter=function(name) {\r\n\treturn this.findOrCreateMetric(this.makeName(arguments),ozpIwc.metricTypes.Counter);\r\n};\r\n\r\n/**\r\n * @param {...string} name - components of the name\r\n * @returns {ozpIwc.metricTypes.Meter}\r\n */\r\nozpIwc.MetricsRegistry.prototype.meter=function(name) {\r\n\treturn this.findOrCreateMetric(this.makeName(arguments),ozpIwc.metricTypes.Meter);\r\n};\r\n\r\n/**\r\n * @param {...string} name - components of the name\r\n * @returns {ozpIwc.metricTypes.Gauge}\r\n */\r\nozpIwc.MetricsRegistry.prototype.gauge=function(name) {\r\n\treturn this.findOrCreateMetric(this.makeName(arguments),ozpIwc.metricTypes.Gauge);\r\n};\r\n\r\n/**\r\n * @param {...string} name - components of the name\r\n * @returns {ozpIwc.metricTypes.Gauge}\r\n */\r\nozpIwc.MetricsRegistry.prototype.histogram=function(name) {\r\n\treturn this.findOrCreateMetric(this.makeName(arguments),ozpIwc.metricTypes.Histogram);\r\n};\r\n\r\n/**\r\n * @param {...string} name - components of the name\r\n * @returns {ozpIwc.metricTypes.Gauge}\r\n */\r\nozpIwc.MetricsRegistry.prototype.timer=function(name) {\r\n\treturn this.findOrCreateMetric(this.makeName(arguments),ozpIwc.metricTypes.Timer);\r\n};\r\n\r\n/**\r\n * @param {...string} name - components of the name\r\n * @returns {ozpIwc.metricTypes.Gauge}\r\n */\r\nozpIwc.MetricsRegistry.prototype.register=function(name,metric) {\r\n\tthis.metrics[this.makeName(name)]=metric;\r\n\t\r\n\treturn metric;\r\n};\r\n\r\n/**\r\n * \r\n * @returns {unresolved}\r\n */\r\nozpIwc.MetricsRegistry.prototype.toJson=function() {\r\n\tvar rv={};\r\n\tfor(var k in this.metrics) {\r\n\t\tvar path=k.split(\".\");\r\n\t\tvar pos=rv;\r\n\t\twhile(path.length > 1) {\r\n\t\t\tvar current=path.shift();\r\n\t\t\tpos = pos[current]=pos[current] || {};\r\n\t\t}\r\n\t\tpos[path[0]]=this.metrics[k].get();\r\n\t}\r\n\treturn rv;\r\n};\r\n\r\nozpIwc.MetricsRegistry.prototype.allMetrics=function() {\r\n    var rv=[];\r\n    for(var k in this.metrics) {\r\n        rv.push(this.metrics[k]);\r\n    }\r\n    return rv;\r\n};\r\n\r\nozpIwc.metrics=new ozpIwc.MetricsRegistry();\r\n\r\n//# sourceMappingURL=ozpIwc-metrics.js.map"]}