<!DOCTYPE html>
<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
    <link href='http://fonts.googleapis.com/css?family=Ubuntu' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="css/style.css">
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular.min.js"></script>
    <script src="js/app.js"></script>
</head>

<body ng-app="app">
    <a href="https://github.com/ozone-development/ozp-iwc">
        <img style="position: absolute; top: 0; right: 0; border: 0; z-index:1;"
             src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67"
             alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png">
    </a>
    <div ng-controller="mainController" class="container-fluid col-md-8 col-md-offset-2 col-sm-10 col-sm-offset-1 col-xs-12 jumbotron">
        <div class="row headRow">
            <img src="img/IWC_logo.png" id="iwcLogo">
            <img src="img/Ozone_logo.png" id="ozoneLogo">
        </div>
        <h1>Data Api</h1>
        <div class="row bodyRow">
            <p>
                A simple key/value JSON store for sharing common resources amongst applications. Has backend
                connections for persisting storage if applications choose to.
            </p>
        </div>
        <div class="row bodyRow">
            <h2 class="textTitle">Actions</h2>
            <ul><a href=""><b>get:</b></a> Requests the Data API to return the resource stored with a specific key.</ul>
            <ul><a href=""><b>set:</b></a> Requests the Data API to store the given resource with the given key.</ul>
            <ul><a href=""><b>list:</b></a> Requests the Data API to return a list of children keys pertaining to a specific key.</ul>
            <ul><a href=""><b>watch:</b></a> Requests the Data API to respond any time the resource of the given key changes.</ul>
            <ul><a href=""><b>unwatch:</b></a> Requests the Data API to stop responding to a specified watch request.</ul>
            <ul><a href=""><b>addChild:</b></a> Requests the Data API to store a given resource and link it as a child of another resource.</ul>
            <ul><a href=""><b>removeChild:</b></a>Requests the Data API to remove a given resource and unlink it as a child of another resource.</ul>
            <ul><a href=""><b>delete:</b></a>Requests the Data API to remove a given resource.</ul>
        </div>

        <div class=""row bodyRow">
            <h2 class="textTitle">Usage</h2>
            <div code-doc-row url="'js/data/data.js'" class ="codeRow">
                <h3> Accessing Data Api</h3>
                <p>To call functions on the Data API, reference <code>client.data()</code> on the connected client.</p>
            </div>

            <div code-doc-row url="'js/data/list.js'" class ="codeRow">
                <h3> Listing Data Api Resources</h3>
                <p>To obtain a list of all resources in the Data API, the <code>list</code> action is used.</p>

                <p>
                    The list action without any resource specified returns an array of resource keys in
                    <code>entity</code>.
                </p>

                <p>Seeing a <code>response</code> of 'ok' is indication that the request was handled without error.</p>

                <p>The list action is also used for gathering children of a resource. Examples of this can be found
                   in the <a href="">children</a> section</p>

            </div>
            <div code-doc-row url="'js/data/set.js'" class ="codeRow">
                <h3> Storing an object in the Data API</h3>
                <p>
                    Storing an object in the Data API makes it available to other connected clients. This is useful for
                    resources that are desired among multiple applications but does not need communication between said
                    applications.
                </p>
                <p>To store a resource, the <b>set</b> action is used.</p>
                <p>In the example to the right, the resource <code>foo</code> is being stored at <code>/foo</code>.</p>
                <p>
                    The value of foo is wrapped in an object's <code>entity</code> field because of additional
                    properties that can drive the APIs handling of the request:
                </p>
                <ul><b>entity:</b> the value of the object that will be set.</ul>
                <ul><b>contentType:</b> the content type of the object that will be set.</ul>

                <p>Seeing a <code>response</code> of 'ok' is indication that the request was handled without error.</p>

            </div>

        <div code-doc-row url="'js/data/setPersist.js'" class ="codeRow">
            <h3> Storing a resource in the Data API with persistence</h3>
            <p>Persisting a Data API action to the backend is as simple as including <code>persist:true</code> to the
                <code>entity</code> of the request.

            <p>Seeing a <code>response</code> of 'ok' is indication that the request was handled without error.</p>

        </div>

        <div code-doc-row url="'js/data/get.js'" class ="codeRow">
            <h3>Getting a resource in the Data API</h3>
            <p>To retrieve a resource stored in the Data API the <code>get</code> action is used.

            <p>Seeing a <code>response</code> of 'ok' is indication that the request was handled without error.</p>

            <p>
                Requesting a resource that does not exist is not an invalid action, this will result in an 'ok'
                response, an entity of <code>{}</code> and  the resource created in the Data API (without persistance).
            </p>

        </div>

        <div code-doc-row url="'js/data/watch.js'" class ="codeRow">
            <h3>Watching a resource in the Data API</h3>
            <p>Watch a resource stored in the Data API for changes, the <code>watch</code> action is used.

            <p>
                Seeing a <code>response</code> of 'ok' is indication that the request to watch was handled without
                error.
            </p>

            <p>
                the promise returns when the request is handled, not when a change has occurred. The
                <code>onChange</code> callback is called on a change in the resource.
            </p>
            <p>
                To stop watching the resource based on its state, calling the <code>done()</code> function
                passed to the callback will remove the watch.
            </p>

        </div>

        <div code-doc-row url="'js/data/delete.js'" class ="codeRow">
            <h3>Removing an object in the Data API</h3>
            <p>To remove a resource stored in the Data API the <code>delete</code> action is used.

            <p>Seeing a <code>response</code> of 'ok' is indication that the request was handled without error.</p>

            <p>
                This only removes the resource from the Data API and not the persistent back-end.
            </p>

        </div>

        <div code-doc-row url="'js/data/deletePersist.js'" class ="codeRow">
            <h3>Removing an resource in the Data API with persistence</h3>
            <p>
                To remove a resource from the back-end, passing an entity with <code>persist:true</code> will trigger
                a delete request to the backend.
            </p>

            <p>Seeing a <code>response</code> of 'ok' is indication that the request was handled without error.</p>

        </div>
    </div>
    <div class="row bodyRow">
        <h2 class="textTitle">Children Resources</h2>
        <p>
            Children resources are JSON objects that relate to a common parent resource. The resource name of the child
            resource is arbitrary as it is created at run time, but a link is to the child is created in the parent
            resource so actions like "Run some function on all children of resource A" are possible.
        </p>
        <p>
            An example of when children resources are beneficial is a shopping cart:
        </p>
        <ul>
            <b>/shoppingCart:</b> a resource that holds information pertaining to a user's purchase. This is the
            parent resource and it holds a field <code>total</code>, the total of all items in the shopping cart.
        </ul>
        <ul>
            <b>/shoppingCart/1234:</b> a runtime generated resource holding information pertaining an <b>entry in the
            shopping cart</b>. Since the entry may contain unique information like <code>quantity</code>,
            <code>size</code>, and <code>color</code> it does not make sense to make a hardcoded resource. Rather,
            letting the IWC create a resource name and link it to <code>/shoppingCart</code> creates better versatility.
        </ul>

        <p>
            This structure lets calculating and keeping an update <code>total</code> in <code>/shoppingCart</code>
            simple with minimal coding needed.
        </p>

        <div code-doc-row url="'js/data/children/set.js'" class ="codeRow">
            <h3>Storing a parent resource in the Data API</h3>
            <p>
                Storing a parent resource is no different than storing a normal resource because in the Data API
                <b>all resources are parent resources</b>. This means any resource can be a parent to another resource,
                thus creating the ability to have resource chains.
            </p>
        </div>

        <div code-doc-row url="'js/data/children/setPersist.js'" class ="codeRow">
            <h3>Storing a parent resource in the Data API with Persistence</h3>
            <p>
                Again, no difference from <a href="">storing a normal resource with persistence</a> because all
                resources are parent resources.
            </p>
        </div>

        <div code-doc-row url="'js/data/children/list.js'" class ="codeRow">
            <h3>Getting a List of a Parent's Children</h3>
            <p> To get a list of all resources that are children of a parent, the <code>list</code> action is used.</p>
            <p>
                Unlike getting a list of all resources in the Data API, passing a resource key into the list function
                returns an array of resource keys that are direct children of the parent.
            </p>

            <p>
                In the example to the left cartItems will result in an array of strings. To gather the resource of the
                child, a normal <code>get</code> action is performed.
            </p>
        </div>

        <div code-doc-row url="'js/data/children/addChild.js'" class ="codeRow">
            <h3>Adding a Child Resource</h3>
            <p> To add a child resource, the <code>addChild</code> action is used.</p>
            <p>
                Since the resource key of the child is runtime generated, it will be returned in the promise in
                <code>entity.resource</code> as a string.
            </p>

            <p>
                In the example to the left, the added child will have a resource similar to
                <code>/shopingCart/1234</code> with 1234 being the random runtime child key.
            </p>
        </div>

        <div code-doc-row url="'js/data/children/addChildPersist.js'" class ="codeRow">
            <h3>Adding a Child Resource with Persistence</h3>
            <p>
                Just like with other persistence actions, adding <code>persist:true</code> to the resource entity
                will cause the API to persist the resource upon receival.
            </p>
        </div>

        <div code-doc-row url="'js/data/children/removeChild.js'" class ="codeRow">
            <h3>Removing a Child Resource</h3>
            <p>
                To remove a child resource from the Data API, it should be removed via it's parent with the
                <code>removeChild</code> action.
            </p>
            <p>
                For the parent to know what child to remove, the resource key returned in the <code>addChild</code>
                is passed in the entity's <code>resource</code> field.
            </p>
        </div>

        <div code-doc-row url="'js/data/children/removeChildPersist.js'" class ="codeRow">
            <h3>Removing a Child Resource with Persistence</h3>
            <p>
                Just like with other persistence actions, adding <code>persist:true</code> to the resource entity
                will cause the API to persist the child resource removal upon receival.
            </p>
        </div>
    </div>

    <div class="row bodyRow">
        <h2 class="textTitle">Putting it all Together</h2>
        <p>
            Combining aspects of child resources above, creating utility functions to handle the shopping cart
            reduce the clutter of constant API calls.
        </p>
        <div code-doc-row url="'js/data/example/init.js'" class ="codeRow">
            <h3>Variable setup</h3>
            <p>

            </p>
        </div>

        <div code-doc-row url="'js/data/example/utility.js'" class ="codeRow">
            <h3>Utility functions setup</h3>
            <p>

            </p>
        </div>

        <div code-doc-row url="'js/data/example/watch.js'" class ="codeRow">
            <h3>The Watch</h3>
            <p>

            </p>
        </div>

        <div code-doc-row url="'js/data/example/example.js'" class ="codeRow">
            <h3>The Example</h3>
            <p>

            </p>
        </div>
    </div>
</body>
</html>